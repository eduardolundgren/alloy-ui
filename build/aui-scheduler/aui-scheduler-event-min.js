AUI.add("aui-scheduler-event",function(aK){var ap=aK.Lang,be=ap.isString,i=ap.isDate,a3=ap.isFunction,M=ap.isObject,a7=ap.isBoolean,ae=ap.isNumber,aj=ap.isUndefined,aV=aK.ColorUtil,o=aK.DataType.DateMath,a0=aK.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),aD=":",bs="-",j=".",af="",bu="&ndash;",br=" ",K="_",W="activeView",z="all",P="allDay",Y="borderColor",aL="borderColorRGB",aI="borderStyle",bl="borderWidth",O="Change",aY="color",aT="colorBrightnessFactor",a8="colorSaturationFactor",aG="content",a6="day",w="disabled",aM="endDate",aP="eventClass",aw="hidden",N="hsbColor",av="icon",ac="icons",am="inherit",aU="isoTime",bk="locale",bh="meeting",aW="never",s="node",m="overlay",bq="recorder",ah="reminder",bd="repeated",a5="repeater",ai="scheduler",ax="scheduler-event",az="scheduler-event-recorder",a="short",bg="startDate",a1="template",aS="title",h="titleDateFormat",at="visible",g="%H:%M",Q="%l",bn="%M",aq=function(A){var L=[Q];if(A.getMinutes()>0){L.push(aD);L.push(bn);}if(A.getHours()>=12){L.push("p");}return L.join(af);},J=aK.getClassName,p=J(av),v=J(ax),I=J(ax,z,a6),aN=J(ax,aG),bb=J(ax,w),E=J(ax,aw),x=J(ax,av,w),G=J(ax,av,bh),au=J(ax,av,ah),e=J(ax,av,bd),bj=J(ax,ac),b=J(ax,bh),ar=J(ax,bq),r=J(ax,ah),aC=J(ax,bd),ao=J(ax,a),F=J(ax,aS);var aa=aK.Component.create({NAME:ax,ATTRS:{allDay:{setter:aK.DataType.Boolean.parse,value:false},borderStyle:{value:"solid",validator:be},borderWidth:{value:"1px",validator:be},colorBrightnessFactor:{value:0.75,validator:ae},colorSaturationFactor:{value:1.5,validator:ae},content:{validator:be},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:be},titleDateFormat:{getter:"_getTitleDateFormat",value:function(){var A=this,L=A.get(ai),bx=L&&L.get(W).get(aU),by={endDate:bu+br+g,startDate:g};if(!bx){by.endDate=bu+br+aq(A.get(aM));by.startDate=aq(A.get(bg));}if(A.getMinutesDuration()<=30){delete by.endDate;}else{if(A.get(P)){by={};}}return by;}},endDate:{setter:"_setDate",valueFn:function(){var A=o.clone(this.get(bg));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aK.SchedulerEvent;}},disabled:{value:false,validator:a7},meeting:{value:false,validator:a7},node:{valueFn:function(){return aK.NodeList.create(aK.Node.create(this.EVENT_NODE_TEMPLATE).setData(ax,this));}},reminder:{value:false,validator:a7},repeated:{value:false,validator:a7},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:a7}},EXTENDS:aK.Model,PROPAGATE_ATTRS:[P,bg,aM,aG,aY,aT,a8,aI,bl,h,at,w],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+v+'">'+'<div class="'+F+'"></div>'+'<div class="'+aN+'"></div>'+'<div class="'+bj+'">'+'<span class="'+[p,x].join(br)+'"></span>'+'<span class="'+[p,G].join(br)+'"></span>'+'<span class="'+[p,au].join(br)+'"></span>'+'<span class="'+[p,e].join(br)+'"></span>'+"</div>"+"</div>",initializer:function(){var A=this;var L=A.get(s);A.bindUI();A.syncUI();},bindUI:function(){var A=this;A.after({allDayChange:A._afterAllDayChange,colorChange:A._afterColorChange,disabledChange:A._afterDisabledChange,endDateChange:A._afterEndDateChange,meetingChange:A._afterMeetingChange,reminderChange:A._afterReminderChange,repeatedChange:A._afterRepeatedChange,visibleChange:A._afterVisibleChange});},syncUI:function(){var A=this;A._uiSetAllDay(A.get(P));A._uiSetColor(A.get(aY));A._uiSetDisabled(A.get(w));A._uiSetEndDate(A.get(aM));A._uiSetMeeting(A.get(bh));A._uiSetReminder(A.get(ah));A._uiSetRepeated(A.get(bd));A._uiSetVisible(A.get(at));A.syncNodeTitleUI();A.syncNodeContentUI();},destroy:function(){var A=this;A.get(s).remove(true);},addPaddingNode:function(){var A=this;A.get(s).push(aK.Node.create(A.EVENT_NODE_TEMPLATE).setData(ax,A));A.syncUI();},clone:function(){var L=this,A=new (L.get(aP))();A.copyPropagateAttrValues(L,null,{silent:true});return A;},copyDates:function(L,bx){var A=this;A.setAttrs({endDate:o.clone(L.get(aM)),startDate:o.clone(L.get(bg))},bx);},copyPropagateAttrValues:function(bx,bz,by){var A=this,L={};A.copyDates(bx,by);aK.Array.each(A.get(aP).PROPAGATE_ATTRS,function(bA){if(!((bz||{}).hasOwnProperty(bA))){var bB=bx.get(bA);if(!M(bB)){L[bA]=bB;}}});A.setAttrs(L,by);},getBorderColor:function(){var A=this;return A[aL].hex;},getDaysDuration:function(){var A=this;return o.getDayOffset(A.get(aM),A.get(bg));},getHoursDuration:function(){var A=this;return o.getHoursOffset(A.get(aM),A.get(bg));},getMinutesDuration:function(){var A=this;return o.getMinutesOffset(A.get(aM),A.get(bg));},getSecondsDuration:function(){var A=this;return o.getSecondsOffset(A.get(aM),A.get(bg));},sameEndDate:function(L){var A=this;return o.compare(A.get(aM),L.get(aM));},sameStartDate:function(L){var A=this;return o.compare(A.get(bg),L.get(bg));},isAfter:function(by){var bx=this;var L=bx.get(bg);var A=by.get(bg);return o.after(L,A);},isBefore:function(by){var bx=this;var L=bx.get(bg);var A=by.get(bg);return o.before(L,A);},intersects:function(by){var bx=this;var bz=bx.get(aM);var L=bx.get(bg);var A=by.get(bg);return(bx.sameStartDate(by)||o.between(A,L,bz));},intersectHours:function(bx){var L=this;var bz=L.get(aM);var A=L.get(bg);var by=o.clone(A);o.copyHours(by,bx.get(bg));return(o.compare(A,by)||o.between(by,A,bz));},isDayBoundaryEvent:function(){var A=this;return o.isDayBoundary(A.get(bg),A.get(aM));},isDayOverlapEvent:function(){var A=this;return o.isDayOverlap(A.get(bg),A.get(aM));},getClearEndDate:function(){var A=this;return o.safeClearTime(A.get(aM));},getClearStartDate:function(){var A=this;return o.safeClearTime(A.get(bg));},move:function(bx,L){var A=this;var by=A.getMinutesDuration();A.setAttrs({endDate:o.add(o.clone(bx),o.MINUTES,by),startDate:bx},L);},setContent:function(L){var A=this;A.get(s).each(function(by){var bx=by.one(j+aN);bx.setContent(L);});},setTitle:function(L){var A=this;A.get(s).each(function(bx){var by=bx.one(j+F);by.setContent(L);});},syncNodeContentUI:function(){var A=this;A.setContent(A.get(aG));},syncNodeTitleUI:function(){var L=this,by=L.get(h),A=L.get(bg),bx=L.get(aM),bz=[];
if(by.startDate){bz.push(L._formatDate(A,by.startDate));}if(by.endDate){bz.push(L._formatDate(bx,by.endDate));}L.setTitle(bz.join(br));},split:function(){var A=this,bx=o.clone(A.get(bg)),by=o.clone(A.get(aM));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=o.clone(bx);L.setHours(24,0,0,0);return[[bx,o.toMidnight(o.clone(bx))],[L,o.clone(by)]];}return[[bx,by]];},_afterAllDayChange:function(L){var A=this;A._uiSetAllDay(L.newVal);},_afterColorChange:function(L){var A=this;A._uiSetColor(L.newVal);},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterEndDateChange:function(L){var A=this;A._uiSetEndDate(L.newVal);},_afterMeetingChange:function(L){var A=this;A._uiSetMeeting(L.newVal);},_afterReminderChange:function(L){var A=this;A._uiSetReminder(L.newVal);},_afterRepeatedChange:function(L){var A=this;A._uiSetRepeated(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_setColor:function(L){var A=this;A[N]=aV.rgb2hsb(aV.getRGB(L));A[Y]=aK.clone(A[N]);A[Y].b*=A.get(aT);A[Y].s*=A.get(a8);A[aL]=aV.hsb2rgb(A[Y]);return L;},_setDate:function(L){var A=this;if(ae(L)){L=new Date(L);}return L;},_setScheduler:function(bx){var A=this;var L=A.get(ai);if(L){A.removeTarget(L);}A.addTarget(bx);return bx;},_formatDate:function(bx,by){var L=this;var A=L.get(bk);return aK.DataType.Date.format(bx,{format:by,locale:A});},_getTitleDateFormat:function(L){var A=this;if(be(L)){L={endDate:L,startDate:L};}else{if(a3(L)){L=L.call(A);}}return L;},_uiSetAllDay:function(L){var A=this;A.get(s).toggleClass(I,!!L);},_uiSetColor:function(by){var A=this;var bx=A.get(s);var bz=A.getBorderColor();if(bx){var L={borderWidth:A.get(bl),borderColor:bz,backgroundColor:by,borderStyle:A.get(aI),color:am};bx.setStyles(L);}},_uiSetDisabled:function(L){var A=this;A.get(s).toggleClass(bb,!!L);},_uiSetEndDate:function(L){var A=this;A.get(s).toggleClass(ao,A.getMinutesDuration()<=30);},_uiSetMeeting:function(L){var A=this;A.get(s).toggleClass(b,!!L);},_uiSetReminder:function(L){var A=this;A.get(s).toggleClass(r,!!L);},_uiSetRepeated:function(L){var A=this;A.get(s).toggleClass(aC,!!L);},_uiSetVisible:function(L){var A=this;A.get(s).toggleClass(E,!L);}}});aK.SchedulerEvent=aa;var ay=aK.Lang,d=ay.isArray,f="arrow",aR="body",aB="bodyContent",c="borderRadius",t="boundingBox",aA="cancel",aX="click",H="constrain",aQ="date",aH="dateFormat",an="delete",a4="description",bp="event",D="footerContent",aF="form",C="header",U="offsetHeight",bc="offsetWidth",X="overlayOffset",bm="rendered",k="region",l="right",aZ="save",q="schedulerChange",aE="shadow",T="strings",bo="tl",n="top",ad="toolbar",bf="submit",bi="value",aO="visibleChange",V="width",ag="cancel",S="delete",B="edit",aJ="save",u=aK.IO.prototype._serialize,bt=J(ai,bp,bq,m),y=J(ai,bp,bq,m,f),a9=J(ai,bp,bq,m,f,n),ba=J(ai,bp,bq,m,f,aE),al=J(ai,bp,bq,m,aR),a2=J(ai,bp,bq,m,aG),ak=J(ai,bp,bq,m,aQ),Z=J(ai,bp,bq,m,aF),bw=J(ai,bp,bq,m,C),R=new aK.Template('<div class="',ba," ",y,'"></div>','<div class="',y,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bw,'">','<input class="',a2,'" name="content" value="{content}" />',"</div>",'<div class="',al,'">','<label class="',ak,'">{date}</label>',"</div>"),bv='<form class="'+Z+'" id="schedulerEventRecorderForm"></form>';var ab=aK.Component.create({NAME:az,ATTRS:{allDay:{value:false},content:{},duration:{value:60},dateFormat:{validator:be,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aK.SchedulerEvent;}},strings:{value:{},setter:function(A){return aK.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's",cancel:"Cancel",description:"Description",edit:"Edit",save:"Save",when:"When"},A||{});},validator:M},overlay:{validator:M,value:{constrain:true,visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:d},template:{value:R},toolbar:{setter:function(bx){var L=this;var A=L.get(T);return aK.merge({children:[{handler:aK.bind(L._handleSaveEvent,L),label:A[aZ]},{handler:aK.bind(L._handleCancelEvent,L),label:A[aA]},{handler:aK.bind(L._handleDeleteEvent,L),label:A[an]}]},bx||{});},validator:M,value:{}}},EXTENDS:aK.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(s).addClass(ar);A.publish(ag,{defaultFn:A._defCancelEventFn});A.publish(S,{defaultFn:A._defDeleteEventFn});A.publish(B,{defaultFn:A._defEditEventFn});A.publish(aJ,{defaultFn:A._defSaveEventFn});A.after(q,A._afterSchedulerChange);A[m]=new aK.Overlay(A.get(m));A[ad]=new aK.Toolbar(A.get(ad));},getOverlayContentNode:function(){var A=this;var L=A[m].get(t);return L.one(j+a2);},getUpdatedSchedulerEvent:function(bx){var A=this,by=A.get(bp),L={silent:!by},bz=A.serializeForm();if(!by){by=A.clone();}by.set(ai,A.get(ai),{silent:true});by.setAttrs(aK.merge(bz,bx),L);return by;},_afterSchedulerChange:function(by){var A=this;var bx=by.newVal;var L=bx.get(t);L.delegate(aX,aK.bind(A._onClickSchedulerEvent,A),j+v);},_defCancelEventFn:function(L){var A=this;A.get(s).remove();A.hideOverlay();},_defDeleteEventFn:function(bx){var A=this;var L=A.get(ai);L.removeEvent(A.get(bp));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(bx){var A=this;var L=A.get(ai);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(bx){var A=this;var L=A.get(ai);L.addEvent(bx.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ag);L.preventDefault();},_handleDeleteEvent:function(L){var A=this;A.fire(S,{schedulerEvent:A.get(bp)});L.preventDefault();},_handleSaveEvent:function(bx){var A=this,L=A.get(bp)?B:aJ;A.fire(L,{newSchedulerEvent:A.getUpdatedSchedulerEvent()});bx.preventDefault();},_onClickSchedulerEvent:function(bx){var A=this;var L=bx.currentTarget.getData(ax);if(L){A.set(bp,L,{silent:true});A.showOverlay([bx.pageX,bx.pageY]);A.get(s).remove();}},_onOverlayVisibleChange:function(L){var A=this;if(L.newVal){A.populateForm();if(!A.get(bp)){var bx=A.getOverlayContentNode();
if(bx){setTimeout(function(){bx.selectText();},0);}}}else{A.set(bp,null,{silent:true});A.get(s).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(T);L[m].render();L[ad].render();var bx=L[m].get(t);bx.addClass(bt);L[m].set(D,L[ad].get(t));L[m].on(aO,aK.bind(L._onOverlayVisibleChange,L));L.formNode=aK.Node.create(bv);L[m].set(aB,L.formNode);L.formNode.on(bf,aK.bind(L._onSubmitForm,L));},getFormattedDate:function(){var bx=this;var L=bx.get(aH);var bz=(bx.get(bp)||bx);var bB=bz.get(aM);var bA=bz.get(ai);var A=bz.get(bg);var by=(bA.get(W).get(aU)?o.toIsoTimeString:o.toUsTimeString);return[bz._formatDate(A,L),by(A),bs,by(bB)].join(br);},getTemplateData:function(){var L=this,A=L.get(T),bx=L.get(bp)||L,by=bx.get(aG);if(aj(by)){by=A["description-hint"];}return{content:by,date:L.getFormattedDate(),endDate:bx.get(aM).getTime(),startDate:bx.get(bg).getTime()};},hideOverlay:function(){var A=this;A[m].hide();},populateForm:function(){var A=this;A.formNode.setContent(A.get(a1).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aK.QueryString.parse(u(A.formNode.getDOM()));},showOverlay:function(bL,bB){var bJ=this,bD=bL.concat([]),bC=bJ[m],bA=bC.get(t);if(!bJ[m].get(bm)){bJ._renderOverlay();}bC.show();var bI=bA.all(j+y),bH=bI.item(0),L=bH.get(bc),bE=bH.get(U);bI.removeClass(a9);bI.show();bL[0]-=bA.get(bc)/2;bL[1]-=(bA.get(U)+(bE/2));var bz=bC.getConstrainedXY(bL);if(bz[1]!==bL[1]){bL[1]=(bD[1]+(bE/2));bI.addClass(a9);}bC.set("xy",bL);bL=bC.get("xy");var bG={left:bD[0],right:bD[0],top:bD[1],bottom:bD[1]},by=parseInt(bA.getStyle(c),10);if(!aK.DOM.inRegion(null,bA.get(k),true,bG)){var bx=(L/2)-by,bF=Math.max(bL[0],bD[0]),bK=bL[0]+bA.get(bc)-L,A=Math.min(bF,bK);A-=bx;bI.setX(A);}else{bI.hide();}}}});aK.SchedulerEventRecorder=ab;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","model","querystring","overlay"]});