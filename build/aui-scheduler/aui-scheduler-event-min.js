AUI.add("aui-scheduler-event",function(aD){var ai=aD.Lang,a6=ai.isString,h=ai.isDate,aW=ai.isFunction,G=ai.isObject,a0=ai.isBoolean,Y=ai.isNumber,aO=aD.ColorUtil,k=aD.DataType.DateMath,aT=aD.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),aw=":",bk="-",i=".",Z="",bm="&ndash;",bj=" ",F="_",Q="activeView",v="all",J="allDay",S="borderColor",aE="borderColorRGB",aB="borderStyle",bd="borderWidth",I="Change",aR="color",aM="colorBrightnessFactor",a1="colorSaturationFactor",az="content",aZ="day",s="disabled",aF="endDate",aI="eventClass",ao="hidden",H="hsbColor",an="icon",W="icons",af="inherit",aN="isoTime",bc="locale",a9="meeting",aP="never",o="node",j="overlay",bi="recorder",ab="reminder",a5="repeated",aY="repeater",ac="scheduler",ap="scheduler-event",ar="scheduler-event-recorder",a="short",a8="startDate",aU="template",aL="title",g="titleDateFormat",al="visible",f="%H:%M",K="%l",bf="%M",aj=function(A){var L=[K];if(A.getMinutes()>0){L.push(aw);L.push(bf);}if(A.getHours()>=12){L.push("p");}return L.join(Z);},E=aD.getClassName,l=E(an),r=E(ap),D=E(ap,v,aZ),aG=E(ap,az),a3=E(ap,s),z=E(ap,ao),t=E(ap,an,s),C=E(ap,an,a9),am=E(ap,an,ab),d=E(ap,an,a5),bb=E(ap,W),b=E(ap,a9),ak=E(ap,bi),n=E(ap,ab),av=E(ap,a5),ah=E(ap,a),B=E(ap,aL);var U=aD.Component.create({NAME:ap,ATTRS:{allDay:{setter:aD.DataType.Boolean.parse,value:false},borderStyle:{value:"solid",validator:a6},borderWidth:{value:"1px",validator:a6},colorBrightnessFactor:{value:0.75,validator:Y},colorSaturationFactor:{value:1.5,validator:Y},content:{value:"(no title)",validator:a6},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:a6},titleDateFormat:{getter:"_getTitleDateFormat",value:function(){var A=this,L=A.get(ac),bp=L&&L.get(Q).get(aN),bq={endDate:bm+bj+f,startDate:f};if(!bp){bq.endDate=bm+bj+aj(A.get(aF));bq.startDate=aj(A.get(a8));}if(A.getMinutesDuration()<=30){delete bq.endDate;}else{if(A.get(J)){bq={};}}return bq;}},endDate:{setter:"_setDate",valueFn:function(){var A=k.clone(this.get(a8));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aD.SchedulerEvent;}},disabled:{value:false,validator:a0},meeting:{value:false,validator:a0},node:{valueFn:function(){return aD.NodeList.create(aD.Node.create(this.EVENT_NODE_TEMPLATE).setData(ap,this));}},reminder:{value:false,validator:a0},repeated:{value:false,validator:a0},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:a0}},EXTENDS:aD.Base,PROPAGATE_ATTRS:[a8,aF,az,aR,aM,a1,aB,bd,g,al,s],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+r+'">'+'<div class="'+B+'"></div>'+'<div class="'+aG+'"></div>'+'<div class="'+bb+'">'+'<span class="'+[l,t].join(bj)+'"></span>'+'<span class="'+[l,C].join(bj)+'"></span>'+'<span class="'+[l,am].join(bj)+'"></span>'+'<span class="'+[l,d].join(bj)+'"></span>'+"</div>"+"</div>",initializer:function(){var A=this;var L=A.get(o);A.bindUI();A.syncUI();},bindUI:function(){var A=this;A.after({allDayChange:A._afterAllDayChange,colorChange:A._afterColorChange,disabledChange:A._afterDisabledChange,endDateChange:A._afterEndDateChange,meetingChange:A._afterMeetingChange,reminderChange:A._afterReminderChange,repeatedChange:A._afterRepeatedChange,visibleChange:A._afterVisibleChange});},syncUI:function(){var A=this;A._uiSetAllDay(A.get(J));A._uiSetColor(A.get(aR));A._uiSetDisabled(A.get(s));A._uiSetEndDate(A.get(aF));A._uiSetMeeting(A.get(a9));A._uiSetReminder(A.get(ab));A._uiSetRepeated(A.get(a5));A._uiSetVisible(A.get(al));A.syncNodeTitleUI();A.syncNodeContentUI();},destroy:function(){var A=this;A.get(o).remove(true);},addPaddingNode:function(){var A=this;A.get(o).push(aD.Node.create(A.EVENT_NODE_TEMPLATE).setData(ap,A));A.syncUI();},copyDates:function(L){var A=this;A.set(aF,k.clone(L.get(aF)));A.set(a8,k.clone(L.get(a8)));},copyPropagateAttrValues:function(L,bp){var A=this;A.copyDates(L);aD.Array.each(A.get(aI).PROPAGATE_ATTRS,function(bq){if(!((bp||{}).hasOwnProperty(bq))){var br=L.get(bq);if(!G(br)){A.set(bq,br);}}});},getBorderColor:function(){var A=this;return A[aE].hex;},getDaysDuration:function(){var A=this;return k.getDayOffset(A.get(aF),A.get(a8));},getHoursDuration:function(){var A=this;return k.getHoursOffset(A.get(aF),A.get(a8));},getMinutesDuration:function(){var A=this;return k.getMinutesOffset(A.get(aF),A.get(a8));},getSecondsDuration:function(){var A=this;return k.getSecondsOffset(A.get(aF),A.get(a8));},sameEndDate:function(L){var A=this;return k.compare(A.get(aF),L.get(aF));},sameStartDate:function(L){var A=this;return k.compare(A.get(a8),L.get(a8));},isAfter:function(bq){var bp=this;var L=bp.get(a8);var A=bq.get(a8);return k.after(L,A);},isBefore:function(bq){var bp=this;var L=bp.get(a8);var A=bq.get(a8);return k.before(L,A);},intersects:function(bq){var bp=this;var br=bp.get(aF);var L=bp.get(a8);var A=bq.get(a8);return(bp.sameStartDate(bq)||k.between(A,L,br));},intersectHours:function(bp){var L=this;var br=L.get(aF);var A=L.get(a8);var bq=k.clone(A);k.copyHours(bq,bp.get(a8));return(k.compare(A,bq)||k.between(bq,A,br));},isDayBoundaryEvent:function(){var A=this;return k.isDayBoundary(A.get(a8),A.get(aF));},isDayOverlapEvent:function(){var A=this;return k.isDayOverlap(A.get(a8),A.get(aF));},getClearEndDate:function(){var A=this;return k.safeClearTime(A.get(aF));},getClearStartDate:function(){var A=this;return k.safeClearTime(A.get(a8));},move:function(L){var A=this;var bp=A.getMinutesDuration();A.set(a8,L);A.set(aF,k.add(k.clone(L),k.MINUTES,bp));},setContent:function(L){var A=this;A.get(o).each(function(bq){var bp=bq.one(i+aG);bp.setContent(L);});},setTitle:function(L){var A=this;A.get(o).each(function(bp){var bq=bp.one(i+B);bq.setContent(L);});},syncNodeContentUI:function(){var A=this;A.setContent(A.get(az));},syncNodeTitleUI:function(){var L=this,bq=L.get(g),A=L.get(a8),bp=L.get(aF),br=[];if(bq.startDate){br.push(L._formatDate(A,bq.startDate));}if(bq.endDate){br.push(L._formatDate(bp,bq.endDate));}L.setTitle(br.join(bj));
},split:function(){var A=this,bp=k.clone(A.get(a8)),bq=k.clone(A.get(aF));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=k.clone(bp);L.setHours(24,0,0,0);return[[bp,k.toMidnight(k.clone(bp))],[L,k.clone(bq)]];}return[[bp,bq]];},_afterAllDayChange:function(L){var A=this;A._uiSetAllDay(L.newVal);},_afterColorChange:function(L){var A=this;A._uiSetColor(L.newVal);},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterEndDateChange:function(L){var A=this;A._uiSetEndDate(L.newVal);},_afterMeetingChange:function(L){var A=this;A._uiSetMeeting(L.newVal);},_afterReminderChange:function(L){var A=this;A._uiSetReminder(L.newVal);},_afterRepeatedChange:function(L){var A=this;A._uiSetRepeated(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_setColor:function(L){var A=this;A[H]=aO.rgb2hsb(aO.getRGB(L));A[S]=aD.clone(A[H]);A[S].b*=A.get(aM);A[S].s*=A.get(a1);A[aE]=aO.hsb2rgb(A[S]);return L;},_setDate:function(L){var A=this;if(Y(L)){L=new Date(L);}return L;},_setScheduler:function(bp){var A=this;var L=A.get(ac);if(L){A.removeTarget(L);}A.addTarget(bp);return bp;},_formatDate:function(bp,bq){var L=this;var A=L.get(bc);return aD.DataType.Date.format(bp,{format:bq,locale:A});},_getTitleDateFormat:function(L){var A=this;if(a6(L)){L={endDate:L,startDate:L};}else{if(aW(L)){L=L.call(A);}}return L;},_uiSetAllDay:function(L){var A=this;A.get(o).toggleClass(D,!!L);},_uiSetColor:function(bq){var A=this;var bp=A.get(o);var br=A.getBorderColor();if(bp){var L={borderWidth:A.get(bd),borderColor:br,backgroundColor:bq,borderStyle:A.get(aB),color:af};bp.setStyles(L);}},_uiSetDisabled:function(L){var A=this;A.get(o).toggleClass(a3,!!L);},_uiSetEndDate:function(L){var A=this;A.get(o).toggleClass(ah,A.getMinutesDuration()<=30);},_uiSetMeeting:function(L){var A=this;A.get(o).toggleClass(b,!!L);},_uiSetReminder:function(L){var A=this;A.get(o).toggleClass(n,!!L);},_uiSetRepeated:function(L){var A=this;A.get(o).toggleClass(av,!!L);},_uiSetVisible:function(L){var A=this;A.get(o).toggleClass(z,!L);}}});aD.SchedulerEvent=U;var aq=aD.Lang,c=aq.isArray,e="arrow",aK="body",au="bodyContent",p="boundingBox",at="cancel",aQ="click",aJ="date",aA="dateFormat",ag="delete",aX="description",bh="event",y="footerContent",ay="form",x="header",P="offsetHeight",a4="offsetWidth",R="overlayOffset",a5="repeated",be="rendered",aS="save",m="schedulerChange",ax="shadow",O="strings",bg="tl",X="toolbar",a7="submit",ba="value",aH="visibleChange",aa="cancel",N="delete",w="edit",aC="save",q=aD.IO.prototype._serialize,bl=E(ac,bh,bi,j),u=E(ac,bh,bi,j,e),a2=E(ac,bh,bi,j,e,ax),ae=E(ac,bh,bi,j,aK),aV=E(ac,bh,bi,j,az),ad=E(ac,bh,bi,j,aJ),T=E(ac,bh,bi,j,ay),bo=E(ac,bh,bi,j,x),M=new aD.Template('<div class="',a2," ",u,'"></div>','<div class="',u,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bo,'">','<input class="',aV,'" name="content" value="{content}" />',"</div>",'<div class="',ae,'">','<label class="',ad,'">{date}</label>',"</div>"),bn='<form class="'+T+'" id="schedulerEventRecorderForm"></form>';var V=aD.Component.create({NAME:ar,ATTRS:{allDay:{value:false},content:{value:Z},duration:{value:60},dateFormat:{validator:a6,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aD.SchedulerEvent;}},strings:{value:{},setter:function(A){return aD.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's",cancel:"Cancel",description:"Description",edit:"Edit",save:"Save",when:"When"},A||{});},validator:G},overlay:{validator:G,value:{align:{points:[bg,bg]},visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:c},template:{value:M},toolbar:{setter:function(bp){var L=this;var A=L.get(O);return aD.merge({children:[{handler:aD.bind(L._handleSaveEvent,L),label:A[aS]},{handler:aD.bind(L._handleCancelEvent,L),label:A[at]},{handler:aD.bind(L._handleDeleteEvent,L),label:A[ag]}]},bp||{});},validator:G,value:{}}},EXTENDS:aD.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(o).addClass(ak);A.publish(aa,{defaultFn:A._defCancelEventFn});A.publish(N,{defaultFn:A._defDeleteEventFn});A.publish(w,{defaultFn:A._defEditEventFn});A.publish(aC,{defaultFn:A._defSaveEventFn});A.after(m,A._afterSchedulerChange);A[j]=new aD.Overlay(A.get(j));A[X]=new aD.Toolbar(A.get(X));},_afterSchedulerChange:function(bq){var A=this;var bp=bq.newVal;var L=bp.get(p);L.delegate(aQ,aD.bind(A._onClickSchedulerEvent,A),i+r);},_defCancelEventFn:function(L){var A=this;A.get(o).remove();A.hideOverlay();},_defDeleteEventFn:function(bp){var A=this;var L=A.get(ac);L.removeEvent(A.get(bh));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(bp){var A=this;var L=A.get(ac);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(bp){var A=this;var L=A.get(ac);L.addEvent(bp.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(aa);L.preventDefault();},_handleDeleteEvent:function(L){var A=this;A.fire(N,{schedulerEvent:A.get(bh)});L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bh)?w:aC,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickSchedulerEvent:function(bp){var A=this;var L=bp.currentTarget.getData(ap);if(L){A.set(bh,L);A.showOverlay([bp.pageX,bp.pageY]);A.get(o).remove();}},_onOverlayVisibleChange:function(bq){var L=this;if(bq.newVal){L.populateForm();if(!L.get(bh)){var bp=L[j].get(p);var A=bp.one(i+aV);setTimeout(function(){A.selectText();},0);}}else{L.set(bh,null);L.get(o).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(O);L[j].render();L[X].render();var bp=L[j].get(p);bp.addClass(bl);L[j].set(y,L[X].get(p));L[j].on(aH,aD.bind(L._onOverlayVisibleChange,L));L.formNode=aD.Node.create(bn);L[j].set(au,L.formNode);L.formNode.on(a7,aD.bind(L._onSubmitForm,L));},getEventCopy:function(){var A=this;var bp=A.get(bh);if(!bp){bp=new (A.get(aI))({allDay:A.get(J),endDate:A.get(aF),scheduler:A.get(ac),startDate:A.get(a8)});
bp.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();bp.set(az,L[az]);bp.set(a5,L[a5]);return bp;},getFormattedDate:function(){var bp=this;var L=bp.get(aA);var br=(bp.get(bh)||bp);var bt=br.get(aF);var bs=br.get(ac);var A=br.get(a8);var bq=(bs.get(Q).get(aN)?k.toIsoTimeString:k.toUsTimeString);return[br._formatDate(A,L),bq(A),bk,bq(bt)].join(bj);},getTemplateData:function(){var L=this;var A=L.get(O);var bp=(L.get(bh)||L);return{content:bp.get(az)||A["description-hint"],date:L.getFormattedDate(),endDate:bp.get(aF).getTime(),repeated:bp.get(a5),startDate:bp.get(a8).getTime()};},hideOverlay:function(){var A=this;A[j].hide();},populateForm:function(){var A=this;A.formNode.setContent(A.get(aU).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aD.QueryString.parse(q(A.formNode.getDOM()));},showOverlay:function(bq,bs){var A=this;var bp=A.get(R);if(!A[j].get(be)){A._renderOverlay();}A[j].show();if(!bq){var L=(A.get(bh)||A).get(o);var br=L.one(i+B);bs=[bp[0]+br.get(a4),bp[1]+br.get(P)/2];bq=br.getXY();}bs=bs||bp;bq[0]+=bs[0];bq[1]+=bs[1];A[j].set("xy",bq);}}});aD.SchedulerEventRecorder=V;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});