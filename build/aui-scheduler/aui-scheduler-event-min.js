AUI.add("aui-scheduler-event",function(aO){var ar=aO.Lang,bo=ar.isString,f=ar.isDate,be=ar.isFunction,J=ar.isObject,bh=ar.isBoolean,ag=ar.isNumber,a3=aO.ColorUtil,j=aO.DataType.DateMath,ba=aO.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),bj="-",v="&ndash;",aC=".",r="",s=" ",n="_",aR="_propagateSet",S="activeView",V="borderColor",aT="borderColorRGB",aM="borderStyle",bv="borderWidth",M="Change",a8="color",a1="colorBrightnessFactor",bi="colorSaturationFactor",aK="content",ak="contentNode",y="disabled",a5="duration",aU="endDate",aX="eventClass",av="eventStack",bp="events",ay="hidden",K="hsbColor",ax="icon",ad="icons",a6="id",a2="isoTime",bu="locale",a4="never",p="node",h="overlay",aQ="parentEvent",bA="recorder",aS="repeat",bn="repeated",R="repeatedEvents",bg="repeater",aj="scheduler",az="scheduler-event",aB="scheduler-event-recorder",br="startDate",bc="template",a0="title",e="titleDateFormat",I="titleNode",au="visible",k="paddingNode",m="paddingContentNode",aP="paddingTitleNode",d="%H:%M",bb="%I:%M",G=aO.getClassName,l=G(ax),u=G(az),aV=G(az,aK),E=G(az,ay),bl=G(az,y),at=G(az,bA),aF=G(az,bn),aq=G(az,bg),F=G(az,a0),bt=G(az,ad),x=G(az,ax,y),b=G(az,ax,bn),bx=G(az,ax,bg);var Z=aO.Component.create({NAME:az,ATTRS:{borderStyle:{value:"solid",validator:bo},borderWidth:{value:"1px",validator:bo},colorBrightnessFactor:{value:0.75,validator:ag},colorSaturationFactor:{value:1.5,validator:ag},content:{value:"(no title)",validator:bo},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bo},titleDateFormat:{getter:"_getTitleDateFormat",validator:bo},endDate:{setter:"_setDate",valueFn:function(){var A=j.clone(this.get(br));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aO.SchedulerEvent;}},disabled:{value:false,validator:bh},node:{valueFn:function(){return aO.Node.create(this.EVENT_NODE_TEMPLATE).setData(az,this);},setter:aO.one},paddingNode:{readOnly:true,valueFn:function(){return aO.Node.create(this.EVENT_NODE_TEMPLATE).setData(az,this);}},parentEvent:{},repeat:{value:r,setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:bh}},EXTENDS:aO.Base,PROPAGATE_ATTRS:[br,aU,aK,a8,a1,bi,aM,bv,e,au,y],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+u+'">'+'<div class="'+F+'"></div>'+'<div class="'+aV+'"></div>'+'<div class="'+bt+'">'+'<span class="'+[l,b].join(s)+'"></span>'+'<span class="'+[l,bx].join(s)+'"></span>'+'<span class="'+[l,x].join(s)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var X=A.get(p);var L=A.get(k);A[av]={};aO.Array.each(A.get(aX).PROPAGATE_ATTRS,function(Y){A.after(Y+M,A._propagateAttrChange);});A._bindUIAttrs();A[ak]=X.one(aC+aV);A[I]=X.one(aC+F);A[m]=L.one(aC+aV);A[aP]=L.one(aC+F);A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(L,X){L.destroy();});A[av]={};A.get(k).remove(true);A.get(p).remove(true);},copyDates:function(L){var A=this;A.set(aU,j.clone(L.get(aU)));A.set(br,j.clone(L.get(br)));},copyPropagateAttrValues:function(L,X){var A=this;A.copyDates(L);aO.Array.each(A.get(aX).PROPAGATE_ATTRS,function(Y){if(!((X||{}).hasOwnProperty(Y))){var bF=L.get(Y);if(!J(bF)){A.set(Y,bF);}}});},getBorderColor:function(){var A=this;return A[aT].hex;},getDaysDuration:function(){var A=this;return j.getDayOffset(A.get(aU),A.get(br));},getHoursDuration:function(){var A=this;return j.getHoursOffset(A.get(aU),A.get(br));},getMinutesDuration:function(){var A=this;return j.getMinutesOffset(A.get(aU),A.get(br));},getSecondsDuration:function(){var A=this;return j.getSecondsOffset(A.get(aU),A.get(br));},sameEndDate:function(L){var A=this;return j.compare(A.get(aU),L.get(aU));},sameStartDate:function(L){var A=this;return j.compare(A.get(br),L.get(br));},isAfter:function(Y){var X=this;var L=X.get(br);var A=Y.get(br);return j.after(L,A);},isBefore:function(Y){var X=this;var L=X.get(br);var A=Y.get(br);return j.before(L,A);},repeatByDate:function(X){var L=this;var Y=L.uidByDate(X);if(!L[av][Y]){var A=j.clone(X);var bG=j.clone(X);j.copyHours(A,L.get(br));j.copyHours(bG,L.get(aU));var bF=new L.get(aX)({endDate:bG,parentEvent:L,scheduler:L.get(aj),startDate:A});bF.copyPropagateAttrValues(L);L[av][Y]=bF;}return L[av][Y];},intersects:function(Y){var X=this;var bF=X.get(aU);var L=X.get(br);var A=Y.get(br);return(X.sameStartDate(Y)||j.between(A,L,bF));},intersectHours:function(X){var L=this;var bF=L.get(aU);var A=L.get(br);var Y=j.clone(A);j.copyHours(Y,X.get(br));return(j.compare(A,Y)||j.between(Y,A,bF));},isDayBoundaryEvent:function(){var A=this;return j.isDayBoundary(A.get(br),A.get(aU));},isDayOverlapEvent:function(){var A=this;return j.isDayOverlap(A.get(br),A.get(aU));},isRepeatableDate:function(L){var A=this;var X=A.get(aS);return(X&&X.validate(A,L));},getClearEndDate:function(){var A=this;return j.safeClearTime(A.get(aU));},getClearStartDate:function(){var A=this;return j.safeClearTime(A.get(br));},move:function(L){var A=this;var X=A.getMinutesDuration();A.set(br,L);A.set(aU,j.add(j.clone(L),j.MINUTES,X));},uidByDate:function(L){var A=this;L=f(L)?j.safeClearTime(L):A.getClearStartDate();return[az,L.getTime()].join(n);},setContent:function(X,L){var A=this;A._setContent(ak,X,L);A._setContent(m,X,L);},setTitle:function(X,L){var A=this;A._setContent(I,X,L);A._setContent(aP,X,L);},syncNodeUI:function(L){var A=this;A._syncUIAttrs();A.syncNodeColorUI(L);A.syncNodeTitleUI(L);A.syncNodeContentUI(L);},syncNodeColorUI:function(L){var A=this;var bF=A.get(p);var X=A.get(k);var bG=A.getBorderColor();if(bF&&X){var Y={borderWidth:A.get(bv),borderColor:bG,backgroundColor:A.get(a8),borderStyle:A.get(aM)};bF.setStyles(Y);X.setStyles(Y);}if(L){A.eachRepeatedEvent(function(bH,bI){bH.syncNodeColorUI();});}},syncNodeContentUI:function(L){var A=this;A.setContent(A.get(aK),L);},syncNodeTitleUI:function(L){var A=this;var Y=A._formatDate(A.get(br));var X=A._formatDate(A.get(aU));A.setTitle([Y,X].join(s+v+s),L);
},split:function(){var A=this,X=j.clone(A.get(br)),Y=j.clone(A.get(aU));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=j.clone(X);L.setHours(24,0,0,0);return[[X,j.toMidnight(j.clone(X))],[L,j.clone(Y)]];}return[[X,Y]];},eachRepeatedEvent:function(L){var A=this;aO.each(A[av],L,A);},unlink:function(){var A=this;if(A.get(aQ)){A.set(aQ,null);}else{A.eachRepeatedEvent(function(L,X){L.unlink();});}A[av]={};A.syncNodeUI();},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_afterRepeatChange:function(L){var A=this;A._uiSetRepeat(L.newVal);},_afterParentEventChange:function(L){var A=this;A._uiSetParentEvent(L.newVal);},_bindUIAttrs:function(){var A=this;A.after({disabledChange:A._afterDisabledChange,visibleChange:A._afterVisibleChange,parentEventChange:A._afterParentEventChange,repeatChange:A._afterRepeatChange});A._syncUIAttrs();},_propagateAttrChange:function(Y){var A=this;var X=Y.attrName;var L=Y.newVal;A.eachRepeatedEvent(function(bF,bG){var bH=bF[aR+ba(X)];if(bH){bH.apply(A,[bF,X,L]);}else{bF.set(X,Y.newVal);}bF.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,L,Y){var X=j.clone(A.get(aU));j.copyHours(X,Y);A.set(aU,X);},_propagateSetStartDate:function(L,X,Y){var A=j.clone(L.get(br));j.copyHours(A,Y);L.set(br,A);},_setColor:function(L){var A=this;A[K]=a3.rgb2hsb(a3.getRGB(L));A[V]=aO.clone(A[K]);A[V].b*=A.get(a1);A[V].s*=A.get(bi);A[aT]=a3.hsb2rgb(A[V]);return L;},_setContent:function(X,bF,L){var A=this;var Y=A[X];if(Y){Y.setContent(bF);}if(L){A.eachRepeatedEvent(function(bG,bH){bG[X].setContent(bF);});}},_setDate:function(L){var A=this;if(ag(L)){L=new Date(L);}return L;},_setRepeat:function(L){var A=this;if(bo(L)){L=aO.SchedulerEventRepeat[L];}return J(L)?L:null;},_setScheduler:function(X){var A=this;var L=A.get(aj);if(L){A.removeTarget(L);}A.addTarget(X);return X;},_syncUIAttrs:function(){var A=this;A._uiSetDisabled(A.get(y));A._uiSetVisible(A.get(au));A._uiSetParentEvent(A.get(aQ));A._uiSetRepeat(A.get(aS));},_formatDate:function(X,Y){var L=this;var A=L.get(bu);Y=Y||L.get(e);return aO.DataType.Date.format(X,{format:Y,locale:A});},_getTitleDateFormat:function(X){var A=this;if(!bo(X)){var L=A.get(aj);X=(L&&L.get(S).get(a2))?d:bb;}return X;},_uiSetDisabled:function(L){var A=this;A.get(p).toggleClass(bl,!!L);A.get(k).toggleClass(bl,!!L);},_uiSetParentEvent:function(L){var A=this;A.get(p).toggleClass(aF,!!L);A.get(k).toggleClass(aF,!!L);},_uiSetRepeat:function(X){var A=this;var L=!!X&&X!==aO.SchedulerEventRepeat[a4];A.get(p).toggleClass(aq,L);A.get(k).toggleClass(aq,L);},_uiSetVisible:function(L){var A=this;A.get(p).toggleClass(E,!L);A.get(k).toggleClass(E,!L);}}});aO.SchedulerEvent=Z;aO.SchedulerEventRepeat={never:{description:"Never repeat",validate:function(A,L){return false;},value:"never"},daily:{description:"Every day",validate:function(A,L){return true;},value:"daily"},monthly:{description:"Every month",validate:function(L,X){var Y=L.get(aU);var A=L.get(br);return(A.getDate()===X.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,L){return j.isMonWedOrFri(L);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,L){return j.isTueOrThu(L);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,L){return j.isWeekDay(L);},value:"weekDays"},weekly:{description:"Every week",validate:function(L,X){var Y=L.get(aU);var A=L.get(br);return(A.getDay()===X.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(L,X){var Y=L.get(aU);var A=L.get(br);return((A.getMonth()===X.getMonth())&&(A.getDay()===X.getDay()));},value:"yearly"}};var aA=aO.Lang,a=aA.isArray,J=aA.isObject,S="activeView",c="arrow",aZ="body",aE="bodyContent",q="boundingBox",aD="cancel",a7="click",aK="content",aY="date",aL="dateFormat",an="delete",bf="description",T="edit",bz="event",aX="eventClass",D="footerContent",aI="form",C="header",w="hide",a2="isoTime",aJ="link",p="node",Q="offsetHeight",bm="offsetWidth",h="overlay",U="overlayOffset",bA="recorder",bw="rendered",aS="repeat",a9="save",aj="scheduler",o="schedulerChange",az="scheduler-event",aB="scheduler-event-recorder",aH="shadow",aG="show",H="startDateChange",P="strings",bc="template",a0="title",by="tl",af="toolbar",bq="submit",bs="value",aW="visibleChange",ac="when",ap="x",ao="y",ai="cancel",O="delete",B="edit",aN="save",bB="-",g=".",ah="",i="#",t=aO.IO.prototype._serialize,G=aO.getClassName,u=G(aj,bz),at=G(aj,bz,bA),bC=G(aj,bz,bA,h),z=G(aj,bz,bA,h,c),bk=G(aj,bz,bA,h,c,aH),am=G(aj,bz,bA,h,aZ),bd=G(aj,bz,bA,h,aK),al=G(aj,bz,bA,h,aY),W=G(aj,bz,bA,h,aI),bE=G(aj,bz,bA,h,C),aa=G(aj,bz,bA,h,aJ),aw=G(aj,bz,bA,h,aS),F=G(aj,bz,a0),N=new aO.Template('<div class="',bk," ",z,'"></div>','<div class="',z,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bE,'">','<input class="',bd,'" name="content" value="{content}" />',"</div>",'<div class="',am,'">','<label class="',al,'">{date}</label>','<select class="',aw,'" name="repeat">','<tpl for="eventRepeat">','<option {[ (parent.repeat && parent.repeat.value) == parent.eventRepeat[$i].value ? \'selected="selected"\' : "" ]} value="{value}">{description}</option>',"</tpl>","</select>","</div>"),ae='<a class="'+aa+'" href="javascript:;">{delete}</a>',bD='<form class="'+W+'" id="schedulerEventRecorderForm"></form>';var ab=aO.Component.create({NAME:aB,ATTRS:{content:{value:ah},duration:{value:60},dateFormat:{validator:bo,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aO.SchedulerEvent;}},strings:{value:{},setter:function(A){return aO.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",save:"Save",when:"When"},A||{});},validator:J},overlay:{validator:J,value:{align:{points:[by,by]},visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:a},template:{value:N},toolbar:{setter:function(X){var L=this;
var A=L.get(P);return aO.merge({children:[{handler:aO.bind(L._handleSaveEvent,L),label:A[a9]},{handler:aO.bind(L._handleCancelEvent,L),label:A[aD]}]},X||{});},validator:J,value:{}}},EXTENDS:aO.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(p).addClass(at);A.publish(ai,{defaultFn:A._defCancelEventFn});A.publish(O,{defaultFn:A._defDeleteEventFn});A.publish(B,{defaultFn:A._defEditEventFn});A.publish(aN,{defaultFn:A._defSaveEventFn});A.after(o,A._afterSchedulerChange);A[h]=new aO.Overlay(A.get(h));A[af]=new aO.Toolbar(A.get(af));},_afterSchedulerChange:function(Y){var A=this;var X=Y.newVal;var L=X.get(q);L.delegate(a7,aO.bind(A._onClickSchedulerEvent,A),g+u);},_defCancelEventFn:function(L){var A=this;A.get(p).remove();A.hideOverlay();},_defDeleteEventFn:function(X){var A=this;var L=A.get(aj);L.removeEvent(A.get(bz));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(X){var A=this;var L=A.get(aj);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(X){var A=this;var L=A.get(aj);L.addEvent(X.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ai);L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bz)?B:aN,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickDelete:function(){var A=this;A.fire(O,{schedulerEvent:A.get(bz)});},_onClickSchedulerEvent:function(X){var A=this;var L=X.currentTarget.getData(az);if(L){A.set(bz,L);A.showOverlay([X.pageX,X.pageY]);A.get(p).remove();}},_onOverlayVisibleChange:function(Y){var L=this;if(Y.newVal){L.populateForm();if(!L.get(bz)){var X=L[h].get(q);var A=X.one(g+bd);setTimeout(function(){A.selectText();},0);L.deleteNode.hide();}else{L.deleteNode.show();}}else{L.set(bz,null);L.get(p).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(P);L[h].render();L[af].render();var X=L[h].get(q);X.addClass(bC);L[h].set(D,L[af].get(q));L[h].on(aW,aO.bind(L._onOverlayVisibleChange,L));L.deleteNode=aO.Node.create(aA.sub(ae,{"delete":A[an]}));L[h].footerNode.append(L.deleteNode);L.formNode=aO.Node.create(bD);L[h].set(aE,L.formNode);L.deleteNode.on(a7,aO.bind(L._onClickDelete,L));L.formNode.on(bq,aO.bind(L._onSubmitForm,L));},getEventCopy:function(){var A=this;var X=A.get(bz);if(!X){X=new (A.get(aX))({endDate:A.get(aU),scheduler:A.get(aj),startDate:A.get(br)});X.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();X.set(aK,L[aK]);X.set(aS,L[aS]);return X;},getFormattedDate:function(){var X=this;var L=X.get(aL);var bF=(X.get(bz)||X);var bH=bF.get(aU);var bG=bF.get(aj);var A=bF.get(br);var Y=(bG.get(S).get(a2)?j.toIsoTimeString:j.toUsTimeString);return[bF._formatDate(A,L),Y(A),bj,Y(bH)].join(s);},getTemplateData:function(){var L=this;var A=L.get(P);var X=(L.get(bz)||L);return{content:X.get(aK)||A["description-hint"],date:L.getFormattedDate(),endDate:X.get(aU).getTime(),eventRepeat:L.eventRepeatArray,repeat:X.get(aS),startDate:X.get(br).getTime()};},hideOverlay:function(){var A=this;A[h].hide();},populateForm:function(){var A=this;if(!A.eventRepeatArray){A.eventRepeatArray=[];aO.each(aO.SchedulerEventRepeat,function(L){A.eventRepeatArray.push({description:L[bf],value:L[bs]});});}A.formNode.setContent(A.get(bc).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aO.QueryString.parse(t(A.formNode.getDOM()));},showOverlay:function(Y,bG){var A=this;var X=A.get(U);if(!A[h].get(bw)){A._renderOverlay();}A[h].show();if(!Y){var L=(A.get(bz)||A).get(p);var bF=L.one(g+F);bG=[X[0]+bF.get(bm),X[1]+bF.get(Q)/2];Y=bF.getXY();}bG=bG||X;Y[0]+=bG[0];Y[1]+=bG[1];A[h].set("xy",Y);}}});aO.SchedulerEventRecorder=ab;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});