AUI.add("aui-scheduler-event",function(aM){var ap=aM.Lang,bm=ap.isString,f=ap.isDate,bb=ap.isFunction,I=ap.isObject,bf=ap.isBoolean,ae=ap.isNumber,a0=aM.ColorUtil,j=aM.DataType.DateMath,a7=aM.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),bh="-",t="&ndash;",aA=".",p="",q=" ",l="_",aO="_propagateSet",S="activeView",y="all",V="borderColor",aQ="borderColorRGB",aK="borderStyle",bt="borderWidth",K="Change",a5="color",aY="colorBrightnessFactor",bg="colorSaturationFactor",aI="content",be="day",w="disabled",a2="duration",aR="endDate",aU="eventClass",at="eventStack",bn="events",aw="hidden",J="hsbColor",av="icon",ac="icons",a3="id",ak="inherit",aZ="isoTime",bs="locale",a1="never",n="node",h="overlay",aN="parentEvent",by="recorder",aP="repeat",bl="repeated",R="repeatedEvents",bd="repeater",ah="scheduler",ax="scheduler-event",az="scheduler-event-recorder",bp="startDate",a9="template",aX="title",e="titleDateFormat",aq="visible",d="%H:%M",a8="%I:%M",G=aM.getClassName,k=G(av),s=G(ax),F=G(ax,y,be),aS=G(ax,aI),D=G(ax,aw),bj=G(ax,w),ar=G(ax,by),aD=G(ax,bl),ao=G(ax,bd),E=G(ax,aX),br=G(ax,ac),v=G(ax,av,w),b=G(ax,av,bl),bv=G(ax,av,bd);var Z=aM.Component.create({NAME:ax,ATTRS:{allDay:{setter:aM.DataType.Boolean.parse,value:false},borderStyle:{value:"solid",validator:bm},borderWidth:{value:"1px",validator:bm},colorBrightnessFactor:{value:0.75,validator:ae},colorSaturationFactor:{value:1.5,validator:ae},content:{value:"(no title)",validator:bm},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bm},titleDateFormat:{getter:"_getTitleDateFormat",value:function(){var A=this;var Y=A.get(M);var L=A.get(ah);var X=L&&L.get(S).get(aZ);var bE=X?d:a8;var bD={endDate:bh+q+bE,startDate:bE};if(A.getMinutesDuration()<=30){delete bD.endDate;}else{if(Y){bD={};}}return bD;}},endDate:{setter:"_setDate",valueFn:function(){var A=j.clone(this.get(bp));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aM.SchedulerEvent;}},disabled:{value:false,validator:bf},node:{valueFn:function(){return aM.NodeList.create(aM.Node.create(this.EVENT_NODE_TEMPLATE).setData(ax,this));}},parentEvent:{},repeat:{value:p,setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:bf}},EXTENDS:aM.Base,PROPAGATE_ATTRS:[bp,aR,aI,a5,aY,bg,aK,bt,e,aq,w],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+s+'">'+'<div class="'+E+'"></div>'+'<div class="'+aS+'"></div>'+'<div class="'+br+'">'+'<span class="'+[k,b].join(q)+'"></span>'+'<span class="'+[k,bv].join(q)+'"></span>'+'<span class="'+[k,v].join(q)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var L=A.get(n);A[at]={};aM.Array.each(A.get(aU).PROPAGATE_ATTRS,function(X){A.after(X+K,A._propagateAttrChange);});A._bindUIAttrs();A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(L,X){L.destroy();});A[at]={};A.get(n).remove(true);},addPaddingNode:function(){var A=this;A.get(n).push(aM.Node.create(A.EVENT_NODE_TEMPLATE).setData(ax,A));A.syncNodeUI();},copyDates:function(L){var A=this;A.set(aR,j.clone(L.get(aR)));A.set(bp,j.clone(L.get(bp)));},copyPropagateAttrValues:function(L,X){var A=this;A.copyDates(L);aM.Array.each(A.get(aU).PROPAGATE_ATTRS,function(Y){if(!((X||{}).hasOwnProperty(Y))){var bD=L.get(Y);if(!I(bD)){A.set(Y,bD);}}});},getBorderColor:function(){var A=this;return A[aQ].hex;},getDaysDuration:function(){var A=this;return j.getDayOffset(A.get(aR),A.get(bp));},getHoursDuration:function(){var A=this;return j.getHoursOffset(A.get(aR),A.get(bp));},getMinutesDuration:function(){var A=this;return j.getMinutesOffset(A.get(aR),A.get(bp));},getSecondsDuration:function(){var A=this;return j.getSecondsOffset(A.get(aR),A.get(bp));},sameEndDate:function(L){var A=this;return j.compare(A.get(aR),L.get(aR));},sameStartDate:function(L){var A=this;return j.compare(A.get(bp),L.get(bp));},isAfter:function(Y){var X=this;var L=X.get(bp);var A=Y.get(bp);return j.after(L,A);},isBefore:function(Y){var X=this;var L=X.get(bp);var A=Y.get(bp);return j.before(L,A);},repeatByDate:function(X){var L=this;var Y=L.uidByDate(X);if(!L[at][Y]){var A=j.clone(X);var bE=j.clone(X);j.copyHours(A,L.get(bp));j.copyHours(bE,L.get(aR));var bD=new L.get(aU)({endDate:bE,parentEvent:L,scheduler:L.get(ah),startDate:A});bD.copyPropagateAttrValues(L);L[at][Y]=bD;}return L[at][Y];},intersects:function(Y){var X=this;var bD=X.get(aR);var L=X.get(bp);var A=Y.get(bp);return(X.sameStartDate(Y)||j.between(A,L,bD));},intersectHours:function(X){var L=this;var bD=L.get(aR);var A=L.get(bp);var Y=j.clone(A);j.copyHours(Y,X.get(bp));return(j.compare(A,Y)||j.between(Y,A,bD));},isDayBoundaryEvent:function(){var A=this;return j.isDayBoundary(A.get(bp),A.get(aR));},isDayOverlapEvent:function(){var A=this;return j.isDayOverlap(A.get(bp),A.get(aR));},isRepeatableDate:function(L){var A=this;var X=A.get(aP);return(X&&X.validate(A,L));},getClearEndDate:function(){var A=this;return j.safeClearTime(A.get(aR));},getClearStartDate:function(){var A=this;return j.safeClearTime(A.get(bp));},move:function(L){var A=this;var X=A.getMinutesDuration();A.set(bp,L);A.set(aR,j.add(j.clone(L),j.MINUTES,X));},uidByDate:function(L){var A=this;L=f(L)?j.safeClearTime(L):A.getClearStartDate();return[ax,L.getTime()].join(l);},setContent:function(X,L){var A=this;A.get(n).each(function(bD){var Y=bD.one(g+aS);Y.setContent(X);});if(L){A.eachRepeatedEvent(function(Y,bD){Y.setContent(X);});}},setTitle:function(X,L){var A=this;A.get(n).each(function(Y){var bD=Y.one(g+E);bD.setContent(X);});if(L){A.eachRepeatedEvent(function(Y,bD){Y.setTitle(X);});}},syncNodeUI:function(L){var A=this;A._syncUIAttrs();A.syncNodeColorUI(L);A.syncNodeTitleUI(L);A.syncNodeContentUI(L);},syncNodeColorUI:function(L){var A=this;var Y=A.get(n);var bD=A.getBorderColor();if(Y){var X={borderWidth:A.get(bt),borderColor:bD,backgroundColor:A.get(a5),borderStyle:A.get(aK),color:ak};Y.setStyles(X);}if(L){A.eachRepeatedEvent(function(bE,bF){bE.syncNodeColorUI();
});}},syncNodeContentUI:function(L){var A=this;A.setContent(A.get(aI),L);},syncNodeTitleUI:function(L){var A=this;var X=A.get(e);var Y=[];if(X.startDate){Y.push(A._formatDate(A.get(bp),X.startDate));}if(X.endDate){Y.push(A._formatDate(A.get(aR),X.endDate));}A.setTitle(Y.join(q),L);},split:function(){var A=this,X=j.clone(A.get(bp)),Y=j.clone(A.get(aR));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=j.clone(X);L.setHours(24,0,0,0);return[[X,j.toMidnight(j.clone(X))],[L,j.clone(Y)]];}return[[X,Y]];},eachRepeatedEvent:function(L){var A=this;aM.each(A[at],L,A);},unlink:function(){var A=this;if(A.get(aN)){A.set(aN,null);}else{A.eachRepeatedEvent(function(L,X){L.unlink();});}A[at]={};A.syncNodeUI();},_afterAllDayChange:function(L){var A=this;A._uiSetAllDay(L.newVal);},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_afterRepeatChange:function(L){var A=this;A._uiSetRepeat(L.newVal);},_afterParentEventChange:function(L){var A=this;A._uiSetParentEvent(L.newVal);},_bindUIAttrs:function(){var A=this;A.after({allDayChange:A._afterAllDayChange,disabledChange:A._afterDisabledChange,parentEventChange:A._afterParentEventChange,repeatChange:A._afterRepeatChange,visibleChange:A._afterVisibleChange});A._syncUIAttrs();},_propagateAttrChange:function(Y){var A=this;var X=Y.attrName;var L=Y.newVal;A.eachRepeatedEvent(function(bD,bE){var bF=bD[aO+a7(X)];if(bF){bF.apply(A,[bD,X,L]);}else{bD.set(X,Y.newVal);}bD.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,L,Y){var X=j.clone(A.get(aR));j.copyHours(X,Y);A.set(aR,X);},_propagateSetStartDate:function(L,X,Y){var A=j.clone(L.get(bp));j.copyHours(A,Y);L.set(bp,A);},_setColor:function(L){var A=this;A[J]=a0.rgb2hsb(a0.getRGB(L));A[V]=aM.clone(A[J]);A[V].b*=A.get(aY);A[V].s*=A.get(bg);A[aQ]=a0.hsb2rgb(A[V]);return L;},_setDate:function(L){var A=this;if(ae(L)){L=new Date(L);}return L;},_setRepeat:function(L){var A=this;if(bm(L)){L=aM.SchedulerEventRepeat[L];}return I(L)?L:null;},_setScheduler:function(X){var A=this;var L=A.get(ah);if(L){A.removeTarget(L);}A.addTarget(X);return X;},_syncUIAttrs:function(){var A=this;A._uiSetAllDay(A.get(M));A._uiSetDisabled(A.get(w));A._uiSetVisible(A.get(aq));A._uiSetParentEvent(A.get(aN));A._uiSetRepeat(A.get(aP));},_formatDate:function(X,Y){var L=this;var A=L.get(bs);return aM.DataType.Date.format(X,{format:Y,locale:A});},_getTitleDateFormat:function(L){var A=this;if(bm(L)){L={endDate:L,startDate:L};}else{if(bb(L)){L=L.call(A);}}return L;},_uiSetAllDay:function(L){var A=this;A.get(n).toggleClass(F,!!L);},_uiSetDisabled:function(L){var A=this;A.get(n).toggleClass(bj,!!L);},_uiSetParentEvent:function(L){var A=this;A.get(n).toggleClass(aD,!!L);},_uiSetRepeat:function(X){var A=this;var L=!!X&&X!==aM.SchedulerEventRepeat[a1];A.get(n).toggleClass(ao,L);},_uiSetVisible:function(L){var A=this;A.get(n).toggleClass(D,!L);}}});aM.SchedulerEvent=Z;aM.SchedulerEventRepeat={never:{description:"Never repeat",validate:function(A,L){return false;},value:"never"},daily:{description:"Every day",validate:function(A,L){return true;},value:"daily"},monthly:{description:"Every month",validate:function(L,X){var Y=L.get(aR);var A=L.get(bp);return(A.getDate()===X.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,L){return j.isMonWedOrFri(L);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,L){return j.isTueOrThu(L);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,L){return j.isWeekDay(L);},value:"weekDays"},weekly:{description:"Every week",validate:function(L,X){var Y=L.get(aR);var A=L.get(bp);return(A.getDay()===X.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(L,X){var Y=L.get(aR);var A=L.get(bp);return((A.getMonth()===X.getMonth())&&(A.getDay()===X.getDay()));},value:"yearly"}};var ay=aM.Lang,a=ay.isArray,I=ay.isObject,S="activeView",M="allDay",c="arrow",aW="body",aC="bodyContent",o="boundingBox",aB="cancel",a4="click",aI="content",aV="date",aJ="dateFormat",al="delete",bc="description",T="edit",bx="event",aU="eventClass",C="footerContent",aG="form",B="header",u="hide",aZ="isoTime",aH="link",n="node",Q="offsetHeight",bk="offsetWidth",h="overlay",U="overlayOffset",by="recorder",bu="rendered",aP="repeat",a6="save",ah="scheduler",m="schedulerChange",ax="scheduler-event",az="scheduler-event-recorder",aF="shadow",aE="show",H="startDateChange",P="strings",a9="template",aX="title",bw="tl",ad="toolbar",bo="submit",bq="value",aT="visibleChange",ab="when",an="x",am="y",ag="cancel",O="delete",z="edit",aL="save",bz="-",g=".",af="",i="#",r=aM.IO.prototype._serialize,G=aM.getClassName,s=G(ah,bx),ar=G(ah,bx,by),bA=G(ah,bx,by,h),x=G(ah,bx,by,h,c),bi=G(ah,bx,by,h,c,aF),aj=G(ah,bx,by,h,aW),ba=G(ah,bx,by,h,aI),ai=G(ah,bx,by,h,aV),W=G(ah,bx,by,h,aG),bC=G(ah,bx,by,h,B),au=G(ah,bx,by,h,aP),E=G(ah,bx,aX),N=new aM.Template('<div class="',bi," ",x,'"></div>','<div class="',x,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bC,'">','<input class="',ba,'" name="content" value="{content}" />',"</div>",'<div class="',aj,'">','<label class="',ai,'">{date}</label>','<select class="',au,'" name="repeat">','<tpl for="eventRepeat">','<option {[ (parent.repeat && parent.repeat.value) == parent.eventRepeat[$i].value ? \'selected="selected"\' : "" ]} value="{value}">{description}</option>',"</tpl>","</select>","</div>"),bB='<form class="'+W+'" id="schedulerEventRecorderForm"></form>';var aa=aM.Component.create({NAME:az,ATTRS:{allDay:{value:false},content:{value:af},duration:{value:60},dateFormat:{validator:bm,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aM.SchedulerEvent;}},minDuration:{value:30},strings:{value:{},setter:function(A){return aM.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",save:"Save",when:"When"},A||{});
},validator:I},overlay:{validator:I,value:{align:{points:[bw,bw]},visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:a},template:{value:N},toolbar:{setter:function(X){var L=this;var A=L.get(P);return aM.merge({children:[{handler:aM.bind(L._handleSaveEvent,L),label:A[a6]},{handler:aM.bind(L._handleCancelEvent,L),label:A[aB]},{handler:aM.bind(L._handleDeleteEvent,L),label:A[al]}]},X||{});},validator:I,value:{}}},EXTENDS:aM.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(n).addClass(ar);A.publish(ag,{defaultFn:A._defCancelEventFn});A.publish(O,{defaultFn:A._defDeleteEventFn});A.publish(z,{defaultFn:A._defEditEventFn});A.publish(aL,{defaultFn:A._defSaveEventFn});A.after(m,A._afterSchedulerChange);A[h]=new aM.Overlay(A.get(h));A[ad]=new aM.Toolbar(A.get(ad));},_afterSchedulerChange:function(Y){var A=this;var X=Y.newVal;var L=X.get(o);L.delegate(a4,aM.bind(A._onClickSchedulerEvent,A),g+s);},_defCancelEventFn:function(L){var A=this;A.get(n).remove();A.hideOverlay();},_defDeleteEventFn:function(X){var A=this;var L=A.get(ah);L.removeEvent(A.get(bx));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(X){var A=this;var L=A.get(ah);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(X){var A=this;var L=A.get(ah);L.addEvent(X.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(ag);L.preventDefault();},_handleDeleteEvent:function(L){var A=this;A.fire(O,{schedulerEvent:A.get(bx)});L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bx)?z:aL,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickSchedulerEvent:function(X){var A=this;var L=X.currentTarget.getData(ax);if(L){A.set(bx,L);A.showOverlay([X.pageX,X.pageY]);A.get(n).remove();}},_onOverlayVisibleChange:function(Y){var L=this;if(Y.newVal){L.populateForm();if(!L.get(bx)){var X=L[h].get(o);var A=X.one(g+ba);setTimeout(function(){A.selectText();},0);}}else{L.set(bx,null);L.get(n).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(P);L[h].render();L[ad].render();var X=L[h].get(o);X.addClass(bA);L[h].set(C,L[ad].get(o));L[h].on(aT,aM.bind(L._onOverlayVisibleChange,L));L.formNode=aM.Node.create(bB);L[h].set(aC,L.formNode);L.formNode.on(bo,aM.bind(L._onSubmitForm,L));},getEventCopy:function(){var A=this;var X=A.get(bx);if(!X){X=new (A.get(aU))({allDay:A.get(M),endDate:A.get(aR),scheduler:A.get(ah),startDate:A.get(bp)});X.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();X.set(aI,L[aI]);X.set(aP,L[aP]);return X;},getFormattedDate:function(){var X=this;var L=X.get(aJ);var bD=(X.get(bx)||X);var bF=bD.get(aR);var bE=bD.get(ah);var A=bD.get(bp);var Y=(bE.get(S).get(aZ)?j.toIsoTimeString:j.toUsTimeString);return[bD._formatDate(A,L),Y(A),bh,Y(bF)].join(q);},getTemplateData:function(){var L=this;var A=L.get(P);var X=(L.get(bx)||L);return{content:X.get(aI)||A["description-hint"],date:L.getFormattedDate(),endDate:X.get(aR).getTime(),eventRepeat:L.eventRepeatArray,repeat:X.get(aP),startDate:X.get(bp).getTime()};},hideOverlay:function(){var A=this;A[h].hide();},populateForm:function(){var A=this;if(!A.eventRepeatArray){A.eventRepeatArray=[];aM.each(aM.SchedulerEventRepeat,function(L){A.eventRepeatArray.push({description:L[bc],value:L[bq]});});}A.formNode.setContent(A.get(a9).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aM.QueryString.parse(r(A.formNode.getDOM()));},showOverlay:function(Y,bE){var A=this;var X=A.get(U);if(!A[h].get(bu)){A._renderOverlay();}A[h].show();if(!Y){var L=(A.get(bx)||A).get(n);var bD=L.one(g+E);bE=[X[0]+bD.get(bk),X[1]+bD.get(Q)/2];Y=bD.getXY();}bE=bE||X;Y[0]+=bE[0];Y[1]+=bE[1];A[h].set("xy",Y);}}});aM.SchedulerEventRecorder=aa;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});