AUI.add("aui-scheduler-base",function(ab){var O=ab.Lang,av=O.isString,a=O.isArray,d=O.isDate,I=O.isNumber,B=O.isObject,H=function(A){return(A instanceof ab.Scheduler);},s=function(A){return(A instanceof ab.SchedulerView);},Z=function(A){return(A instanceof ab.SchedulerEvent);},t=function(A){return(ab.SchedulerCalendar&&(A instanceof ab.SchedulerCalendar));},h=ab.DataType.DateMath,V=ab.WidgetStdMod,T=".",o="",p=" ",r="scheduler-base",ah="data-view-name",F="activeView",au="clearfix",E="controls",aj="controlsNode",am="current",aa="currentDate",X="currentDateNode",ai="date",af="endDate",ag="eventClass",aw="events",aB="hd",v="header",at="headerNode",m="helper",R="icon",j="iconNextNode",ap="iconPrevNode",az="locale",l="name",P="nav",M="navNode",ao="navigationDateFormat",n="next",c="nextDate",ar="prev",ak="prevDate",aA="rendered",L="scheduler",ax="startDate",D="strings",e="today",ac="todayNode",u="triggerNode",y="view",N="viewStack",aC="views",W="viewsNode",z=ab.getClassName,ad=z(m,au),i=z(R),an=z(r,E),S=z(r,am,ai),f=z(r,aB),U=z(r,R,n),C=z(r,R,ar),ay=z(r,P),x=z(r,e),Y=z(r,y),g=z(r,y,o),q=z(r,aC),al='<div class="'+an+'"></div>',w='<div class="'+S+'"></div>',b='<div class="'+f+'"></div>',aD='<a href="#" class="'+[i,U].join(p)+'">Next</a>',ae='<a href="#" class="'+[i,C].join(p)+'">Prev</a>',k='<div class="'+ay+'"></div>',Q='<a href="#" class="'+x+'">{today}</a>',aq='<a href="#" class="'+[Y,g].join(p)+'{name}" data-view-name="{name}">{label}</a>',J='<div class="'+q+'"></div>';var K=function(){};K.ATTRS={eventClass:{valueFn:function(){return ab.SchedulerEvent;}},events:{value:[],setter:"_setEvents",validator:a}};ab.mix(K.prototype,{addEvent:function(aE){var A=this;var aF=A.get(aw);if(ab.Array.indexOf(aF,aE)>-1){ab.Array.removeItem(aF,aE);}aF.push(aE);A.set(aw,aF);},addEvents:function(aE){var A=this;ab.Array.each(A._normalizeEvents(aE),ab.bind(A.addEvent,A));},eachEvent:function(aF){var A=this;var aE=A.get(aw);ab.Array.each(aE,aF,A);},removeEvent:function(aE){var A=this;var aF=A.get(aw);if(aF.length){ab.Array.removeItem(aF,aE);A.set(aw,aF);}},removeEvents:function(aE){var A=this;ab.Array.each(A._normalizeEvents(aE),ab.bind(A.removeEvent,A));},_normalizeEvents:function(aF){var A=this;var aE=[];aF=ab.Array(aF);ab.Array.each(aF,function(aG){if(Z(aG)){aE.push(aG);}else{if(t(aG)){if(H(A)){aG.set(L,A);}aE=aE.concat(A._normalizeEvents(aG.get(aw)));}else{aG=new (A.get(ag))(aG);aE.push(aG);}}if(H(A)){aG.set(L,A);aG.set(ag,A.get(ag));}});return aE;},_setEvents:function(aE){var A=this;return A._normalizeEvents(aE);}});ab.SchedulerEventSupport=K;var G=ab.Component.create({NAME:r,ATTRS:{activeView:{validator:s},eventRecorder:{setter:"_setEventRecorder"},strings:{value:{day:"Day",month:"Month",today:"Today",week:"Week",year:"Year"}},navigationDateFormat:{getter:function(aF){var A=this;var aE=A.get(F);if(aE){return aE.get(ao);}return aF;},value:"%A - %d %b %Y",validator:av},views:{setter:"_setViews",value:[]},currentDate:{valueFn:function(){return new Date();},validator:d},firstDayOfWeek:{value:0,validator:I},controlsNode:{valueFn:function(){return ab.Node.create(al);}},currentDateNode:{valueFn:function(){return ab.Node.create(w);}},headerNode:{valueFn:function(){return ab.Node.create(b);}},iconNextNode:{valueFn:function(){return ab.Node.create(aD);}},iconPrevNode:{valueFn:function(){return ab.Node.create(ae);}},navNode:{valueFn:function(){return ab.Node.create(k);}},todayNode:{valueFn:function(){return ab.Node.create(this._processTemplate(Q));}},viewsNode:{valueFn:function(){return ab.Node.create(J);}}},HTML_PARSER:{controlsNode:T+an,currentDateNode:T+S,headerNode:T+f,iconNextNode:T+U,iconPrevNode:T+C,navNode:T+ay,todayNode:T+x,viewsNode:T+q},UI_ATTRS:[aa],AUGMENTS:[ab.SchedulerEventSupport,ab.WidgetStdMod],prototype:{viewStack:null,initializer:function(){var A=this;A[N]={};A[aj]=A.get(aj);A[X]=A.get(X);A[v]=A.get(at);A[j]=A.get(j);A[ap]=A.get(ap);A[M]=A.get(M);A[ac]=A.get(ac);A[W]=A.get(W);A.after({activeViewChange:A._afterActiveViewChange,render:A._afterRender});},bindUI:function(){var A=this;A._bindDelegate();},syncUI:function(){var A=this;A.syncStdContent();},flushEvents:function(){var A=this;ab.Array.each(A.get(aw),function(aE){aE.eachRepeatedEvent(function(aF){delete aF._filtered;});delete aE._filtered;});},getEventsByDay:function(aE,aF){var A=this;aE=h.safeClearTime(aE);return A._getEvents(aE,function(aG){return h.compare(aG.getClearStartDate(),aE)||(aF&&h.compare(aG.getClearEndDate(),aE));});},getIntersectEvents:function(aE){var A=this;aE=h.safeClearTime(aE);return A._getEvents(aE,function(aG){var aF=aG.getClearStartDate();var aH=aG.getClearEndDate();return(h.compare(aE,aF)||h.compare(aE,aH)||h.between(aE,aF,aH));});},sortEventsByDateAsc:function(aE){var A=this;aE.sort(function(aI,aG){var aH=aI.get(af);var aF=aG.get(af);var aK=aI.get(ax);var aJ=aG.get(ax);if(h.after(aK,aJ)||(h.compare(aK,aJ)&&h.before(aH,aF))){return 1;}else{return -1;}});},getViewByName:function(aE){var A=this;return A[N][aE];},getStrings:function(){var A=this;return A.get(D);},getString:function(aE){var A=this;return A.getStrings()[aE];},renderView:function(aE){var A=this;if(aE){aE.show();if(!aE.get(aA)){if(!A.bodyNode){A.setStdModContent(V.BODY,o);}aE.render(A.bodyNode);}}},plotViewEvents:function(aE){var A=this;aE.plotEvents(A.get(aw));},syncEventsUI:function(){var A=this;A.plotViewEvents(A.get(F));},_afterActiveViewChange:function(aG){var aE=this;if(aE.get(aA)){var aF=aG.newVal;var A=aG.prevVal;if(A){A.hide();}aE.renderView(aF);}},_afterRender:function(aE){var A=this;A.renderView(A.get(F));},_bindDelegate:function(){var A=this;A[W].delegate("click",A._onClickViewTrigger,T+Y,A);A[aj].delegate("click",A._onClickPrevIcon,T+C,A);A[aj].delegate("click",A._onClickNextIcon,T+U,A);A[aj].delegate("click",A._onClickToday,T+x,A);},_createViewTriggerNode:function(aE){var A=this;if(!aE.get(u)){var aF=aE.get(l);aE.set(u,ab.Node.create(O.sub(aq,{name:aF,label:(A.getString(aF)||aF)})));}return aE.get(u);},_getEvents:function(aE,aH){var A=this;var aG=A.get(aw);
var aF=[];ab.Array.each(aG,function(aI){if(aH.apply(A,[aI])){aF.push(aI);}else{if(aI.isRepeatableDate(aE)){var aJ=aI.repeatByDate(aE);aF.push(aJ);}}});A.sortEventsByDateAsc(aF);return aF;},_onClickToday:function(aE){var A=this;A.set(aa,A.get(F).getToday());aE.preventDefault();},_onClickNextIcon:function(aE){var A=this;A.set(aa,A.get(F).get(c));aE.preventDefault();},_onClickPrevIcon:function(aE){var A=this;A.set(aa,A.get(F).get(ak));aE.preventDefault();},_onClickViewTrigger:function(aE){var A=this;var aF=aE.currentTarget.attr(ah);A.set(F,A.getViewByName(aF));aE.preventDefault();},_processTemplate:function(aE){var A=this;return O.sub(aE,A.getStrings());},_setEventRecorder:function(aE){var A=this;if(aE){aE.set(L,A);aE.set(ag,A.get(ag));}},_setViews:function(aF){var A=this;var aE=[];ab.Array.each(aF,function(aG){if(s(aG)&&!aG.get(aA)){aG.set(L,A);aG.set(ag,A.get(ag));aE.push(aG);A[N][aG.get(l)]=aG;}});if(!A.get(F)){A.set(F,aF[0]);}return aE;},syncStdContent:function(){var A=this;var aE=A.get(aC);A[M].append(A[ap]);A[M].append(A[j]);A[aj].append(A[ac]);A[aj].append(A[M]);A[aj].append(A[X]);ab.Array.each(aE,function(aF){A[W].append(A._createViewTriggerNode(aF));});A[v].append(A[aj]);A[v].append(A[W]);A[v].addClass(ad);A.setStdModContent(V.HEADER,A[v].getDOM());},_uiSetCurrentDate:function(aG){var A=this;var aF=ab.DataType.Date.format(aG,{format:A.get(ao),locale:A.get(az)});A[X].html(aF);if(A.get(aA)){var aE=A.get(F);if(aE){aE._uiSetCurrentDate(aG);}A.syncEventsUI();}}}});ab.Scheduler=G;},"@VERSION@",{skinnable:true,requires:["aui-scheduler-view","datasource"]});AUI.add("aui-scheduler-view",function(ci){var cv=ci.Lang,cJ=cv.isObject,b9=cv.isString,a3=cv.isBoolean,aI=cv.isNumber,bX=function(A){return parseFloat(A)||0;},b0=function(cO,A){return Math.round(cO/A)*A;},au=ci.DataType.DateMath,ce=ci.WidgetStdMod,aQ=au.WEEK_LENGTH,b2="scheduler-view",aH="scheduler-view-day",cm="scheduler-view-week",cC="scheduler-view-month",bi="activeColumn",bW="activeView",aW="boundingBox",cM="cancel",aj="col",aA="colDaysNode",ck="colHeaderDaysNode",I="colblank",w="coldata",aK="colday",a="colgrid",X="colspan",m="coltime",bw="columnData",a2="columnDayHeader",aN="columnShims",aU="columnTableGrid",bo="columnTime",aT="container",aR="content",bh="creationEndDate",aa="creationStartDate",bm="currentDate",bJ="data",cs="day",U="days",B="delegateConfig",bU="disabled",Y="div",bv="division",cE="dotted",ad="down",E="draggingEvent",b8="duration",aD="endDate",bb="event",cD="eventClass",bT="eventPlaceholder",cL="eventRecorder",q="eventWidth",aJ="first",cn="firstDayOfWeek",bk="grid",bG="gridContainer",bc="grip",aM="handler",bP="handlerContainerNode",cK="hd",cg="header",bl="headerDateFormat",cI="headerTableNode",bg="horizontal",aV="host",aG="hourHeight",s="icon",s="icon",an="isoTime",a1="lasso",aX="left",aB="locale",ae="marker",be="markercell",a6="markercellsNode",K="markers",bM="markersNode",bO="month",bj="monthContainerNode",e="monthRows",C="mousedown",M="mousemove",a0="mouseup",aS="next",cN="node",am="nomonth",av="noscroll",cf="offsetHeight",ch="offsetWidth",cj="pad",aL="paddingNode",cx="parentEvent",R="parentNode",bD="proxy",ak="px",af="region",aY="rendered",cd="repeated",bZ="resizing",a7="right",bB="row",b1="save",p="scheduler",aF="scheduler-event",Z="scrollable",T="shim",cl="startDate",W="startXY",aZ="table",z="tableGridNode",bH="tableNode",bE="tbody",f="td",by="time",al="timesNode",h="title",ao="today",bC="top",az="visible",cy="week",bK="width",t="data-colnumber",k="a",bu=",",bY="-",b3=".",bV="",bL="%",V=" ",D=ci.getClassName,bx=D(b2,av),ag=D(b2,Z);var a5=ci.Component.create({NAME:b2,AUGMENTS:[ci.WidgetStdMod],ATTRS:{bodyContent:{value:bV},eventClass:{valueFn:function(){return ci.SchedulerEvent;}},height:{value:600},isoTime:{value:false,validator:a3},name:{value:bV,validator:b9},navigationDateFormat:{value:"%A - %d %B, %Y",validator:b9},nextDate:{getter:"getNextDate",readOnly:true},prevDate:{getter:"getPrevDate",readOnly:true},scheduler:{lazyAdd:false,setter:"_setScheduler"},scrollable:{value:true,validator:a3},triggerNode:{setter:ci.one},visible:{value:false}},BIND_UI_ATTRS:[Z],prototype:{initializer:function(){var A=this;A.after("render",A._afterRender);},syncUI:function(){var A=this;A.syncStdContent();},adjustCurrentDate:function(){var A=this;var cP=A.get(p);var cO=cP.get(bm);cP.set(bm,cO);},flushViewCache:function(){},getNextDate:function(){},getPrevDate:function(){},getToday:function(){return au.clearTime(new Date());},limitDate:function(cO,cP){var A=this;if(au.after(cO,cP)){cO=au.clone(cP);}return cO;},plotEvents:function(){},syncStdContent:function(){},syncEventUI:function(A){},_uiSetCurrentDate:function(A){},_afterRender:function(cO){var A=this;A.adjustCurrentDate();A._uiSetScrollable(A.get(Z));},_setScheduler:function(cP){var A=this;var cO=A.get(p);if(cO){A.removeTarget(cO);}if(cP){A.addTarget(cP);cP.after("eventsChange",ci.bind(A.flushViewCache,A));}return cP;},_uiSetScrollable:function(cP){var A=this;var cO=A.bodyNode;if(cO){cO.toggleClass(ag,cP);cO.toggleClass(bx,!cP);}},_uiSetVisible:function(cO){var A=this;a5.superclass._uiSetVisible.apply(this,arguments);if(cO&&A.get(aY)){A.adjustCurrentDate();}}}});ci.SchedulerView=a5;var bS=cv.sub;var O=function(A,cO){return function(cQ){var cP=cQ.all(A);return(cP.size()>=cO)?cP:null;};},g=D(s),F=D(s,bc,cE,bg),aO=D(aF),br=D(aF,bU),b5=D(aF,bD),Q=D(p,ao),at=D(p,ao,cK),x=D(b2,w),c=D(b2,a),co=D(b2,bk),cp=D(b2,bk,aT),aP=D(b2,cs,aM),ac=D(b2,cs,aM,aT),bt=D(b2,ae,bv),cr=D(b2,be),L=D(b2,K),bI=D(b2,aZ),cu=D(b2,cs,cg,aZ),r=D(b2,cs,cg,cs),bs=D(b2,cs,cg,cs,cj,a7),b7=D(b2,cs,cg,cs,aJ),ba=D(b2,cs,cg,aj),cG=D(b2,aZ,aj),aE=D(b2,aZ,aj,T),P=D(b2,aZ,I),H=D(b2,aZ,aK),cz=D(b2,aZ,m),bA=D(b2,aZ,by),bR='<div class="'+ac+'">'+'<div class="'+[g,F,aP].join(V)+'"></div>'+"</div>",ah='<div class="'+cr+'">'+'<div class="'+bt+'"></div>'+"</div>",ax='<table cellspacing="0" cellpadding="0" class="'+bI+'">'+"<tbody>"+'<tr class="'+c+'" height="1">'+'<td height="0" class="'+[cG,P].join(V)+'"></td>'+'<td class="'+cp+'" colspan="1">'+'<div class="'+co+'">'+'<div class="'+L+'"></div>'+"</div>"+"</td>"+"</tr>"+'<tr class="'+x+'">'+'<td class="'+[cG,cz].join(V)+'"></td>'+"</tr>"+"</tbody>"+"</table>",bp='<td class="'+[cG,H].join(V)+'" data-colnumber="{colNumber}">'+'<div class="'+aE+'"></div>'+"</td>",j='<div class="'+bA+'">{hour}</div>',ay='<table cellspacing="0" cellpadding="0" class="'+cu+'">'+"<tbody>"+'<tr class="'+ba+'"></tr>'+"</tbody>"+"</table>",bq='<th class="'+r+'" data-colnumber="{colNumber}"><a href="#">&nbsp;</a></th>',aw='<td class="'+[r,b7].join(V)+'"></td>',u='<th class="'+[r,bs].join(V)+'">&nbsp;</th>';
var cH=ci.Component.create({NAME:aH,ATTRS:{bodyContent:{value:bV},days:{value:1,validator:aI},delegateConfig:{value:{},setter:function(cO){var A=this;return ci.merge({dragConfig:{useShim:false},bubbleTargets:A,container:A.get(aW),nodes:b3+aO,invalid:"input, select, button, a, textarea, "+b3+br},cO||{});},validator:cJ},headerDateFormat:{value:"%d %A",validator:b9},name:{value:cs},hourHeight:{value:52,validator:aI},eventWidth:{value:95,validator:aI},handlerContainerNode:{valueFn:function(){return ci.Node.create(bR);}},headerTableNode:{valueFn:function(){return ci.Node.create(ay);}},tableNode:{valueFn:function(){return ci.Node.create(ax);}},colDaysNode:{valueFn:"_valueColDaysNode"},colHeaderDaysNode:{valueFn:"_valueColHeaderDaysNode"},markercellsNode:{valueFn:"_valueMarkercellsNode"},timesNode:{valueFn:"_valueTimesNode"}},HTML_PARSER:{colDaysNode:O(b3+H,1),colHeaderDaysNode:O(b3+r,2),hanlderContainerNode:b3+ac,headerTableNode:b3+cu,markercellsNode:O(b3+cr,24),tableNode:b3+bI,timesNode:O(b3+bA,24)},EXTENDS:ci.SchedulerView,prototype:{initializer:function(){var A=this;A[aA]=A.get(aA);A[ck]=A.get(ck);A[bP]=A.get(bP);A[cI]=A.get(cI);A[a6]=A.get(a6);A[bH]=A.get(bH);A[al]=A.get(al);A[bi]=null;A[bw]=A[bH].one(b3+x);A[a2]=A.headerTableNode.one(b3+ba);A[aN]=A[aA].all(b3+aE);A[bo]=A[bH].one(b3+cz);A[bG]=A[bH].one(b3+cp);A[bM]=A[bH].one(b3+L);},renderUI:function(){var A=this;A[bo].setContent(A[al]);A[bM].setContent(A[a6]);A[aA].appendTo(A[bw]);A[ck].appendTo(A[a2]);},bindUI:function(){var A=this;A.headerTableNode.delegate("click",ci.bind(A._onClickDaysHeader,A),b3+r);A[bw].delegate("mousedown",ci.bind(A._onMouseDownTableCol,A),b3+cG);A[bw].delegate("mouseenter",ci.bind(A._onMouseEnterSchedulerEvent,A),b3+aO);A[bw].delegate("mouseleave",ci.bind(A._onMouseLeaveSchedulerEvent,A),b3+aO);A[bw].delegate("mousemove",ci.bind(A._onMouseMoveTableCol,A),b3+H);A[bw].delegate("mouseup",ci.bind(A._onMouseUpTableCol,A),b3+cG);A.on("drag:end",A._onEventDragEnd);A.on("drag:start",A._onEventDragStart);A.on("drag:tickAlignY",A._dragTickAlignY);A.after("drag:align",A._afterDragAlign);},syncUI:function(){var A=this;cH.superclass.syncUI.apply(this,arguments);A[bG].attr(X,A.get(U));A._setupDragDrop();},syncStdContent:function(){var A=this;A.setStdModContent(ce.BODY,A[bH].getDOM());A.setStdModContent(ce.HEADER,A[cI].getDOM());},calculateEventHeight:function(cP){var cO=this;var A=cO.get(aG);return Math.max(cP*(A/60),A/2);},calculateTop:function(cO){var A=this;return((cO.getHours()*60)+cO.getMinutes()+(cO.getSeconds()/60))*(A.get(aG)/60);},getNextDate:function(){var A=this;var cO=A.get(p).get(bm);return au.add(cO,au.DAY,1);},getPrevDate:function(){var A=this;var cO=A.get(p).get(bm);return au.subtract(cO,au.DAY,1);},getColumnByDate:function(cO){var A=this;return A[aA].item(A.getDateDaysOffset(cO));},getColumnShimByDate:function(cO){var A=this;return A[aN].item(A.getDateDaysOffset(cO));},getDateByColumn:function(cP){var A=this;var cO=au.safeClearTime(A.get(p).get(bm));return au.add(cO,au.DAY,cP);},getDateDaysOffset:function(cP){var A=this;var cO=au.safeClearTime(A.get(p).get(bm));return au.getDayOffset(au.safeClearTime(cP),cO);},getYCoordTime:function(cR){var cO=this;var A=cO.get(aG);var cS=bX((cR/A).toFixed(2));var cQ=Math.floor((cS*100)%100*0.6);var cP=Math.floor(cS);return[cP,cQ,0];},plotEvent:function(cP){var A=this;var cQ=cP.get(cN);if(cQ.size()<2){cP.addPaddingNode();}var cS=cP.get(cN).item(0);var cO=cP.get(cN).item(1);var cR=A.getColumnShimByDate(cP.get(aD));var cT=A.getColumnShimByDate(cP.get(cl));if(cT){cT.append(cS);if(cP.get(az)){cS.show();}}else{cS.hide();}if(cR){if(cR.compareTo(cT)||cP.isDayBoundaryEvent()){cO.hide();}else{cR.append(cO);if(cP.get(az)){cO.show();}}}else{cO.hide();}A.syncEventTopUI(cP);A.syncEventHeightUI(cP);},plotEvents:function(){var A=this;var cO=A.get(p);A[aN].each(function(cR,cQ){var cP=cO.getEventsByDay(A.getDateByColumn(cQ),true);cR.empty();ci.Array.each(cP,function(cS){if(cS.getHoursDuration()<=24){A.plotEvent(cS);}});A.syncEventsIntersectionUI(cP);});},syncColumnsUI:function(){var A=this;A[aA].each(function(cQ,cP){var cO=A.getDateByColumn(cP);cQ.toggleClass(Q,au.isToday(cO));});},syncDaysHeaderUI:function(){var cP=this;var cQ=cP.get(p).get(bm);var cO=cP.get(bl);var A=cP.get(aB);cP[ck].all(k).each(function(cT,cS){var cR=au.add(cQ,au.DAY,cS);var cU=ci.DataType.Date.format(cR,{format:cO,locale:A});cT.toggleClass(at,au.isToday(cR));cT.html(cU);});},syncEventsIntersectionUI:function(cO){var A=this;var cP=A.get(q);A.get(p).flushEvents();ci.Array.each(cO,function(cR){var cT=A.findEventIntersections(cR,cO);var cS=cT.length;var cQ=(cP/cS);ci.Array.each(cT,function(cV,cW){var cU=cV.get(cN).item(0);var cY=cQ*cW;var cX=cQ*1.7;if(cW===(cS-1)){cX=cP-cY;}cU.setStyle(bK,cX+bL);cU.setStyle(aX,cY+bL);var cZ=cU.get(R);if(cZ){cZ.insert(cU,cW);}cV._filtered=true;});});},syncEventHeightUI:function(cQ){var cO=this;var cU=cQ.get(aD);var A=cQ.get(cl);var cR=au.clone(A);cR.setHours(24,0,0);var cS=au.getMinutesOffset(cO.limitDate(cU,cR),A);cQ.get(cN).item(0).set(cf,cO.calculateEventHeight(cS));var cP=cQ.get(cN).item(1);if(cP.inDoc()){var cT=au.getMinutesOffset(cU,au.toMidnight(cQ.getClearEndDate()));cP.set(cf,cO.calculateEventHeight(cT));}},syncEventTopUI:function(cO){var A=this;cO.get(cN).item(0).setStyle(bC,A.calculateTop(cO.get(cl))+ak);cO.get(cN).item(1).setStyle(bC,0);},calculateYDelta:function(cP,cO){var A=this;return(cO[1]-cP[1])/(A.get(aG)/2)*30;},findEventIntersections:function(cO,cP){var A=this;var cQ=[];ci.Array.each(cP,function(cR){if(!cO._filtered&&cO.intersectHours(cR)&&(!cR.isDayOverlapEvent()||cR.isDayBoundaryEvent())){cQ.push(cR);}});return cQ;},getXYDelta:function(cO){var A=this;var cP=cO.currentTarget.getXY(),cQ=[cO.pageX,cO.pageY];return ci.Array.map(cP,function(cS,cR){return(cQ[cR]-cS);});},getTickY:function(){var A=this;return b0(Math.ceil(A.get(aG)/2),10);},roundToNearestHour:function(cO,cP){var A=this;cO.setHours(cP[0],b0(cP[1],A.getTickY()),cP[2]);},_afterDragAlign:function(cP){var cO=this;var A=cP.target;
if(!cO[W]){cO[W]=A.actXY;}A.actXY[0]=null;},_dragTickAlignX:function(cP){var cO=this;var cS=cO[E];if(cS){var cQ=cO[bT];var cR=bX(cP.attr(t))-cO.startColNumber;cO.draggingEventStartDate=au.add(cS.get(cl),au.DAY,cR);var A=au.clone(cO.draggingEventStartDate);au.copyHours(A,cQ.get(cl));cQ.move(A);cO.plotEvent(cQ);}},_dragTickAlignY:function(cP){var cO=this;var cS=cO[E];if(cS){var A=cP.target.get(aV);var cQ=cO[bT];var cR=cO.calculateYDelta(cO[W],A.actXY);if(cO[bZ]){cQ.set(aD,au.add(cO.draggingEventEndDate,au.MINUTES,cR));}else{cQ.move(au.add(cO.draggingEventStartDate,au.MINUTES,cR));}cO.plotEvent(cQ);}},_setupDragDrop:function(){var cO=this;if(!cO[bT]){var cP=cO.get(p);cO[bT]=new (cO.get(cD))({scheduler:cP});cO[bT].removeTarget(cP);cO[bT].get(cN).addClass(b5).hide();}if(!cO.delegate){cO.delegate=new ci.DD.Delegate(cO.get(B));}var A=cO.delegate.dd;A.unplug(ci.Plugin.DDConstrained);A.unplug(ci.Plugin.DDNodeScroll);var cQ=cO.bodyNode.get(af);cQ.bottom=Infinity;cQ.top=-Infinity;A.plug(ci.Plugin.DDConstrained,{bubbleTargets:cO,constrain:cQ,stickY:true,tickY:cO.get(aG)/2});A.plug(ci.Plugin.DDNodeScroll,{node:cO.bodyNode,scrollDelay:150});},_uiSetCurrentDate:function(cO){var A=this;A.syncColumnsUI();A.syncDaysHeaderUI();},_onClickDaysHeader:function(cQ){var A=this;var cP=A.get(p);if(cQ.target.test(k)){var cR=cP.getViewByName(cs);if(cR){var cO=bX(cQ.currentTarget.attr(t));cP.set(bm,A.getDateByColumn(cO));cP.set(bW,cR);}}cQ.preventDefault();},_onEventDragEnd:function(cO){var A=this;var cQ=A[E];if(cQ){var cP=A[bT];cP.set(az,false);cQ.set(az,true);cQ.copyDates(cP);A.get(p).syncEventsUI();}A[W]=null;A[E]=null;},_onEventDragStart:function(cP){var A=this;var cR=A[E]=A.delegate.dd.get(cN).getData(aF);if(cR){var cQ=A[bT];cQ.copyPropagateAttrValues(cR);A.plotEvent(cQ);cR.set(az,false);A.draggingEventStartDate=au.clone(cR.get(cl));A.draggingEventEndDate=au.clone(cR.get(aD));var cO=A.getColumnByDate(cR.get(cl));A.startColNumber=cO?bX(cO.attr(t)):0;}},_onMouseDownTableCol:function(cO){var cT=this;var cS=cO.target;var cQ=cT.get(p);var cU=cQ.get(cL);if(cU&&!cQ.get(bU)){cU.hideOverlay();if(cS.test(b3+aE)){cT[W]=[cO.pageX,cO.pageY];var cV=bX(cO.currentTarget.attr(t));var cP=cT.getDateByColumn(cV);var A=cT.getXYDelta(cO);cT.roundToNearestHour(cP,cT.getYCoordTime(A[1]));var cR=au.add(cP,au.MINUTES,cU.get(b8));cU.move(cP);cU.set(aD,cR);cT[aa]=cP;cT[bh]=cR;cO.halt();}else{if(cS.test(b3+aP)){cT[bZ]=true;}}}cT.get(aW).unselectable();},_onMouseEnterSchedulerEvent:function(cO){var A=this;var cP=cO.currentTarget;A[bP].appendTo(cP);},_onMouseLeaveSchedulerEvent:function(cO){var A=this;var cP=cO.currentTarget;cP.removeChild(A[bP]);},_onMouseMoveTableCol:function(cR){var A=this;var cQ=cR.currentTarget;var cO=A.get(p).get(cL);if(A[bi]!==cQ){A[bi]=cQ;A._dragTickAlignX(A[bi]);}var cP=A[bh];var cS=A[aa];if(cS){var cT=b0(A.calculateYDelta(A[W],[cR.pageX,cR.pageY]),A.getTickY());if(A._delta!==cT){if(cT>0){cO.set(aD,au.add(cP,au.MINUTES,cT));}else{cO.set(cl,au.add(cS,au.MINUTES,cT));}A.plotEvent(cO);A._delta=cT;}}},_onMouseUpTableCol:function(cQ){var A=this;var cP=A.get(p);var cO=cP.get(cL);if(cO&&!cP.get(bU)){if(A[aa]){A.plotEvent(cO);cO.showOverlay();}}A[aa]=null;A[bh]=null;A[bZ]=false;A[W]=null;A.get(aW).selectable();},_valueColDaysNode:function(){var A=this;var cQ=A.get(U);var cO=[],cP=0;while(cQ--){cO.push(ci.Lang.sub(bp,{colNumber:cP++}));}return ci.NodeList.create(cO.join(bV));},_valueColHeaderDaysNode:function(){var A=this;var cQ=A.get(U);var cO=[],cP=0;cO.push(aw);while(cQ--){cO.push(ci.Lang.sub(bq,{colNumber:cP++}));}cO.push(u);return ci.NodeList.create(cO.join(bV));},_valueMarkercellsNode:function(){var A=this;var cO=[],cP;for(cP=0;cP<=23;cP++){cO.push(ah);}return ci.NodeList.create(cO.join(bV));},_valueTimesNode:function(){var A=this;var cQ=A.get(an);var cP=[],cO;for(cO=0;cO<=23;cO++){cP.push(bS(j,{hour:cQ?au.toIsoTimeString(cO):au.toUsTimeString(cO,false,true)}));}return ci.NodeList.create(cP.join(bV));}}});ci.SchedulerDayView=cH;var ap=ci.Component.create({NAME:cm,ATTRS:{bodyContent:{value:bV},days:{value:7},name:{value:cy}},EXTENDS:ci.SchedulerDayView,prototype:{adjustCurrentDate:function(){var A=this;var cQ=A.get(p);var cO=cQ.get(bm);var cP=cQ.get(cn);cQ.set(bm,au.getFirstDayOfWeek(cO,cP));},getNextDate:function(){var A=this;var cP=A.get(p);var cO=cP.get(bm);var cQ=A._firstDayOfWeek(cO);return au.add(cQ,au.WEEK,1);},getPrevDate:function(){var A=this;var cP=A.get(p);var cO=cP.get(bm);var cQ=A._firstDayOfWeek(cO);return au.subtract(cQ,au.WEEK,1);},getToday:function(){var A=this;var cO=ap.superclass.getToday.apply(this,arguments);return A._firstDayOfWeek(cO);},_firstDayOfWeek:function(cP){var A=this;var cQ=A.get(p);var cO=cQ.get(cn);return au.getFirstDayOfWeek(cP,cO);}}});ci.SchedulerWeekView=ap;var g=D(s),l=D(s,"arrowstop-1-l"),cA=D(s,"arrowstop-1-r"),cc=D(b2,bO,a),n=D(b2,bO,a,aJ),b=D(b2,bO,a,ao),i=D(b2,bO,aT),bd=D(b2,bO,cg,aj),v=D(b2,bO,cg,cs),cB=D(b2,bO,cg,aZ),aq=D(b2,bO,a1),cb=D(b2,bO,bB),ar=D(b2,bO,bB,aT),bN=D(b2,bO,aZ,bJ),ca=D(b2,bO,aZ,bJ,aj),a9=D(b2,bO,aZ,bJ,aj,am),a4=D(b2,bO,aZ,bJ,aj,h),cF=D(b2,bO,aZ,bJ,aj,h,ad),ai=D(b2,bO,aZ,bJ,aj,h,aJ),y=D(b2,bO,aZ,bJ,aj,h,aS),S=D(b2,bO,aZ,bJ,aj,h,ao),bz=D(b2,bO,aZ,bJ,bb),d=D(b2,bO,aZ,bJ,bb,aX),o=D(b2,bO,aZ,bJ,bb,cd),b4=D(b2,bO,aZ,bJ,bb,a7),a8=D(b2,bO,aZ,bJ,aJ),bn=D(b2,bO,aZ,bk),cw=D(b2,bO,aZ,bk,aJ),G='<table cellspacing="0" cellpadding="0" class="'+cB+'">'+"<tbody>"+'<tr class="'+bd+'"></tr>'+"</tbody>"+"</table>",N='<th class="'+v+'"><div>&nbsp;</div></th>',bQ='<div class="'+aq+'"></div>',ct='<div class="'+i+'">'+'<div class="'+ar+'">'+'<div class="'+cb+'" style="top: 0; height: 16.6667%;"></div>'+'<div class="'+cb+'" style="top: 16.6667%; height: 16.6667%;"></div>'+'<div class="'+cb+'" style="top: 33.3333%; height: 16.6667%;"></div>'+'<div class="'+cb+'" style="top: 50%; height: 16.6667%;"></div>'+'<div class="'+cb+'" style="top: 66.6667%; height: 16.6667%;"></div>'+'<div class="'+cb+'" style="top: 83.3333%; height: 16.6667%;"></div>'+"</div>"+"</div>",bF='<table cellspacing="0" cellpadding="0" class="'+bn+'">'+"<tbody>"+"<tr>"+'<td class="'+[cc,n].join(V)+'">&nbsp;</td>'+'<td class="'+cc+'">&nbsp;</td>'+'<td class="'+cc+'">&nbsp;</td>'+'<td class="'+cc+'">&nbsp;</td>'+'<td class="'+cc+'">&nbsp;</td>'+'<td class="'+cc+'">&nbsp;</td>'+'<td class="'+cc+'">&nbsp;</td>'+"</tr>"+"</tbody>"+"</table>",b6='<table cellspacing="0" cellpadding="0" class="'+bN+'">'+"<tbody></tbody>"+"</table>",cq="<tr></tr>",bf='<td class="'+ca+'"><div></div></td>',ab='<span class="'+[g,l].join(V)+'"></span>',J='<span class="'+[g,cA].join(V)+'"></span>';
var aC=ci.Component.create({NAME:cC,ATTRS:{bodyContent:{value:bV},name:{value:bO},headerDateFormat:{value:"%a"},navigationDateFormat:{value:"%b %Y"},scrollable:{value:false},monthContainerNode:{valueFn:function(){return ci.Node.create(ct);}},headerTableNode:{valueFn:function(){return ci.Node.create(G);}},colHeaderDaysNode:{valueFn:"_valueColHeaderDaysNode"},tableGridNode:{valueFn:"_valueTableGridNode"}},HTML_PARSER:{tableGridNode:O(b3+bn,7),colHeaderDaysNode:O(b3+v,7),monthContainerNode:b3+i,headerTableNode:b3+cB},EXTENDS:ci.SchedulerView,prototype:{evtDateStack:null,evtDataTableStack:null,initializer:function(){var A=this;A.evtDateStack={};A.evtDataTableStack={};A[ck]=A.get(ck);A[cI]=A.get(cI);A[bj]=A.get(bj);A[z]=A.get(z);A[a2]=A.headerTableNode.one(b3+bd);A[aU]=A[z].all(f);A[e]=A[bj].all(b3+cb);},bindUI:function(){var A=this;var cO=A.get(p).get(cL);cO.on({cancel:ci.bind(A.removeLasso,A),save:ci.bind(A.removeLasso,A)});A[bj].on({mousedown:ci.bind(A._onMouseDownGrid,A),mousemove:ci.bind(A._onMouseMoveGrid,A),mouseup:ci.bind(A._onMouseUpGrid,A)});},renderUI:function(){var A=this;A.colHeaderDaysNode.appendTo(A[a2]);A[e].each(function(cQ,cP){var cO=A[z].item(cP);cQ.append(cO.toggleClass(cw,(cP===0)));});},adjustCurrentDate:function(){var A=this;var cO=A.get(p);cO.set(bm,A._findCurrentMonthStart());},buildEventsTable:function(cO,cT){var cZ=this;var cW=4;var cQ=au.clearTime(cZ._findCurrentMonthEnd());var cY=au.clearTime(cZ._findCurrentMonthStart());var cV=String(cY.getTime()).concat(cO.getTime()).concat(cT.getTime());var cU=cZ.evtDataTableStack[cV];if(!cU){cU=ci.Node.create(b6);var cX=cU.one(bE);var cR=ci.Node.create(cq);cZ.loopDates(cO,cT,function(c1,c0){var c2=ci.Node.create(bf);c2.addClass(a4).toggleClass(ai,(c0===0)).toggleClass(S,au.isToday(c1)).toggleClass(y,au.isToday(au.subtract(c1,au.DAY,1))).toggleClass(cF,au.isToday(au.subtract(c1,au.WEEK,1)));if(au.before(c1,cY)||au.after(c1,cQ)){c2.addClass(a9);}cR.append(c2.setContent(c1.getDate()));});cX.append(cR);var A;for(A=0;A<cW;A++){var cS=0;var cP=ci.Node.create(cq);cZ.loopDates(cO,cT,function(c8,c5){if(cS<=c5){var c9=cZ.getIntersectEvents(c8),c6=c9[A];var c2=ci.Node.create(bf);if(c6){var c1=c6.get(cl);if(!(au.before(c1,cO)&&au.getDayOffset(c8,cO)>0)){var c3=c6.get(cN);var c7=Math.floor(au.getDayOffset(c8,au.getFirstDayOfWeek(c1))/aQ);if(c3.size()<c7+1){c6.addPaddingNode();}var c4=c3.item(c7);c4.setStyles({height:"auto",left:0,top:0,width:"auto"});var c0=c2.one(Y);c4.appendTo(c0);var da=cZ._getEvtSplitInfo(c6,c8,cO,cT);c2.attr(X,da.colspan);c0.addClass(bz);if(da.left){c0.addClass(d).prepend(ab);}if(da.right){c0.addClass(b4).append(J);}if(c6.get(cx)){c0.addClass(o);}cS+=da.colspan;}}else{cS++;}cP.append(c2);}});cX.append(cP);}cZ.evtDataTableStack[cV]=cU;}return cU;},flushViewCache:function(){var A=this;A.evtDateStack={};A.evtDataTableStack={};},getIntersectEvents:function(cO){var A=this;var cQ=A.get(p);var cP=String(cO.getTime());if(!A.evtDateStack[cP]){A.evtDateStack[cP]=cQ.getIntersectEvents(cO);}return A.evtDateStack[cP];},getNextDate:function(){var A=this;var cP=A.get(p);var cO=cP.get(bm);return au.add(cO,au.MONTH,1);},getPrevDate:function(){var A=this;var cP=A.get(p);var cO=cP.get(bm);return au.subtract(cO,au.MONTH,1);},loopDates:function(A,cQ,cT,cU,cS){var cV=this;var cO=au.clone(A);var cP=cQ.getTime(),cR;for(cR=0;cO.getTime()<=cP;cR++){cT.apply(cV,[cO,cR]);cO=au.add(cO,(cU||au.DAY),(cS||1));}},plotEvents:function(){var cO=this;var cP=cO._findCurrentMonthStart();var A=au.safeClearTime(cO._findFirstDayOfWeek(cP));cO.flushViewCache();cO.bodyNode.all(b3+bN).remove();cO[e].each(function(cT,cR){var cQ=au.add(A,au.WEEK,cR);var cU=au.add(cQ,au.DAY,aQ-1);var cS=cO.buildEventsTable(cQ,cU);if(cR===0){cS.addClass(a8);}cT.append(cS);});},removeLasso:function(){var A=this;if(A.lasso){A.lasso.remove();}},renderLasso:function(cU,cO){var c0=this;var cR=cU;var cT=cO;if(cU[1]>cO[1]){cR=cO;cT=cU;}var c1=cR[0],cW=cR[1],cP=cT[0],A=cT[1];c0.removeLasso();c0.lasso=ci.NodeList.create();for(var cQ=cW;cQ<=A;cQ++){var cS=c0.gridCellHeight,cZ=c0.gridCellWidth,cX=0,cV=(cS*cQ);if(cQ===cW){if(cW===A){cX+=Math.min(c1,cP)*cZ;cZ*=Math.abs(cP-c1)+1;}else{cX+=c1*cZ;cZ*=aQ-c1;}}else{if(cQ===A){cZ*=cP+1;}else{cZ*=aQ;}}var cY=ci.Node.create(bQ);c0.lasso.push(cY);c0[bj].append(cY);cY.sizeTo(cZ,cS);cY.setXY(c0._offsetXY([cX,cV],1));}},syncDaysHeaderUI:function(){var cP=this;var cS=cP.get(p);var cQ=cS.get(bm);var cO=cP.get(bl);var A=cP.get(aB);var cR=cP._findFirstDayOfWeek(cQ);cP.colHeaderDaysNode.all(Y).each(function(cV,cU){var cT=au.add(cR,au.DAY,cU);var cW=ci.DataType.Date.format(cT,{format:cO,locale:A});cV.html(cW);});},syncGridUI:function(){var cV=this;var cP=cV.getToday();var cO=cV.get(p);cV[aU].removeClass(b);if(au.isSameMonth(cP,cO.get(bm))){var A=cO.get(cn);var cR=cV._findCurrentMonthStart();var cT=cV._findFirstDayOfWeek(cP);var cQ=au.getWeekNumber(cP,A)-au.getWeekNumber(cR,A);var cU=(cP.getDate()-cT.getDate());var cS=cV[z].item(cQ).all(f).item(cU);if(cS){cS.addClass(b);}}},syncStdContent:function(){var A=this;A.setStdModContent(ce.BODY,A[bj].getDOM());A.setStdModContent(ce.HEADER,A[cI].getDOM());},_findCurrentMonthEnd:function(){var A=this;var cP=A.get(p);var cO=cP.get(bm);return au.findMonthEnd(cO);},_findCurrentMonthStart:function(){var A=this;var cP=A.get(p);var cO=cP.get(bm);return au.findMonthStart(cO);},_findFirstDayOfWeek:function(cP){var A=this;var cQ=A.get(p);var cO=cQ.get(cn);return au.getFirstDayOfWeek(cP,cO);},_getEvtLabel:function(cP){var cO=this;var cQ=cP.get(aD);var A=cP.get(cl);return[A.getHours(),bY,cQ.getHours(),V,cP.get(aR)].join(bV);},_getEvtSplitInfo:function(cT,cW,A,cQ){var cU=this;var cO=cT.getClearStartDate();var cR=cT.getClearEndDate();var cS=au.getFirstDayOfWeek(cW);var cV=cQ.getDate()-cW.getDate();var cP={colspan:Math.min(au.getDayOffset(cR,cW),cV)+1,left:au.before(cO,A),right:au.after(cR,cQ)};return cP;},_getPositionDate:function(cP){var cO=this;var cQ=cO._findCurrentMonthStart();var A=au.safeClearTime(cO._findFirstDayOfWeek(cQ));return au.add(A,au.DAY,cO._getCellIndex(cP));
},_getCellIndex:function(cO){var A=this;return cO[1]*aQ+cO[0];},_offsetXY:function(cQ,cP){var A=this;var cO=A[bj].getXY();return[cQ[0]+cO[0]*cP,cQ[1]+cO[1]*cP];},_onMouseDownGrid:function(cQ){var cO=this;var cR=cQ.target;if(cR.test([b3+cc,b3+ca].join(bu))){cO._recording=true;var A=cO[z].item(0).all(f).item(0);cO.gridCellHeight=cO[bj].get(cf)/6;cO.gridCellWidth=cO[bj].get(ch)/aQ;var cP=cO._offsetXY([cQ.pageX,cQ.pageY],-1);cO.lassoStartPosition=cO.lassoLastPosition=cO._findPosition(cP);cO.renderLasso(cO.lassoStartPosition,cO.lassoLastPosition);cO[bj].unselectable();}},_onMouseMoveGrid:function(cR){var cO=this;var cS=cR.currentTarget;var cP=cO._offsetXY([cR.pageX,cR.pageY],-1);var cQ=cO.lassoLastPosition||cO.lassoStartPosition;var A=cO._findPosition(cP);var cT=cQ&&((A[0]!==cQ[0])||(A[1]!==cQ[1]));if(cT&&cO._recording){cO.lassoLastPosition=A;cO.renderLasso(cO.lassoStartPosition,A);}},_onMouseUpGrid:function(cR){var cO=this;var cQ=cO.get(p);var cP=cQ.get(cL);if(cP&&cO._recording&&!cQ.get(bU)){var A=cO._getPositionDate(cO.lassoStartPosition);var cS=cO._getPositionDate(cO.lassoLastPosition);cP.set(cl,Math.min(A,cS));cP.set(aD,Math.max(A,cS));cP.showOverlay([cR.pageX,cR.pageY]);cO._recording=false;}},_findPosition:function(cQ){var A=this;var cP=Math.floor(cQ[0]/A.gridCellWidth);var cO=Math.floor(cQ[1]/A.gridCellHeight);return[cP,cO];},_uiSetCurrentDate:function(cO){var A=this;A.syncDaysHeaderUI();A.syncGridUI();},_valueColHeaderDaysNode:function(){var A=this;return A._valueNodeList(aQ,N);},_valueTableGridNode:function(){var A=this;return A._valueNodeList(aQ,bF);},_valueNodeList:function(cQ,cP){var A=this;var cO=[];while(cQ--){cO.push(cP);}return ci.NodeList.create(cO.join(bV));}}});ci.SchedulerMonthView=aC;},"@VERSION@",{skinnable:true,requires:["aui-scheduler-event","aui-calendar","aui-button-item","dd-drag","dd-delegate","dd-drop","dd-constrain"]});AUI.add("aui-scheduler-event",function(aK){var an=aK.Lang,bj=an.isString,f=an.isDate,a9=an.isFunction,G=an.isObject,bc=an.isBoolean,ad=an.isNumber,aY=aK.ColorUtil,j=aK.DataType.DateMath,a5=aK.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),be="-",t="&ndash;",ay=".",p="",q=" ",l="_",aM="_propagateSet",P="activeView",S="borderColor",aO="borderColorRGB",aI="borderStyle",bq="borderWidth",I="Change",a3="color",aW="colorBrightnessFactor",bd="colorSaturationFactor",aG="content",w="disabled",a0="duration",aP="endDate",aS="eventClass",aq="eventStack",bk="events",au="hidden",H="hsbColor",at="icon",aa="icons",a1="id",aX="isoTime",bp="locale",aZ="never",n="node",h="overlay",aL="parentEvent",bv="recorder",aN="repeat",bi="repeated",O="repeatedEvents",bb="repeater",ag="scheduler",av="scheduler-event",ax="scheduler-event-recorder",bm="startDate",a7="template",aV="title",e="titleDateFormat",ao="visible",d="%H:%M",a6="%I:%M",E=aK.getClassName,k=E(at),s=E(av),aQ=E(av,aG),C=E(av,au),bg=E(av,w),ap=E(av,bv),aB=E(av,bi),am=E(av,bb),D=E(av,aV),bo=E(av,aa),v=E(av,at,w),b=E(av,at,bi),bs=E(av,at,bb);var U=aK.Component.create({NAME:av,ATTRS:{borderStyle:{value:"solid",validator:bj},borderWidth:{value:"1px",validator:bj},colorBrightnessFactor:{value:0.75,validator:ad},colorSaturationFactor:{value:1.5,validator:ad},content:{value:"(no title)",validator:bj},color:{lazyAdd:false,setter:"_setColor",value:"#D96666",validator:bj},titleDateFormat:{getter:"_getTitleDateFormat",validator:bj},endDate:{setter:"_setDate",valueFn:function(){var A=j.clone(this.get(bm));A.setHours(A.getHours()+1);return A;}},eventClass:{valueFn:function(){return aK.SchedulerEvent;}},disabled:{value:false,validator:bc},node:{valueFn:function(){return aK.NodeList.create(aK.Node.create(this.EVENT_NODE_TEMPLATE).setData(av,this));}},parentEvent:{},repeat:{value:p,setter:"_setRepeat"},scheduler:{lazyAdd:false,setter:"_setScheduler"},startDate:{setter:"_setDate",valueFn:function(){return new Date();}},visible:{value:true,validator:bc}},EXTENDS:aK.Base,PROPAGATE_ATTRS:[bm,aP,aG,a3,aW,bd,aI,bq,e,ao,w],prototype:{EVENT_NODE_TEMPLATE:'<div class="'+s+'">'+'<div class="'+D+'"></div>'+'<div class="'+aQ+'"></div>'+'<div class="'+bo+'">'+'<span class="'+[k,b].join(q)+'"></span>'+'<span class="'+[k,bs].join(q)+'"></span>'+'<span class="'+[k,v].join(q)+'"></span>'+"</div>"+"</div>",eventStack:null,initializer:function(){var A=this;var L=A.get(n);A[aq]={};aK.Array.each(A.get(aS).PROPAGATE_ATTRS,function(X){A.after(X+I,A._propagateAttrChange);});A._bindUIAttrs();A.syncNodeUI(true);},destroy:function(){var A=this;A.eachRepeatedEvent(function(L,X){L.destroy();});A[aq]={};A.get(n).remove(true);},addPaddingNode:function(){var A=this;A.get(n).push(aK.Node.create(A.EVENT_NODE_TEMPLATE).setData(av,A));A.syncNodeUI();},copyDates:function(L){var A=this;A.set(aP,j.clone(L.get(aP)));A.set(bm,j.clone(L.get(bm)));},copyPropagateAttrValues:function(L,X){var A=this;A.copyDates(L);aK.Array.each(A.get(aS).PROPAGATE_ATTRS,function(Y){if(!((X||{}).hasOwnProperty(Y))){var bA=L.get(Y);if(!G(bA)){A.set(Y,bA);}}});},getBorderColor:function(){var A=this;return A[aO].hex;},getDaysDuration:function(){var A=this;return j.getDayOffset(A.get(aP),A.get(bm));},getHoursDuration:function(){var A=this;return j.getHoursOffset(A.get(aP),A.get(bm));},getMinutesDuration:function(){var A=this;return j.getMinutesOffset(A.get(aP),A.get(bm));},getSecondsDuration:function(){var A=this;return j.getSecondsOffset(A.get(aP),A.get(bm));},sameEndDate:function(L){var A=this;return j.compare(A.get(aP),L.get(aP));},sameStartDate:function(L){var A=this;return j.compare(A.get(bm),L.get(bm));},isAfter:function(Y){var X=this;var L=X.get(bm);var A=Y.get(bm);return j.after(L,A);},isBefore:function(Y){var X=this;var L=X.get(bm);var A=Y.get(bm);return j.before(L,A);},repeatByDate:function(X){var L=this;var Y=L.uidByDate(X);if(!L[aq][Y]){var A=j.clone(X);var bB=j.clone(X);j.copyHours(A,L.get(bm));j.copyHours(bB,L.get(aP));var bA=new L.get(aS)({endDate:bB,parentEvent:L,scheduler:L.get(ag),startDate:A});bA.copyPropagateAttrValues(L);L[aq][Y]=bA;}return L[aq][Y];},intersects:function(Y){var X=this;
var bA=X.get(aP);var L=X.get(bm);var A=Y.get(bm);return(X.sameStartDate(Y)||j.between(A,L,bA));},intersectHours:function(X){var L=this;var bA=L.get(aP);var A=L.get(bm);var Y=j.clone(A);j.copyHours(Y,X.get(bm));return(j.compare(A,Y)||j.between(Y,A,bA));},isDayBoundaryEvent:function(){var A=this;return j.isDayBoundary(A.get(bm),A.get(aP));},isDayOverlapEvent:function(){var A=this;return j.isDayOverlap(A.get(bm),A.get(aP));},isRepeatableDate:function(L){var A=this;var X=A.get(aN);return(X&&X.validate(A,L));},getClearEndDate:function(){var A=this;return j.safeClearTime(A.get(aP));},getClearStartDate:function(){var A=this;return j.safeClearTime(A.get(bm));},move:function(L){var A=this;var X=A.getMinutesDuration();A.set(bm,L);A.set(aP,j.add(j.clone(L),j.MINUTES,X));},uidByDate:function(L){var A=this;L=f(L)?j.safeClearTime(L):A.getClearStartDate();return[av,L.getTime()].join(l);},setContent:function(X,L){var A=this;A.get(n).each(function(bA){var Y=bA.one(g+aQ);Y.setContent(X);});if(L){A.eachRepeatedEvent(function(Y,bA){Y.setContent(X);});}},setTitle:function(X,L){var A=this;A.get(n).each(function(Y){var bA=Y.one(g+D);bA.setContent(X);});if(L){A.eachRepeatedEvent(function(Y,bA){Y.setTitle(X);});}},syncNodeUI:function(L){var A=this;A._syncUIAttrs();A.syncNodeColorUI(L);A.syncNodeTitleUI(L);A.syncNodeContentUI(L);},syncNodeColorUI:function(L){var A=this;var Y=A.get(n);var bA=A.getBorderColor();if(Y){var X={borderWidth:A.get(bq),borderColor:bA,backgroundColor:A.get(a3),borderStyle:A.get(aI)};Y.setStyles(X);}if(L){A.eachRepeatedEvent(function(bB,bC){bB.syncNodeColorUI();});}},syncNodeContentUI:function(L){var A=this;A.setContent(A.get(aG),L);},syncNodeTitleUI:function(L){var A=this;var Y=A._formatDate(A.get(bm));var X=A._formatDate(A.get(aP));A.setTitle([Y,X].join(q+t+q),L);},split:function(){var A=this,X=j.clone(A.get(bm)),Y=j.clone(A.get(aP));if(A.isDayOverlapEvent()&&!A.isDayBoundaryEvent()){var L=j.clone(X);L.setHours(24,0,0,0);return[[X,j.toMidnight(j.clone(X))],[L,j.clone(Y)]];}return[[X,Y]];},eachRepeatedEvent:function(L){var A=this;aK.each(A[aq],L,A);},unlink:function(){var A=this;if(A.get(aL)){A.set(aL,null);}else{A.eachRepeatedEvent(function(L,X){L.unlink();});}A[aq]={};A.syncNodeUI();},_afterDisabledChange:function(L){var A=this;A._uiSetDisabled(L.newVal);},_afterVisibleChange:function(L){var A=this;A._uiSetVisible(L.newVal);},_afterRepeatChange:function(L){var A=this;A._uiSetRepeat(L.newVal);},_afterParentEventChange:function(L){var A=this;A._uiSetParentEvent(L.newVal);},_bindUIAttrs:function(){var A=this;A.after({disabledChange:A._afterDisabledChange,visibleChange:A._afterVisibleChange,parentEventChange:A._afterParentEventChange,repeatChange:A._afterRepeatChange});A._syncUIAttrs();},_propagateAttrChange:function(Y){var A=this;var X=Y.attrName;var L=Y.newVal;A.eachRepeatedEvent(function(bA,bB){var bC=bA[aM+a5(X)];if(bC){bC.apply(A,[bA,X,L]);}else{bA.set(X,Y.newVal);}bA.syncNodeUI();});A.syncNodeUI();},_propagateSetEndDate:function(A,L,Y){var X=j.clone(A.get(aP));j.copyHours(X,Y);A.set(aP,X);},_propagateSetStartDate:function(L,X,Y){var A=j.clone(L.get(bm));j.copyHours(A,Y);L.set(bm,A);},_setColor:function(L){var A=this;A[H]=aY.rgb2hsb(aY.getRGB(L));A[S]=aK.clone(A[H]);A[S].b*=A.get(aW);A[S].s*=A.get(bd);A[aO]=aY.hsb2rgb(A[S]);return L;},_setDate:function(L){var A=this;if(ad(L)){L=new Date(L);}return L;},_setRepeat:function(L){var A=this;if(bj(L)){L=aK.SchedulerEventRepeat[L];}return G(L)?L:null;},_setScheduler:function(X){var A=this;var L=A.get(ag);if(L){A.removeTarget(L);}A.addTarget(X);return X;},_syncUIAttrs:function(){var A=this;A._uiSetDisabled(A.get(w));A._uiSetVisible(A.get(ao));A._uiSetParentEvent(A.get(aL));A._uiSetRepeat(A.get(aN));},_formatDate:function(X,Y){var L=this;var A=L.get(bp);Y=Y||L.get(e);return aK.DataType.Date.format(X,{format:Y,locale:A});},_getTitleDateFormat:function(X){var A=this;if(!bj(X)){var L=A.get(ag);X=(L&&L.get(P).get(aX))?d:a6;}return X;},_uiSetDisabled:function(L){var A=this;A.get(n).toggleClass(bg,!!L);},_uiSetParentEvent:function(L){var A=this;A.get(n).toggleClass(aB,!!L);},_uiSetRepeat:function(X){var A=this;var L=!!X&&X!==aK.SchedulerEventRepeat[aZ];A.get(n).toggleClass(am,L);},_uiSetVisible:function(L){var A=this;A.get(n).toggleClass(C,!L);}}});aK.SchedulerEvent=U;aK.SchedulerEventRepeat={never:{description:"Never repeat",validate:function(A,L){return false;},value:"never"},daily:{description:"Every day",validate:function(A,L){return true;},value:"daily"},monthly:{description:"Every month",validate:function(L,X){var Y=L.get(aP);var A=L.get(bm);return(A.getDate()===X.getDate());},value:"monthly"},monWedFri:{description:"Every Monday, Wednesday and Friday",validate:function(A,L){return j.isMonWedOrFri(L);},value:"monWedFri"},tuesThurs:{description:"Every Tuesday and Thursday",validate:function(A,L){return j.isTueOrThu(L);},value:"tuesThurs"},weekDays:{description:"Every week days",validate:function(A,L){return j.isWeekDay(L);},value:"weekDays"},weekly:{description:"Every week",validate:function(L,X){var Y=L.get(aP);var A=L.get(bm);return(A.getDay()===X.getDay());},value:"weekly"},yearly:{description:"Every year",validate:function(L,X){var Y=L.get(aP);var A=L.get(bm);return((A.getMonth()===X.getMonth())&&(A.getDay()===X.getDay()));},value:"yearly"}};var aw=aK.Lang,a=aw.isArray,G=aw.isObject,P="activeView",c="arrow",aU="body",aA="bodyContent",o="boundingBox",az="cancel",a2="click",aG="content",aT="date",aH="dateFormat",aj="delete",ba="description",Q="edit",bu="event",aS="eventClass",B="footerContent",aE="form",z="header",u="hide",aX="isoTime",aF="link",n="node",N="offsetHeight",bh="offsetWidth",h="overlay",R="overlayOffset",bv="recorder",br="rendered",aN="repeat",a4="save",ag="scheduler",m="schedulerChange",av="scheduler-event",ax="scheduler-event-recorder",aD="shadow",aC="show",F="startDateChange",M="strings",a7="template",aV="title",bt="tl",ac="toolbar",bl="submit",bn="value",aR="visibleChange",Z="when",al="x",ak="y",af="cancel",K="delete",y="edit",aJ="save",bw="-",g=".",ae="",i="#",r=aK.IO.prototype._serialize,E=aK.getClassName,s=E(ag,bu),ap=E(ag,bu,bv),bx=E(ag,bu,bv,h),x=E(ag,bu,bv,h,c),bf=E(ag,bu,bv,h,c,aD),ai=E(ag,bu,bv,h,aU),a8=E(ag,bu,bv,h,aG),ah=E(ag,bu,bv,h,aT),T=E(ag,bu,bv,h,aE),bz=E(ag,bu,bv,h,z),V=E(ag,bu,bv,h,aF),ar=E(ag,bu,bv,h,aN),D=E(ag,bu,aV),J=new aK.Template('<div class="',bf," ",x,'"></div>','<div class="',x,'"></div>','<input type="hidden" name="startDate" value="{startDate}" />','<input type="hidden" name="endDate" value="{endDate}" />','<div class="',bz,'">','<input class="',a8,'" name="content" value="{content}" />',"</div>",'<div class="',ai,'">','<label class="',ah,'">{date}</label>','<select class="',ar,'" name="repeat">','<tpl for="eventRepeat">','<option {[ (parent.repeat && parent.repeat.value) == parent.eventRepeat[$i].value ? \'selected="selected"\' : "" ]} value="{value}">{description}</option>',"</tpl>","</select>","</div>"),ab='<a class="'+V+'" href="javascript:;">{delete}</a>',by='<form class="'+T+'" id="schedulerEventRecorderForm"></form>';
var W=aK.Component.create({NAME:ax,ATTRS:{content:{value:ae},duration:{value:60},dateFormat:{validator:bj,value:"%a, %B %d,"},event:{},eventClass:{valueFn:function(){return aK.SchedulerEvent;}},strings:{value:{},setter:function(A){return aK.merge({"delete":"Delete","description-hint":"e.g., Dinner at Brian's","no-repeat":"No repeat",cancel:"Cancel",description:"Description",edit:"Edit",repeat:"Repeat",save:"Save",when:"When"},A||{});},validator:G},overlay:{validator:G,value:{align:{points:[bt,bt]},visible:false,width:300,zIndex:500}},overlayOffset:{value:[15,-38],validator:a},template:{value:J},toolbar:{setter:function(X){var L=this;var A=L.get(M);return aK.merge({children:[{handler:aK.bind(L._handleSaveEvent,L),label:A[a4]},{handler:aK.bind(L._handleCancelEvent,L),label:A[az]}]},X||{});},validator:G,value:{}}},EXTENDS:aK.SchedulerEvent,prototype:{initializer:function(){var A=this;A.get(n).addClass(ap);A.publish(af,{defaultFn:A._defCancelEventFn});A.publish(K,{defaultFn:A._defDeleteEventFn});A.publish(y,{defaultFn:A._defEditEventFn});A.publish(aJ,{defaultFn:A._defSaveEventFn});A.after(m,A._afterSchedulerChange);A[h]=new aK.Overlay(A.get(h));A[ac]=new aK.Toolbar(A.get(ac));},_afterSchedulerChange:function(Y){var A=this;var X=Y.newVal;var L=X.get(o);L.delegate(a2,aK.bind(A._onClickSchedulerEvent,A),g+s);},_defCancelEventFn:function(L){var A=this;A.get(n).remove();A.hideOverlay();},_defDeleteEventFn:function(X){var A=this;var L=A.get(ag);L.removeEvent(A.get(bu));A.hideOverlay();L.syncEventsUI();},_defEditEventFn:function(X){var A=this;var L=A.get(ag);A.hideOverlay();L.syncEventsUI();},_defSaveEventFn:function(X){var A=this;var L=A.get(ag);L.addEvent(X.newSchedulerEvent);A.hideOverlay();L.syncEventsUI();},_handleCancelEvent:function(L){var A=this;A.fire(af);L.preventDefault();},_handleSaveEvent:function(L){var A=this;A.fire(A.get(bu)?y:aJ,{newSchedulerEvent:A.getEventCopy()});L.preventDefault();},_onClickDelete:function(){var A=this;A.fire(K,{schedulerEvent:A.get(bu)});},_onClickSchedulerEvent:function(X){var A=this;var L=X.currentTarget.getData(av);if(L){A.set(bu,L);A.showOverlay([X.pageX,X.pageY]);A.get(n).remove();}},_onOverlayVisibleChange:function(Y){var L=this;if(Y.newVal){L.populateForm();if(!L.get(bu)){var X=L[h].get(o);var A=X.one(g+a8);setTimeout(function(){A.selectText();},0);L.deleteNode.hide();}else{L.deleteNode.show();}}else{L.set(bu,null);L.get(n).remove();}},_onSubmitForm:function(L){var A=this;A._handleSaveEvent(L);},_renderOverlay:function(){var L=this;var A=L.get(M);L[h].render();L[ac].render();var X=L[h].get(o);X.addClass(bx);L[h].set(B,L[ac].get(o));L[h].on(aR,aK.bind(L._onOverlayVisibleChange,L));L.deleteNode=aK.Node.create(aw.sub(ab,{"delete":A[aj]}));L[h].footerNode.append(L.deleteNode);L.formNode=aK.Node.create(by);L[h].set(aA,L.formNode);L.deleteNode.on(a2,aK.bind(L._onClickDelete,L));L.formNode.on(bl,aK.bind(L._onSubmitForm,L));},getEventCopy:function(){var A=this;var X=A.get(bu);if(!X){X=new (A.get(aS))({endDate:A.get(aP),scheduler:A.get(ag),startDate:A.get(bm)});X.copyPropagateAttrValues(A,{content:true});}var L=A.serializeForm();X.set(aG,L[aG]);X.set(aN,L[aN]);return X;},getFormattedDate:function(){var X=this;var L=X.get(aH);var bA=(X.get(bu)||X);var bC=bA.get(aP);var bB=bA.get(ag);var A=bA.get(bm);var Y=(bB.get(P).get(aX)?j.toIsoTimeString:j.toUsTimeString);return[bA._formatDate(A,L),Y(A),be,Y(bC)].join(q);},getTemplateData:function(){var L=this;var A=L.get(M);var X=(L.get(bu)||L);return{content:X.get(aG)||A["description-hint"],date:L.getFormattedDate(),endDate:X.get(aP).getTime(),eventRepeat:L.eventRepeatArray,repeat:X.get(aN),startDate:X.get(bm).getTime()};},hideOverlay:function(){var A=this;A[h].hide();},populateForm:function(){var A=this;if(!A.eventRepeatArray){A.eventRepeatArray=[];aK.each(aK.SchedulerEventRepeat,function(L){A.eventRepeatArray.push({description:L[ba],value:L[bn]});});}A.formNode.setContent(A.get(a7).parse(A.getTemplateData()));},serializeForm:function(){var A=this;return aK.QueryString.parse(r(A.formNode.getDOM()));},showOverlay:function(Y,bB){var A=this;var X=A.get(R);if(!A[h].get(br)){A._renderOverlay();}A[h].show();if(!Y){var L=(A.get(bu)||A).get(n);var bA=L.one(g+D);bB=[X[0]+bA.get(bh),X[1]+bA.get(N)/2];Y=bA.getXY();}bB=bB||X;Y[0]+=bB[0];Y[1]+=bB[1];A[h].set("xy",Y);}}});aK.SchedulerEventRecorder=W;},"@VERSION@",{skinnable:true,requires:["aui-base","aui-color-util","aui-datatype","aui-template","aui-toolbar","io-form","querystring","overlay"]});AUI.add("aui-scheduler-calendar",function(d){var i=d.Lang,j=i.isArray,c=i.isBoolean,b=i.isString,g=function(n){return(n instanceof d.SchedulerEvent);},a="color",l="events",h="pallete",m="scheduler",e="scheduler-calendar",k="visible";var f=d.Component.create({NAME:e,ATTRS:{color:{valueFn:function(){var o=this;var p=o.get(h);var n=Math.ceil(Math.random()*p.length)-1;return p[n];},validator:b},name:{value:"(no name)",validator:b},pallete:{value:["#d96666","#e67399","#b373b3","#8c66d9","#668cb3","#668cd9","#59bfb3","#65ad89","#4cb052","#8cbf40","#bfbf4d","#e0c240","#f2a640","#e6804d","#be9494","#a992a9","#8997a5","#94a2be","#85aaa5","#a7a77d","#c4a883","#c7561e","#b5515d","#c244ab","#603f99","#536ca6","#3640ad","#3c995b","#5ca632","#7ec225","#a7b828","#cf9911","#d47f1e","#b56414","#914d14","#ab2671","#9643a5","#4585a3","#737373","#41a587","#d1bc36","#ad2d2d"],validator:j},scheduler:{lazyAdd:false,setter:"_setScheduler"},visible:{value:true,validator:c}},EXTENDS:d.Base,AUGMENTS:d.SchedulerEventSupport,prototype:{initializer:function(){var n=this;n.after("colorChange",n._afterColorChange);n.on("eventsChange",n._onEventsChange);n.on("visibleChange",n._onVisibleChange);n._uiSetVisible(n.get(k));n._uiSetEvents(n.get(l));},syncEventsColor:function(o){var n=this;d.Array.each(o||n.get(l),function(p){p.set(a,n.get(a));});},_afterColorChange:function(o){var n=this;n.syncEventsColor(n.get(l));},_onEventsChange:function(o){var n=this;var p=o.newVal;var q=n.get(k);d.Array.each(p,function(r){r.set(k,q);});n._uiSetEvents(p);
},_onVisibleChange:function(o){var n=this;n._uiSetVisible(o.newVal);},_setScheduler:function(p){var n=this;var o=n.get(m);if(o){n.removeTarget(o);}n.addTarget(p);return p;},_uiSetEvents:function(p){var n=this;var o=n.get(m);n.syncEventsColor(p);if(o){o.removeEvents(n);o.addEvents(p);o.syncEventsUI();}},_uiSetVisible:function(o){var n=this;n.eachEvent(function(p){p.set(k,o);});}}});d.SchedulerCalendar=f;},"@VERSION@",{requires:["aui-scheduler-event"],skinnable:false});AUI.add("aui-scheduler",function(a){},"@VERSION@",{skinnable:true,use:["aui-scheduler-base","aui-scheduler-view","aui-scheduler-event","aui-scheduler-calendar"]});