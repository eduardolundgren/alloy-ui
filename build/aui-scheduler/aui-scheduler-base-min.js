AUI.add("aui-scheduler-base",function(ab){var O=ab.Lang,av=O.isString,a=O.isArray,d=O.isDate,I=O.isNumber,B=O.isObject,H=function(A){return(A instanceof ab.Scheduler);},s=function(A){return(A instanceof ab.SchedulerView);},Z=function(A){return(A instanceof ab.SchedulerEvent);},t=function(A){return(ab.SchedulerCalendar&&(A instanceof ab.SchedulerCalendar));},h=ab.DataType.DateMath,V=ab.WidgetStdMod,T=".",o="",p=" ",r="scheduler-base",ah="data-view-name",F="activeView",au="clearfix",E="controls",aj="controlsNode",am="current",aa="currentDate",X="currentDateNode",ai="date",af="endDate",ag="eventClass",aw="events",aB="hd",v="header",at="headerNode",m="helper",R="icon",j="iconNextNode",ap="iconPrevNode",az="locale",l="name",P="nav",M="navNode",ao="navigationDateFormat",n="next",c="nextDate",ar="prev",ak="prevDate",aA="rendered",L="scheduler",ax="startDate",D="strings",e="today",ac="todayNode",u="triggerNode",y="view",N="viewStack",aC="views",W="viewsNode",z=ab.getClassName,ad=z(m,au),i=z(R),an=z(r,E),S=z(r,am,ai),f=z(r,aB),U=z(r,R,n),C=z(r,R,ar),ay=z(r,P),x=z(r,e),Y=z(r,y),g=z(r,y,o),q=z(r,aC),al='<div class="'+an+'"></div>',w='<div class="'+S+'"></div>',b='<div class="'+f+'"></div>',aD='<a href="#" class="'+[i,U].join(p)+'">Next</a>',ae='<a href="#" class="'+[i,C].join(p)+'">Prev</a>',k='<div class="'+ay+'"></div>',Q='<a href="#" class="'+x+'">{today}</a>',aq='<a href="#" class="'+[Y,g].join(p)+'{name}" data-view-name="{name}">{label}</a>',J='<div class="'+q+'"></div>';var K=function(){};K.ATTRS={eventClass:{valueFn:function(){return ab.SchedulerEvent;}},events:{value:[],setter:"_setEvents",validator:a}};ab.mix(K.prototype,{addEvent:function(aE){var A=this;var aF=A.get(aw);if(ab.Array.indexOf(aF,aE)>-1){ab.Array.removeItem(aF,aE);}aF.push(aE);A.set(aw,aF);},addEvents:function(aE){var A=this;ab.Array.each(A._normalizeEvents(aE),ab.bind(A.addEvent,A));},eachEvent:function(aF){var A=this;var aE=A.get(aw);ab.Array.each(aE,aF,A);},removeEvent:function(aE){var A=this;var aF=A.get(aw);if(aF.length){ab.Array.removeItem(aF,aE);A.set(aw,aF);}},removeEvents:function(aE){var A=this;ab.Array.each(A._normalizeEvents(aE),ab.bind(A.removeEvent,A));},_normalizeEvents:function(aF){var A=this;var aE=[];aF=ab.Array(aF);ab.Array.each(aF,function(aG){if(Z(aG)){aE.push(aG);}else{if(t(aG)){if(H(A)){aG.set(L,A);}aE=aE.concat(A._normalizeEvents(aG.get(aw)));}else{aG=new (A.get(ag))(aG);aE.push(aG);}}if(H(A)){aG.set(L,A);aG.set(ag,A.get(ag));}});return aE;},_setEvents:function(aE){var A=this;return A._normalizeEvents(aE);}});ab.SchedulerEventSupport=K;var G=ab.Component.create({NAME:r,ATTRS:{activeView:{validator:s},eventRecorder:{setter:"_setEventRecorder"},strings:{value:{day:"Day",month:"Month",today:"Today",week:"Week",year:"Year"}},navigationDateFormat:{getter:function(aF){var A=this;var aE=A.get(F);if(aE){return aE.get(ao);}return aF;},value:"%A - %d %b %Y",validator:av},views:{setter:"_setViews",value:[]},currentDate:{valueFn:function(){return new Date();},validator:d},firstDayOfWeek:{value:0,validator:I},controlsNode:{valueFn:function(){return ab.Node.create(al);}},currentDateNode:{valueFn:function(){return ab.Node.create(w);}},headerNode:{valueFn:function(){return ab.Node.create(b);}},iconNextNode:{valueFn:function(){return ab.Node.create(aD);}},iconPrevNode:{valueFn:function(){return ab.Node.create(ae);}},navNode:{valueFn:function(){return ab.Node.create(k);}},todayNode:{valueFn:function(){return ab.Node.create(this._processTemplate(Q));}},viewsNode:{valueFn:function(){return ab.Node.create(J);}}},HTML_PARSER:{controlsNode:T+an,currentDateNode:T+S,headerNode:T+f,iconNextNode:T+U,iconPrevNode:T+C,navNode:T+ay,todayNode:T+x,viewsNode:T+q},UI_ATTRS:[aa],AUGMENTS:[ab.SchedulerEventSupport,ab.WidgetStdMod],prototype:{viewStack:null,initializer:function(){var A=this;A[N]={};A[aj]=A.get(aj);A[X]=A.get(X);A[v]=A.get(at);A[j]=A.get(j);A[ap]=A.get(ap);A[M]=A.get(M);A[ac]=A.get(ac);A[W]=A.get(W);A.after({activeViewChange:A._afterActiveViewChange,render:A._afterRender});},bindUI:function(){var A=this;A._bindDelegate();},syncUI:function(){var A=this;A.syncStdContent();},flushEvents:function(){var A=this;ab.Array.each(A.get(aw),function(aE){aE.eachRepeatedEvent(function(aF){delete aF._filtered;});delete aE._filtered;});},getEventsByDay:function(aE,aF){var A=this;aE=h.safeClearTime(aE);return A._getEvents(aE,function(aG){return h.compare(aG.getClearStartDate(),aE)||(aF&&h.compare(aG.getClearEndDate(),aE));});},getIntersectEvents:function(aE){var A=this;aE=h.safeClearTime(aE);return A._getEvents(aE,function(aG){var aF=aG.getClearStartDate();var aH=aG.getClearEndDate();return(h.compare(aE,aF)||h.compare(aE,aH)||h.between(aE,aF,aH));});},sortEventsByDateAsc:function(aE){var A=this;aE.sort(function(aI,aG){var aH=aI.get(af);var aF=aG.get(af);var aK=aI.get(ax);var aJ=aG.get(ax);if(h.after(aK,aJ)||(h.compare(aK,aJ)&&h.before(aH,aF))){return 1;}else{return -1;}});},getViewByName:function(aE){var A=this;return A[N][aE];},getStrings:function(){var A=this;return A.get(D);},getString:function(aE){var A=this;return A.getStrings()[aE];},renderView:function(aE){var A=this;if(aE){aE.show();if(!aE.get(aA)){if(!A.bodyNode){A.setStdModContent(V.BODY,o);}aE.render(A.bodyNode);}}},plotViewEvents:function(aE){var A=this;aE.plotEvents(A.get(aw));},syncEventsUI:function(){var A=this;A.plotViewEvents(A.get(F));},_afterActiveViewChange:function(aG){var aE=this;if(aE.get(aA)){var aF=aG.newVal;var A=aG.prevVal;if(A){A.hide();}aE.renderView(aF);}},_afterRender:function(aE){var A=this;A.renderView(A.get(F));},_bindDelegate:function(){var A=this;A[W].delegate("click",A._onClickViewTrigger,T+Y,A);A[aj].delegate("click",A._onClickPrevIcon,T+C,A);A[aj].delegate("click",A._onClickNextIcon,T+U,A);A[aj].delegate("click",A._onClickToday,T+x,A);},_createViewTriggerNode:function(aE){var A=this;if(!aE.get(u)){var aF=aE.get(l);aE.set(u,ab.Node.create(O.sub(aq,{name:aF,label:(A.getString(aF)||aF)})));}return aE.get(u);},_getEvents:function(aE,aH){var A=this;var aG=A.get(aw);
var aF=[];ab.Array.each(aG,function(aI){if(aH.apply(A,[aI])){aF.push(aI);}else{if(aI.isRepeatableDate(aE)){var aJ=aI.repeatByDate(aE);aF.push(aJ);}}});A.sortEventsByDateAsc(aF);return aF;},_onClickToday:function(aE){var A=this;A.set(aa,A.get(F).getToday());aE.preventDefault();},_onClickNextIcon:function(aE){var A=this;A.set(aa,A.get(F).get(c));aE.preventDefault();},_onClickPrevIcon:function(aE){var A=this;A.set(aa,A.get(F).get(ak));aE.preventDefault();},_onClickViewTrigger:function(aE){var A=this;var aF=aE.currentTarget.attr(ah);A.set(F,A.getViewByName(aF));aE.preventDefault();},_processTemplate:function(aE){var A=this;return O.sub(aE,A.getStrings());},_setEventRecorder:function(aE){var A=this;if(aE){aE.set(L,A);aE.set(ag,A.get(ag));}},_setViews:function(aF){var A=this;var aE=[];ab.Array.each(aF,function(aG){if(s(aG)&&!aG.get(aA)){aG.set(L,A);aG.set(ag,A.get(ag));aE.push(aG);A[N][aG.get(l)]=aG;}});if(!A.get(F)){A.set(F,aF[0]);}return aE;},syncStdContent:function(){var A=this;var aE=A.get(aC);A[M].append(A[ap]);A[M].append(A[j]);A[aj].append(A[ac]);A[aj].append(A[M]);A[aj].append(A[X]);ab.Array.each(aE,function(aF){A[W].append(A._createViewTriggerNode(aF));});A[v].append(A[aj]);A[v].append(A[W]);A[v].addClass(ad);A.setStdModContent(V.HEADER,A[v].getDOM());},_uiSetCurrentDate:function(aG){var A=this;var aF=ab.DataType.Date.format(aG,{format:A.get(ao),locale:A.get(az)});A[X].html(aF);if(A.get(aA)){var aE=A.get(F);if(aE){aE._uiSetCurrentDate(aG);}A.syncEventsUI();}}}});ab.Scheduler=G;},"@VERSION@",{skinnable:true,requires:["aui-scheduler-view","datasource"]});