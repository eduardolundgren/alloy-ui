AUI.add("aui-scheduler-base",function(ac){var P=ac.Lang,aw=P.isString,a=P.isArray,d=P.isDate,I=P.isNumber,B=P.isObject,H=function(A){return(A instanceof ac.Scheduler);},s=function(A){return(A instanceof ac.SchedulerView);},aa=function(A){return(A instanceof ac.SchedulerEvent);},t=function(A){return(ac.SchedulerCalendar&&(A instanceof ac.SchedulerCalendar));},h=ac.DataType.DateMath,W=ac.WidgetStdMod,U=".",o="",p=" ",r="scheduler-base",ai="data-view-name",F="activeView",av="clearfix",E="controls",ak="controlsNode",an="current",ab="currentDate",Y="currentDateNode",aj="date",ag="endDate",ah="eventClass",N="eventRecorder",ax="events",aC="hd",v="header",au="headerNode",m="helper",S="icon",j="iconNextNode",aq="iconPrevNode",aA="locale",l="name",Q="nav",M="navNode",ap="navigationDateFormat",n="next",c="nextDate",at="prev",al="prevDate",aB="rendered",L="scheduler",ay="startDate",D="strings",e="today",ad="todayNode",u="triggerNode",y="view",O="viewStack",aD="views",X="viewsNode",z=ac.getClassName,ae=z(m,av),i=z(S),ao=z(r,E),T=z(r,an,aj),f=z(r,aC),V=z(r,S,n),C=z(r,S,at),az=z(r,Q),x=z(r,e),Z=z(r,y),g=z(r,y,o),q=z(r,aD),am='<div class="'+ao+'"></div>',w='<div class="'+T+'"></div>',b='<div class="'+f+'"></div>',aE='<a href="#" class="'+[i,V].join(p)+'">Next</a>',af='<a href="#" class="'+[i,C].join(p)+'">Prev</a>',k='<div class="'+az+'"></div>',R='<a href="#" class="'+x+'">{today}</a>',ar='<a href="#" class="'+[Z,g].join(p)+'{name}" data-view-name="{name}">{label}</a>',J='<div class="'+q+'"></div>';var K=function(){};K.ATTRS={eventClass:{valueFn:function(){return ac.SchedulerEvent;}},events:{value:[],setter:"_setEvents",validator:a}};ac.mix(K.prototype,{addEvent:function(aF){var A=this;var aG=A.get(ax);if(ac.Array.indexOf(aG,aF)>-1){ac.Array.removeItem(aG,aF);}aG.push(aF);A.set(ax,aG);},addEvents:function(aF){var A=this;ac.Array.each(A._normalizeEvents(aF),ac.bind(A.addEvent,A));},eachEvent:function(aG){var A=this;var aF=A.get(ax);ac.Array.each(aF,aG,A);},removeEvent:function(aF){var A=this;var aG=A.get(ax);if(aG.length){ac.Array.removeItem(aG,aF);A.set(ax,aG);}},removeEvents:function(aF){var A=this;ac.Array.each(A._normalizeEvents(aF),ac.bind(A.removeEvent,A));},_normalizeEvents:function(aG){var A=this;var aF=[];aG=ac.Array(aG);ac.Array.each(aG,function(aH){if(aa(aH)){aF.push(aH);}else{if(t(aH)){if(H(A)){aH.set(L,A);}aF=aF.concat(A._normalizeEvents(aH.get(ax)));}else{aH=new (A.get(ah))(aH);aF.push(aH);}}if(H(A)){aH.set(L,A);aH.set(ah,A.get(ah));}});return aF;},_setEvents:function(aF){var A=this;return A._normalizeEvents(aF);}});ac.SchedulerEventSupport=K;var G=ac.Component.create({NAME:r,ATTRS:{activeView:{validator:s},eventRecorder:{setter:"_setEventRecorder"},strings:{value:{day:"Day",month:"Month",today:"Today",week:"Week",year:"Year"}},navigationDateFormat:{getter:function(aG){var A=this;var aF=A.get(F);if(aF){return aF.get(ap);}return aG;},value:"%A - %d %b %Y",validator:aw},views:{setter:"_setViews",value:[]},currentDate:{valueFn:function(){return new Date();},validator:d},firstDayOfWeek:{value:0,validator:I},controlsNode:{valueFn:function(){return ac.Node.create(am);}},currentDateNode:{valueFn:function(){return ac.Node.create(w);}},headerNode:{valueFn:function(){return ac.Node.create(b);}},iconNextNode:{valueFn:function(){return ac.Node.create(aE);}},iconPrevNode:{valueFn:function(){return ac.Node.create(af);}},navNode:{valueFn:function(){return ac.Node.create(k);}},todayNode:{valueFn:function(){return ac.Node.create(this._processTemplate(R));}},viewsNode:{valueFn:function(){return ac.Node.create(J);}}},HTML_PARSER:{controlsNode:U+ao,currentDateNode:U+T,headerNode:U+f,iconNextNode:U+V,iconPrevNode:U+C,navNode:U+az,todayNode:U+x,viewsNode:U+q},UI_ATTRS:[ab],AUGMENTS:[ac.SchedulerEventSupport,ac.WidgetStdMod],prototype:{viewStack:null,initializer:function(){var A=this;A[O]={};A[ak]=A.get(ak);A[Y]=A.get(Y);A[v]=A.get(au);A[j]=A.get(j);A[aq]=A.get(aq);A[M]=A.get(M);A[ad]=A.get(ad);A[X]=A.get(X);A.after({activeViewChange:A._afterActiveViewChange,render:A._afterRender});},bindUI:function(){var A=this;A._bindDelegate();},syncUI:function(){var A=this;A.syncStdContent();},flushEvents:function(){var A=this;ac.Array.each(A.get(ax),function(aF){aF.eachRepeatedEvent(function(aG){delete aG._filtered;});delete aF._filtered;});},getEventsByDay:function(aF,aG){var A=this;aF=h.safeClearTime(aF);return A._getEvents(aF,function(aH){return h.compare(aH.getClearStartDate(),aF)||(aG&&h.compare(aH.getClearEndDate(),aF));});},getIntersectEvents:function(aF){var A=this;aF=h.safeClearTime(aF);return A._getEvents(aF,function(aH){var aG=aH.getClearStartDate();var aI=aH.getClearEndDate();return(h.compare(aF,aG)||h.compare(aF,aI)||h.between(aF,aG,aI));});},sortEventsByDateAsc:function(aF){var A=this;aF.sort(function(aJ,aH){var aI=aJ.get(ag);var aG=aH.get(ag);var aL=aJ.get(ay);var aK=aH.get(ay);if(h.after(aL,aK)||(h.compare(aL,aK)&&h.before(aI,aG))){return 1;}else{return -1;}});},getViewByName:function(aF){var A=this;return A[O][aF];},getStrings:function(){var A=this;return A.get(D);},getString:function(aF){var A=this;return A.getStrings()[aF];},renderView:function(aF){var A=this;if(aF){aF.show();if(!aF.get(aB)){if(!A.bodyNode){A.setStdModContent(W.BODY,o);}aF.render(A.bodyNode);}}},plotViewEvents:function(aF){var A=this;aF.plotEvents(A.get(ax));},syncEventsUI:function(){var A=this;A.plotViewEvents(A.get(F));},_afterActiveViewChange:function(aH){var aF=this;if(aF.get(aB)){var aG=aH.newVal;var A=aH.prevVal;if(A){A.hide();}aF.renderView(aG);var aI=aF.get(N);if(aI){aI.hideOverlay();}}},_afterRender:function(aF){var A=this;A.renderView(A.get(F));},_bindDelegate:function(){var A=this;A[X].delegate("click",A._onClickViewTrigger,U+Z,A);A[ak].delegate("click",A._onClickPrevIcon,U+C,A);A[ak].delegate("click",A._onClickNextIcon,U+V,A);A[ak].delegate("click",A._onClickToday,U+x,A);},_createViewTriggerNode:function(aF){var A=this;if(!aF.get(u)){var aG=aF.get(l);aF.set(u,ac.Node.create(P.sub(ar,{name:aG,label:(A.getString(aG)||aG)})));}return aF.get(u);
},_getEvents:function(aF,aI){var A=this;var aH=A.get(ax);var aG=[];ac.Array.each(aH,function(aJ){if(aI.apply(A,[aJ])){aG.push(aJ);}else{if(aJ.isRepeatableDate(aF)){var aK=aJ.repeatByDate(aF);aG.push(aK);}}});A.sortEventsByDateAsc(aG);return aG;},_onClickToday:function(aF){var A=this;A.set(ab,A.get(F).getToday());aF.preventDefault();},_onClickNextIcon:function(aF){var A=this;A.set(ab,A.get(F).get(c));aF.preventDefault();},_onClickPrevIcon:function(aF){var A=this;A.set(ab,A.get(F).get(al));aF.preventDefault();},_onClickViewTrigger:function(aF){var A=this;var aG=aF.currentTarget.attr(ai);A.set(F,A.getViewByName(aG));aF.preventDefault();},_processTemplate:function(aF){var A=this;return P.sub(aF,A.getStrings());},_setEventRecorder:function(aF){var A=this;if(aF){aF.set(L,A);aF.set(ah,A.get(ah));}},_setViews:function(aG){var A=this;var aF=[];ac.Array.each(aG,function(aH){if(s(aH)&&!aH.get(aB)){aH.set(L,A);aH.set(ah,A.get(ah));aF.push(aH);A[O][aH.get(l)]=aH;}});if(!A.get(F)){A.set(F,aG[0]);}return aF;},syncStdContent:function(){var A=this;var aF=A.get(aD);A[M].append(A[aq]);A[M].append(A[j]);A[ak].append(A[ad]);A[ak].append(A[M]);A[ak].append(A[Y]);ac.Array.each(aF,function(aG){A[X].append(A._createViewTriggerNode(aG));});A[v].append(A[ak]);A[v].append(A[X]);A[v].addClass(ae);A.setStdModContent(W.HEADER,A[v].getDOM());},_uiSetCurrentDate:function(aH){var A=this;var aG=ac.DataType.Date.format(aH,{format:A.get(ap),locale:A.get(aA)});A[Y].html(aG);if(A.get(aB)){var aF=A.get(F);if(aF){aF._uiSetCurrentDate(aH);}A.syncEventsUI();}}}});ac.Scheduler=G;},"@VERSION@",{skinnable:true,requires:["aui-scheduler-view","datasource"]});