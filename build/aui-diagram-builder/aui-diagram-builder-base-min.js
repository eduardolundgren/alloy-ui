AUI.add("aui-diagram-builder-base",function(aj){var Y=aj.Lang,d=Y.isArray,az=Y.isBoolean,P=Y.isNumber,G=Y.isObject,aD=Y.isString,N=function(A){return(A instanceof aj.ArrayList);},W=function(A){return(A instanceof aj.Node);},I=function(A){return(A instanceof aj.AvailableField);},aM=aj.Array,Z="add",o="addNode",aL="auto",Q="availableField",U="availableFields",aI="availableFieldsDragConfig",v="boundingBox",aF="builder",ad="cancel",ag="canvas",aB="clearfix",f="column",a="container",ah="content",y="contentBox",e="contentContainer",T="contentNode",J="createDocumentFragment",E="diagram",aq="diagram-builder",ae="disk",r="draggable",aH="drop",au="dropConfig",ac="dropContainer",ay="field",w="fields",q="fieldsContainer",ax="height",s="helper",ab="icon",z="iconClass",at="id",an="label",x="layout",ar="list",S="maxFields",u="node",g="parentNode",ai="propertyList",aG="rendered",av="save",t="settings",R="tab",L="tabView",b="tabs",h="tabview",O="toolbar",m="toolbarContainer",ao="unique",D=aj.getClassName,aK=" ",i=".",j="#",aK=" ",F="_",n=D(f),C=D(E,aF,ag),ak=D(E,aF,ah,a),H=D(E,aF,aH,a),aA=D(E,aF,ay),l=D(E,aF,ay,r),c=D(E,aF,ay,ab),af=D(E,aF,ay,an),B=D(E,aF,ao),aa=D(E,aF,w,a),al=D(E,aF,R,Z),M=D(E,aF,R,t),aw=D(E,aF,b),V=D(E,aF,b,ah),ap=D(E,aF,O,a),am=D(s,aB),p=D(ab),K=D(x),aE=D(h,ah),aJ=D(h,ar);var k=aj.Component.create({NAME:Q,ATTRS:{draggable:{value:true,validator:az},label:{validator:aD},iconClass:{validator:aD},id:{value:aj.guid(),setter:"_setId",validator:aD},node:{valueFn:function(aN){var A=this;if(!W(aN)){aN=aj.Node.create(aj.Lang.sub(A.FIELD_ITEM_TEMPLATE,{iconClass:A.get(z)}));aN.setData(Q,A);}return aN;},validator:W,writeOnce:true},type:{value:u,validator:aD},unique:{value:false,validator:az}},EXTENDS:aj.Base,buildNodeId:function(A){return U+F+ay+F+A;},getAvailableFieldById:function(A){return aj.AvailableField.getAvailableFieldByNode(j+aj.AvailableField.buildNodeId(A));},getAvailableFieldByNode:function(A){return aj.one(A).getData(Q);},prototype:{FIELD_ITEM_TEMPLATE:'<li class="'+aA+'">'+'<span class="'+[p,c].join(aK)+' {iconClass}"></span>'+'<div class="'+af+'"></div>'+"</li>",initializer:function(){var A=this;var aN=A.get(u);A.after({draggableChange:A._afterDraggableChange,idChange:A._afterIdChange,labelChange:A._afterLabelChange});A.labelNode=aN.one(i+af);A._uiSetDraggable(A.get(r));A._uiSetId(A.get(at));A._uiSetLabel(A.get(an));A._uiSetUnique(A.get(ao));},_afterDraggableChange:function(aN){var A=this;A._uiSetDraggable(aN.newVal);},_afterIdChange:function(aN){var A=this;A._uiSetId(aN.newVal);},_afterLabelChange:function(aN){var A=this;A._uiSetLabel(aN.newVal);},_setId:function(A){return aj.AvailableField.buildNodeId(A);},_uiSetDraggable:function(aN){var A=this;A.get(u).toggleClass(l,aN);},_uiSetId:function(aN){var A=this;A.get(u).set(at,aN);},_uiSetLabel:function(aN){var A=this;A.labelNode.setContent(aN);},_uiSetUnique:function(aN){var A=this;A.get(u).toggleClass(B,aN);}}});aj.AvailableField=k;var X=function(){};X.ATTRS={fields:{value:[],setter:"_setFields",validator:function(A){return d(A)||N(A);}},maxFields:{value:Infinity,validator:P}};aj.mix(X.prototype,{_setFields:function(aN){var A=this;if(N(aN)){return aN;}else{return A.createFields(aN);}},_updateFields:function(aN){var A=this;A.set(w,aN);},addField:function(aO,aN){var A=this;if(A.get(w).size()<A.get(S)){var aP=A.createField(aO);if(aP){A._updateFields(A.get(w).add(aP,aN));}return aP;}return null;},createFields:function(aO){var aN=this;var A=[];aM.each(aO,function(aQ,aP){if(aP<aN.get(S)){A.push(aN.createField(aQ));}});return new aj.ArrayList(A);},removeField:function(aN){var A=this;A._updateFields(A.get(w).remove(aN));},createField:function(A){return A;}});aj.FieldSupport=X;var aC=aj.Component.create({NAME:aq,ATTRS:{availableFields:{setter:"_setAvailableFields",validator:d},availableFieldsDragConfig:{value:null,setter:"_setAvailableFieldsDragConfig",validator:G},canvas:{valueFn:function(){return aj.Node.create(this.CANVAS_TEMPLATE);}},dropConfig:{value:null,setter:"_setDropConfig",validator:G},contentContainer:{valueFn:function(){return aj.Node.create(this.CONTENT_CONTAINER_TEMPLATE);}},dropContainer:{valueFn:function(){return aj.Node.create(this.DROP_CONTAINER_TEMPLATE);}},fieldsContainer:{valueFn:function(){return aj.Node.create(this.FIELDS_CONTAINER_TEMPLATE);}},propertyList:{setter:"_setPropertyList",validator:G,value:null},strings:{value:{addNode:"Add node",cancel:"Cancel",propertyName:"Property Name",save:"Save",settings:"Settings",value:"Value"}},tabView:{setter:"_setTabView",validator:G,value:null,writeOnce:true},toolbar:{setter:"_setToolbar",validator:G,value:null},toolbarContainer:{valueFn:function(){return aj.Node.create(this.TOOLBAR_CONTAINER_TEMPLATE);}}},HTML_PARSER:{contentContainer:i+ak,dropContainer:i+H,fieldsContainer:i+aa,toolbarContainer:i+ap,canvas:i+C},UI_ATTRS:[U,w],AUGMENTS:[aj.FieldSupport],prototype:{CONTENT_CONTAINER_TEMPLATE:'<div class="'+ak+'"></div>',DROP_CONTAINER_TEMPLATE:'<div class="'+H+'"></div>',TOOLBAR_CONTAINER_TEMPLATE:'<div class="'+ap+'"></div>',FIELDS_CONTAINER_TEMPLATE:'<ul class="'+[aa,am].join(aK)+'"></ul>',CANVAS_TEMPLATE:'<div tabindex="1" class="'+C+'"></div>',fieldsNode:null,propertyList:null,settingsNode:null,tabView:null,toolbar:null,initializer:function(){var A=this;A.publish({cancel:{defaultFn:A._defCancelFn}});A.after({render:A._afterRender,"recordset:update":A._afterRecordsetUpdate});A.after(A._afterUiSetHeight,A,"_uiSetHeight");A.canvas=A.get(ag);A.contentContainer=A.get(e);A.dropContainer=A.get(ac);A.fieldsContainer=A.get(q);A.toolbarContainer=A.get(m);},isAvailableFieldsDrag:function(aO){var A=this;var aN=A.availableFieldsDrag;return(aO===aN.dd);},plotFields:function(){var aN=this;var A=aN.get(w);A.each(function(aO){aN.plotField(aO);});},renderUI:function(){var A=this;A._renderTabs();A._renderCanvas();A._uiSetAvailableFields(A.get(U));},syncUI:function(){var A=this;var aN=A.get(y);A._setupDrop();A._setupAvailableFieldsDrag();aN.addClass(K);},_afterActiveTabChange:function(aO){var A=this;
var aN=aO.newVal.get(T);if(A.get(aG)&&(aN===A.settingsNode)){A._renderSettings();}},_afterRecordsetUpdate:function(aN){var A=this;A._handleSaveEvent();},_afterRender:function(aN){var A=this;A.plotFields();},_afterUiSetHeight:function(aN){var A=this;A.contentContainer.setStyle(ax,P(aN)?aN+A.DEF_UNIT:aN);A.dropContainer.setStyle(ax,P(aN)?aN+A.DEF_UNIT:aN);},_defCancelFn:function(aN){var A=this;A.tabView.selectTab(0);},_handleCancelEvent:function(){var A=this;A.fire(ad);},_handleSaveEvent:function(){var A=this;A.fire(av);},_renderCanvas:function(){var A=this;var aN=A.get(y);var aO=A.canvas;var aP=A.contentContainer;var aQ=A.dropContainer;if(!aO.inDoc()){aP.appendChild(aO);}if(!aQ.inDoc()){aO.appendChild(aQ);}if(aP.inDoc()){aP.get(g).append(aP);}else{aN.appendChild(aP);}},_renderPropertyList:function(){var A=this;if(!A.propertyList){A.propertyList=new aj.PropertyList(A.get(ai)).render(A.settingsNode);A.propertyList.get(v).unselectable();}},_renderSettings:function(){var A=this;A._renderPropertyList();A._renderToolbar();},_renderTabs:function(){var A=this;if(!A.tabView){var aN=new aj.TabView(A.get(L));aN.get(v);A.tabView=aN;A.fieldsNode=aN.getTab(0).get(T);A.settingsNode=aN.getTab(1).get(T);}},_renderToolbar:function(){var A=this;if(!A.toolbar){A.toolbar=new aj.Toolbar(A.get(O)).render(A.settingsNode);}},_setupDrop:function(){var A=this;A.drop=new aj.DD.Drop(A.get(au));},_setupAvailableFieldsDrag:function(){var A=this;A.availableFieldsDrag=new aj.DD.Delegate(A.get(aI));},_setAvailableFields:function(aO){var aN=this;var A=[];aM.each(aO,function(aQ,aP){A.push(I(aQ)?aQ:new aj.AvailableField(aQ));});return A;},_setDropConfig:function(aN){var A=this;return aj.merge({bubbleTargets:A,groups:[U],node:A.dropContainer},aN||{});},_setAvailableFieldsDragConfig:function(aN){var A=this;return aj.merge({bubbleTargets:A,container:A.get(v),dragConfig:{groups:[U],plugins:[{cfg:{moveOnEnd:false},fn:aj.Plugin.DDProxy}]},nodes:i+l},aN||{});},_setPropertyList:function(aN){var A=this;return aj.merge({bubbleTargets:A,width:250,scroll:{height:400,width:aL}},aN);},_setTabView:function(aQ){var aN=this;var aP=aN.get(v);var aR=aP.one(i+aJ);var aO={after:{activeTabChange:aj.bind(aN._afterActiveTabChange,aN)},boundingBox:aP.one(i+aw),contentBox:aP.one(i+V),bubbleTargets:aN,contentNode:aP.one(i+aE),cssClass:aw,listNode:aR,render:aN.get(y)};if(!aR){var A=aN.getStrings();aO.items=[{cssClass:al,label:A[o]},{cssClass:M,label:A[t]}];}return aj.merge(aO,aQ);},_setToolbar:function(aO){var aN=this;var A=aN.getStrings();return aj.merge({activeState:false,bubbleTargets:aN,children:[{handler:aj.bind(aN._handleCancelEvent,aN),label:A[ad]}]},aO);},_uiSetAvailableFields:function(aP){var A=this;var aO=A.fieldsNode;if(aO){var aN=aj.getDoc().invoke(J);aM.each(aP,function(aQ){aN.appendChild(aQ.get(u));});aO.setContent(A.fieldsContainer.setContent(aN));}},_uiSetFields:function(aN){var A=this;if(A.get(aG)){A.plotFields();}}}});aj.DiagramBuilderBase=aC;},"@VERSION@",{requires:["aui-tabs","aui-property-list","collection","dd"],skinnable:true});