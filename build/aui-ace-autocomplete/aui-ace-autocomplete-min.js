AUI.add("aui-ace-autocomplete",function(v){var ak=v.Lang,B=v.Array,N=v.Do,q="insertText",ah="exec",E="host",j="processor",l=-1,ab=0,O="ace-autocomplete-base";var p=function(){};p.prototype={initializer:function(){var A=this;A._editorCommands=[];v.after(this._bindUIACBase,this,"renderUI");var al=A.get(j);if(al&&!al.get(E)){al.set(E,A);}},_addSuggestion:function(am){var A=this;var al=A._getEditor();var an=A.get(j).getSuggestion(A._matchParams.match,am);al.insert(an);al.focus();A.fire("addSuggestion",an);return new N.Halt(null);},_bindUIACBase:function(){var A=this;A.publish("cursorChange",{defaultFn:A._defaultCursorChangeFn});var al=A._getEditor();al.on("change",v.bind(A._onEditorChange,A));al.commands.addCommand({name:"showAutoComplete",bindKey:v.merge(A.get("showListKey"),{sender:"editor|cli"}),exec:function(ao,an,ap){var am=al.getCursorPosition();A._processAutoComplete(am.row,am.column);}});al.getSelection().on("changeCursor",v.bind(A._onEditorChangeCursor,A));A.on("destroy",A._destroyUIACBase,A);},_defaultCursorChangeFn:function(A){var aq=this;var an=aq._getEditor();var al=an.getCursorPosition();var ar=al.row;var am=al.column;var ao=aq._matchParams;if(ar!==ao.row||am<ao.match.start){aq.fire("cursorOut");}else{var at=an.getSession().getLine(ar);var ap=at.substring(ao.match.start,am);if(!aq.get(j).getMatch(ap)){aq.fire("match");}}},_destroyUIACBase:function(){var A=this;A._removeAutoCompleteCommands();},_getEditor:function(){var A=this;return A.get("host").getEditor();},_handleEnter:function(am){var A=this;if(am==="\n"||am==="\t"){var al=A._getSelectedEntry();return A._addSuggestion(al);}},_onEditorChange:function(ap){var A=this;var aq=ap.data;var ar=aq.action;if(ar===q||ar==="removeText"){var an=aq.range;var ao=an.start.column;var am=an.end.row;var al=an.start.row;if(ar===q&&al===am){A._processAutoComplete(al,ao+1);}A.fire(ar,{column:ao,dataRange:an,endRow:am,startRow:al});}},_onEditorChangeCursor:function(al){var A=this;A.fire("cursorChange",A._getEditor().getCursorPosition());},_onResultsError:function(al){var A=this;A.fire("resultsError",al);},_onResultsSuccess:function(al){var A=this;A.set("results",al);},_overwriteCommands:function(){var al=this;var am=al._getEditor();var A=am.commands.commands;al._editorCommands.push(N.before(al._handleEnter,am,"onTextInput",this),N.before(al._handleKey,A["golinedown"],ah,this,40),N.before(al._handleKey,A["golineup"],ah,this,38),N.before(al._handleKey,A["gotoend"],ah,this,35),N.before(al._handleKey,A["gotolineend"],ah,this,35),N.before(al._handleKey,A["gotolinestart"],ah,this,36),N.before(al._handleKey,A["gotopagedown"],ah,this,34),N.before(al._handleKey,A["gotopageup"],ah,this,33),N.before(al._handleKey,A["gotostart"],ah,this,36));},_processAutoComplete:function(ar,am){var aq=this;var al=am;var ao=aq._getEditor();var at=ao.getSession().getLine(ar);at=at.substring(0,am);var A=aq.get(j);var an=A.getMatch(at);var ap;if(ak.isObject(an)){ap=ao.renderer.textToScreenCoordinates(ar,am);aq._matchParams={column:am,match:an,row:ar};A.getResults(an,v.bind(aq._onResultsSuccess,aq),v.bind(aq._onResultsError,aq));}aq.fire("match",{column:am,coords:ap,line:at,match:an,row:ar});},_removeAutoCompleteCommands:function(){var A=this;B.invoke(A._editorCommands,"detach");A._editorCommands.length=0;}};p.NAME=O;p.NS=O;p.ATTRS={processor:{validator:function(A){return ak.isObject(A)||ak.isFunction(A);}},showListKey:{validator:ak.isObject,value:{mac:"Alt-Space",win:"Ctrl-Space"}}};v.AceEditor.AutoCompleteBase=p;var ak=v.Lang,B=v.Array,N=v.Do,g=v.getClassName,ae="data-index",O="ace-autocomplete-list",d="container",F=".",e="empty",n="",P="entry",J="highlighted",U="list",D="loading",S="offsetHeight",R="previous",K="region",af="results",L="selected",a=" ",aj="visible",u="ace-autocomplete",i=g(u,P),Z=g(u,P,d),I=g(u,P,d,J),z=g(u,P,e),ad=g(u,P,D),T=g(u,P,D),f=g(u,af),Y=F+Z,t=Y+F+L,ag=t+a+F+i,x=40,m=35,aa=34,H=33,h=36,W=38,V=5,X=20;var M=v.Component.create({NAME:O,NS:O,ATTRS:{emptyMessage:{validator:ak.isString,value:"No suggestions"},host:{validator:ak.isObject},listNode:{value:null},loadingMessage:{validator:ak.isString,value:"Loading"},results:{validator:ak.isArray},selectedEntry:{getter:"_getSelectedEntry"}},AUGMENTS:[v.AceEditor.AutoCompleteBase,v.WidgetAutohide],CSS_PREFIX:u,EXTENDS:v.OverlayBase,HTML_PARSER:{listNode:F+f},prototype:{bindUI:function(){var A=this;A.on("addSuggestion",A.hide,A);A.on("cursorChange",A._onCursorChange,A);A.on("cursorOut",A.hide,A);A.on("insertText",A._onInsertText,A);A.on("match",A._onMatch,A);A.on("removeText",A._onRemoveText,A);A.on("resultsChange",A._onResultsChange,A);A.on("resultsError",A._setEmptyResults,A);A.on("showLoadingMessage",A._onShowLoadingMessage,A);A.on("visibleChange",A._onVisibleChange,A);},renderUI:function(){var A=this;var al=A.get("listNode");if(!al){al=A._createListNode();}al.delegate("click",A._handleResultListClick,Y,A);al.delegate("mouseenter",A._onMouseEnter,Y,A);al.delegate("mouseleave",A._onMouseLeave,Y);A._autoCompleteResultsList=al;},_createListNode:function(){var A=this;var al=v.Node.create(A.TPL_LIST);A.get("contentBox").append(al);return al;},_getEntriesPerPage:function(){var A=this;var am=A._entriesPerPage;if(!am){var al=A._autoCompleteResultsList;var an=al.one(Y).get(S);var ao=al.get(S);am=Math.floor(ao/an);A._entriesPerPage=am;}return am;},_getSelectedEntry:function(){var A=this;var al;var am=A._autoCompleteResultsList.one(ag);if(am){al=am.text();}return al;},_handleArrows:function(aq){var A=this;var ap;if(aq===W){ap=R;}else{if(aq===x){ap="next";}}if(ap){var an=A._autoCompleteResultsList;var am=an.one(t);if(am){var ao=am[ap](Y);if(ao){am.removeClass(L);ao.addClass(L);var ar=an.get(K);var al=ao.get(K);if(ap===R){if(al.top<ar.top){ao.scrollIntoView(true);}else{if(al.top>ar.bottom){ao.scrollIntoView();}}}else{if(al.top+al.height>ar.bottom){ao.scrollIntoView();}else{if(al.top+al.height<ar.top){ao.scrollIntoView(true);}}}}}return new N.Halt(null);}},_handleKey:function(am,ao,an){var al=this;var A;if(al.get(aj)){if(an===W||an===x){A=al._handleArrows(an);
}else{if(an===H||an===aa){A=al._handlePageUpDown(an);}else{if(an===m||an===h){A=al._handleStartEnd(an);}}}}return A;},_handlePageUpDown:function(at){var aq=this;var an=aq._autoCompleteResultsList;var ar=aq._getEntriesPerPage();var ap=an.one(t);var A=ak.toInt(ap.attr(ae));var ao;var au=n;var al=false;if(at===H){ao=A-ar;al=true;}else{if(at===aa){ao=A+ar;au=":last-child";}}var am=an.one(Y+"["+ae+'="'+ao+'"]');if(!am){am=an.one(Y+au);}if(ap!==am){ap.removeClass(L);am.addClass(L);am.scrollIntoView(al);}return new N.Halt(null);},_handleResultListClick:function(an){var A=this;var ao=an.currentTarget;var al=A._autoCompleteResultsList.one(t);if(ao!==al){al.removeClass(L);ao.addClass(L);}var am=ao.text();A._addSuggestion(am);A.fire("entrySelected",{content:am});},_handleStartEnd:function(ap){var A=this;var an;var ao=false;var am=A._autoCompleteResultsList;if(ap===m){an=am.one(Y+":last-child");}else{if(ap===h){an=am.one(Y);ao=true;}}var al=am.one(t);if(an!==al){al.removeClass(L);an.addClass(L);an.scrollIntoView(ao);}return new N.Halt(null);},_onCursorChange:function(al){var A=this;if(!A.get(aj)){al.preventDefault();}},_onInsertText:function(al){var A=this;if(al.startRow!==al.endRow&&A.get(aj)){A.hide();}},_onMatch:function(al){var A=this;if(al.match){var am=al.coords;A.set("xy",[am.pageX+V,am.pageY+X]);}else{if(A.get(aj)){A.hide();}}},_onMouseEnter:function(A){A.currentTarget.addClass(I);},_onMouseLeave:function(A){A.currentTarget.removeClass(I);},_onRemoveText:function(al){var A=this;if(A.get(aj)){A.hide();}},_onResultsChange:function(ap){var A=this;var al=A._autoCompleteResultsList;al.empty();var an=ap.newVal;var ao=A.TPL_ENTRY;B.each(an,function(ar,aq){al.appendChild(ak.sub(ao,{index:aq,value:ar}));});var am=al.one(Y);if(am){am.addClass(L);if(!A.get(aj)){A.show();}}else{if(A.get(aj)){A.hide();}}},_onShowLoadingMessage:function(am){var A=this;var al=A._autoCompleteResultsList;al.empty();al.appendChild(ak.sub(A.TPL_LOADING,{label:A.get("loadingMessage")}));if(!A.get(aj)){A.show();}},_onVisibleChange:function(al){var A=this;if(al.newVal){A._overwriteCommands();}else{A._removeAutoCompleteCommands();}},_setEmptyResults:function(){var A=this;A.set("results",[]);},TPL_ENTRY:'<li class="'+Z+'" data-index="{index}">'+'<span class="'+i+'">{value}</span>'+"</li>",TPL_LIST:'<ul class="'+f+'"/>',TPL_LOADING:'<li class="'+Z+'">'+'<span class="aui-icon-loading '+ad+'">{label}</span>'+"</li>",TPL_RESULTS_EMPTY:'<li class="'+Z+'">'+'<span class="'+z+'">{label}</span>'+"</li>"}});v.AceEditor.AutoCompleteList=M;v.AceEditor.AutoComplete=M;var ak=v.Lang,B=v.Array,y=v.Object,b=["flush","recover","fallback","local","break","lt","case","global","if","compress","escape","assign","elseif","noescape","setting","list","else","switch","include","recurse","rt","ftl","macro","stop","nt","visit","attempt","nested","import","default","return","t","function"],o=0,w=1,c=/<#[\w.]*>?$/,s=/\$\{[\w., ()"]*\}?$/,l=-1,ab=0,ac="all",F=".",r="",ai="responseData",Q="variables",O="aui-ace-autocomplete-freemarker";var k=v.Component.create({NAME:O,NS:O,ATTRS:{host:{validator:ak.isObject},variables:{validator:ak.isObject}},EXTENDS:v.Base,prototype:{initializer:function(al){var A=this;A._tstree=new v.TernarySearchTree();},getMatch:function(an){var al=this;var am;var A;if((A=an.lastIndexOf("<"))>=0){an=an.substring(A);if(c.test(an)){am={content:an.substring(2),start:A,type:o};}}else{if((A=an.lastIndexOf("$"))>=0){an=an.substring(A);if(s.test(an)){am={content:an.substring(2),start:A,type:w};}}}return am;},getResults:function(al,ar,aq){var at=this;var am=at._tstree;var ap=al.type;if(ap===o){var ao=b;var an=al.content;if(an.length){if(at._lastTSTLoad!==o){at._addDirectives();}ao=am.prefixSearch(an);}ar(ao);}else{if(ap===w){var A=at._getVariableMatches(al.content);ar(A);}}},getSuggestion:function(an,ao){var al=this;var A=ao||r;if(ao){var ap=an.type;if(ap===o){if(an.content&&ao.indexOf(an.content)===0){A=ao.substring(an.content.length);}}else{if(ap===w){var aq=an.content.split(F);var am=aq[aq.length-1];if(am&&ao.indexOf(am)===0){A=ao.substring(am.length);}}}}return A;},_addData:function(am){var A=this;var al=A._tstree;al.empty();B.each(am,function(ao,an){al.add(ao);});},_addDirectives:function(){var A=this;A._addData(b);A._lastTSTLoad=o;},_getVariableMatches:function(ap){var ar=this;var at=ap.split(F);var A=ar.get(Q);var aq=at[at.length-1];at.length-=1;var al;if(at.length>0){for(var am=0;am<at.length;am++){al=at[am];if(ak.isObject(A)){A=A[al];}}}var an=[];if(ak.isObject(A)){B.each(y.keys(A),function(av,au){an.push(av);});if(aq){var ao=ar._tstree;ao.empty();B.each(an,function(av,au){ao.add(av);});an=ao.prefixSearch(aq);ar._lastTSTLoad=w;}}return an;}}});k.DIRECTIVES=b;v.AceEditor.AutoCompleteFreemarker=k;var C=v.Plugin;function G(A){if(!A.render&&A.render!==false){A.render=true;}G.superclass.constructor.apply(this,arguments);}v.extend(G,v.AceEditor.AutoCompleteList,{},{CSS_PREFIX:"aui-ace-autocomplete",NAME:"aui-ace-autocomplete-plugin",NS:"aui-ace-autocomplete-plugin"});C.AceAutoComplete=G;C.AceAutoCompleteList=G;},"@VERSION@",{requires:["aui-ace-editor","aui-overlay-base","plugin","aui-search-ternary-search-tree","aui-io-request","widget-autohide"],skinnable:true});