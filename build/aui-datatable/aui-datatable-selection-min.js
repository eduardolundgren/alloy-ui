AUI.add("aui-datatable-selection",function(q){var d=q.Lang,m=d.isArray,k=d.isBoolean,o=d.isString,l=d.isObject,u="CLASS_NAMES_SELECTION",i="activeCell",w="boundingBox",h="cell",c="cellIndex",r="container",n="focused",b="key",j="mousedown",t="mouseenter",g="mouseup",e="selected",s="selection",f="children",v=".",p=function(z,y,x){return Math.min(Math.max(z,y),x);};var a=function(){};a.ATTRS={activeCell:{setter:"getCell"},selection:{setter:"_setSelection"},tabIndex:{value:0}};q.mix(a.prototype,{_capturing:false,_selectionEnd:null,_selectionSeed:null,_selectionStart:null,initializer:function(){var x=this,y=x.get(w);x[u]={cell:x.getClassName(h),selection:x.getClassName(s)};x._bindSelectionUI();y.addClass(x[u].selection);},destroy:function(){var x=this;x._selectionKeyHandler.detach();},captureSelection:function(B){var D=this,E=[],A=[],x=[],F=[],y;for(y=0;y<B.length;y++){var z=B[y],C=D.getCell(z);F.push(z[0]);E.push(C);A.push(D.getColumn(C));}F=q.Array.unique(F);A=q.Array.unique(A);for(y=0;y<F.length;y++){F[y]=D.getRow(F[y]);x[y]=D.getRecord(F[y]);}return{cells:E,cols:A,coords:B,records:x,rows:F};},getCoord:function(z){var y=this,x=y.getCell(z),A=y.body.get(r),B=A.get("firstChild.rowIndex");return[x.get("parentNode.rowIndex")-B,x.get(c)];},_bindSelectionUI:function(){var x=this,y=x[u];x._selectionKeyHandler=q.getDoc().on(b,q.bind(x._onSelectionKey,x),"down:37,38,39,40");x.delegate(g,q.bind(x._onSelectionMouseUp,x),v+y.cell);x.delegate(j,q.bind(x._onSelectionMouseDown,x),v+y.cell);x.delegate(t,q.bind(x._onSelectionMouseEnter,x),v+y.cell);},_onSelectionMouseDown:function(A){var x=this,y=A.currentTarget,z=x.get(w);z.unselectable();x._capturing=true;x._selectionSeed=y;x._selectionStart=x._selectionEnd=x.getCoord(y);x.set(i,y);},_onSelectionMouseEnter:function(z){var x=this,y=z.currentTarget;if(!x._capturing){return;}x._selectionSeed=y;x._selectionEnd=x.getCoord(y);x.set(s,{start:x._selectionStart,end:x._selectionEnd});},_onSelectionMouseUp:function(z){var x=this,y=x.get(w);if(x.get(n)){x._selectionEnd=x.getCoord(x._selectionSeed);x.set(s,{start:x._selectionStart,end:x._selectionEnd});}y.selectable();x._capturing=false;},_onSelectionKey:function(y){var F=this,E=F.body,D=E.get(r),G=y.keyCode,A=F.get(i),H,z=D.get(f).size(),x=E.columns.length,C,B;if(A&&F.get(n)){H=F.getCoord(A);C=H[0];B=H[1];if(G===37){B--;}else{if(G===38){C--;}else{if(G===39){B++;}else{if(G===40){C++;}}}}C=p(C,0,z-1);B=p(B,0,x-1);F.set(i,[C,B]);F.set(s,[C,B]);y.preventDefault();}},_parseRange:function(C){var A=C[0],z=C[1],B=[],y,x;for(y=Math.min(A[0],z[0]);y<=Math.max(A[0],z[0]);y++){for(x=Math.min(A[1],z[1]);x<=Math.max(A[1],z[1]);x++){B.push([y,x]);}}return B;},_setSelection:function(y){var x=this;if(m(y)){if(!m(y[0])){y=[y];}}else{if(l(y)){y=x._parseRange([y.start,y.end]);}else{if(q.instanceOf(y,q.Node)){y=[x.getCoord(y)];}}}return x.captureSelection(y);}});q.DataTable.Selection=a;q.Base.mix(q.DataTable,[a]);q.DataTable.prototype.getColumn=(function(x){return function(z){var y;if(q.instanceOf(z,q.Node)){y=this.getCell(z);z=y&&(y.get("className").match(new RegExp(this.getClassName("col","(\\w+)")))||[])[1];}return x.call(this,z);};}(q.DataTable.prototype.getColumn));},"@VERSION@",{skinnable:true,requires:["datatable-base"]});