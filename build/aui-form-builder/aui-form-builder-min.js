AUI.add("aui-form-builder-base",function(p){var k=p.Lang,n=k.isArray,o=k.isString,m=k.isObject,w=k.isValue,t=function(A){return(A instanceof p.Node);},s=function(A){return(A instanceof p.NodeList);},c=function(A){return(A instanceof p.FormBuilder);},q=function(A){return(A instanceof p.FormBuilderField);},e=p.DD.DDM,i="active",x="acceptChildren",r="autoSelectFields",z="availableFields",y="append",B="boundingBox",g="builder",d="button",j="buttons",l="buttonsNode",h="children",b="clonable-portal-layout",v="cloneNode",f=", ";COMPONENT="component",CONTENT="content",CONTENT_BOX="contentBox",CONTAINER="container",DELETE="delete",DD="dd",DEFAULT="default",DEFAULT_MESSAGE="defaultMessage",DEFAULT_MESSAGE_NODE="defaultMessageNode",DOT=".",DUPLICATE="duplicate",DRAG="drag",DRAGGING="dragging",DRAG_CONTAINER="dragContainer",DRAG_CONTAINER_NODE="dragContainerNode",DRAG_NODES_LIST="dragNodesList",DRAG_PORTAL_LAYOUT="dragPortalLayout",DROP="drop",DROP_CONTAINER="dropContainer",DROP_CONTAINER_NODE="dropContainerNode",DROP_PORTAL_LAYOUT="dropPortalLayout",DROP_NODE="dropNode",DROP_ZONE_NODE="dropZoneNode",EDIT="edit",EMPTY_SELECTION="emptySelection",EMPTY_STR="",ENABLE_EDITING="enableEditing",FIELD="field",FIELDS="fields",KEY="key",FIRST="first",FIRST_CHILD="firstChild",FIXED="fixed",FOCUSED="focused",FORM="form",FORM_BUILDER="formBuilder",FORM_LAYOUT="form-layout",ID="id",ICON="icon",INACTIVE="inactive",INDEX="index",INPUT="input",ITEMS="items",LABEL="label",LABEL_NODE="labelNode",LAST="last",LAST_CHILD="lastChild",LIST="list",MESSAGE="message",NAME="name",NESTED_LIST="nestedList",NODE="node",OVER="over",PARENT="parent",PARENT_NODE="parentNode",PLACEHOLDER="placeholder",PLACE_AFTER="placeAfter",PLACE_BEFORE="placeBefore",PREPEND="prepend",HELPER="helper",HIDDEN="hidden",READ_ONLY_ATTRIBUTES="readOnlyAttributes",RENDER="render",SAVE="save",SELECTED="selected",SETTINGS="settings",SETTINGS_FORM_NODE="settingsFormNode",SETTINGS_BUTTONS_NODE="settingsButtonsNode",SRC_NODE="srcNode",SPACE=" ",STATE="state",STRINGS="strings",TABS="tabs",TABS_NODE="tabsNode",TABS_CONTENT_NODE="tabsContentNode",TABS_LIST_NODE="tabsListNode",TABVIEW="tabview",TARGET="target",TEMPLATE_NODE="templateNode",TEXT="text",TYPE="type",UNIQUE="unique",VALUE="value",VALUES="values",ZONE="zone",REGION="region",WIDGET="widget",getCN=p.getClassName,CSS_BUTTON_INPUT=getCN(d,INPUT),CSS_COMPONENT=getCN(COMPONENT),CSS_DD_DRAGGING=getCN(DD,DRAGGING),CSS_HELPER_HIDDEN=getCN(HELPER,HIDDEN),CSS_FORM_BUILDER_BUTTON_DELETE=getCN(FORM,g,d,DELETE),CSS_FORM_BUILDER_BUTTON_DUPLICATE=getCN(FORM,g,d,DUPLICATE),CSS_FORM_BUILDER_BUTTON_EDIT=getCN(FORM,g,d,EDIT),CSS_FORM_BUILDER_BUTTON_SAVE=getCN(FORM,g,d,SAVE),CSS_FORM_BUILDER_DEFAULT_MESSAGE=getCN(FORM,g,DEFAULT,MESSAGE),CSS_FORM_BUILDER_DRAG_CONTAINER=getCN(FORM,g,DRAG,CONTAINER),CSS_FORM_BUILDER_DRAG_NODE=getCN(FORM,g,DRAG,NODE),CSS_FORM_BUILDER_DROP_ACTIVE=getCN(FORM,g,DROP,i),CSS_FORM_BUILDER_DROP_CONTAINER=getCN(FORM,g,DROP,CONTAINER),CSS_FORM_BUILDER_DROP_NODE=getCN(FORM,g,DROP,NODE),CSS_FORM_BUILDER_DROP_ZONE=getCN(FORM,g,DROP,ZONE),CSS_FORM_BUILDER_FIELD=getCN(FORM,g,FIELD),CSS_FORM_BUILDER_FIELD_BUTTONS=getCN(FORM,g,FIELD,j),CSS_FORM_BUILDER_FIELD_CONTENT=getCN(FORM,g,FIELD,CONTENT),CSS_FORM_BUILDER_FIELD_HIDDEN=getCN(FORM,g,FIELD,HIDDEN),CSS_FORM_BUILDER_FIELD_ICON=getCN(FORM,g,FIELD,ICON),CSS_FORM_BUILDER_FIELD_ICON_TEXT=getCN(FORM,g,FIELD,ICON,TEXT),CSS_FORM_BUILDER_FIELD_OVER=getCN(FORM,g,FIELD,OVER),CSS_FORM_BUILDER_FIELD_SELECTED=getCN(FORM,g,FIELD,SELECTED),CSS_FORM_BUILDER_HELPER=getCN(FORM,g,HELPER),CSS_FORM_BUILDER_ICON=getCN(FORM,g,ICON),CSS_FORM_BUILDER_INACTIVE=getCN(FORM,g,INACTIVE),CSS_FORM_BUILDER_LABEL=getCN(FORM,g,LABEL),CSS_FORM_BUILDER_PLACEHOLDER=getCN(FORM,g,PLACEHOLDER),CSS_FORM_BUILDER_SETTINGS=getCN(FORM,g,SETTINGS),CSS_FORM_BUILDER_SETTINGS_BUTTONS=getCN(FORM,g,SETTINGS,j),CSS_FORM_BUILDER_TABS_CONTAINER=getCN(FORM,g,TABS,CONTAINER),CSS_TABVIEW_CONTENT=getCN(TABVIEW,CONTENT),CSS_TABVIEW_LIST=getCN(TABVIEW,LIST),CSS_ICON=getCN(ICON),CSS_WIDGET=getCN(WIDGET),TPL_DEFAULT_MESSAGE='<li class="'+CSS_FORM_BUILDER_DEFAULT_MESSAGE+'"></li>',TPL_DRAG_CONTAINER='<ul class="'+CSS_FORM_BUILDER_DRAG_CONTAINER+'"></ul>',TPL_DRAG_NODE='<li class="'+[CSS_FORM_BUILDER_DRAG_NODE,CSS_FORM_BUILDER_FIELD].join(SPACE)+'" data-key="{key}">'+'<span class="'+[CSS_FORM_BUILDER_ICON,CSS_ICON].join(SPACE)+' {icon}"></span>'+'<span class="'+CSS_FORM_BUILDER_LABEL+'">{label}</span>'+"</li>",TPL_DROP_CONTAINER='<ul class="'+[CSS_FORM_BUILDER_DROP_CONTAINER].join(SPACE)+'"></ul>',TPL_FIELD_BOUNDING_BOX='<li class="'+[CSS_WIDGET,CSS_COMPONENT,CSS_FORM_BUILDER_FIELD,CSS_HELPER_HIDDEN].join(SPACE)+'"></li>',TPL_HELPER='<div class="'+CSS_FORM_BUILDER_HELPER+'"></div>',TPL_PLACEHOLDER='<li class="'+CSS_FORM_BUILDER_PLACEHOLDER+'"></li>',TPL_TABS='<div class="'+CSS_FORM_BUILDER_TABS_CONTAINER+'"></div>',TPL_TABS_CONTENT='<div class="'+CSS_TABVIEW_CONTENT+'"></div>',TPL_TABS_LIST='<ul class="'+CSS_TABVIEW_LIST+'"></ul>',TPL_SETTINGS='<form class="'+CSS_FORM_BUILDER_SETTINGS+'"></form>',TPL_SETTINGS_BUTTONS='<div class="aui-button-row">'+'<span class="aui-button aui-button-submit aui-state-positive aui-priority-primary">'+'<span class="aui-button-content">'+'<input type="button" value="Save" class="aui-button-input aui-form-builder-button-save">'+"</span>"+"</span>"+'<span class="aui-button aui-button-submit aui-state-positive aui-priority-secondary">'+'<span class="aui-button-content">'+'<input type="button" value="Close" class="aui-button-input aui-form-builder-button-close">'+"</span>"+"</span>"+"</div>",TAB_INDEX_DRAG=0,TAB_INDEX_SETTINGS=1,DEFAULT_ICON_CLASS=[CSS_FORM_BUILDER_FIELD_ICON,CSS_FORM_BUILDER_FIELD_ICON_TEXT].join(SPACE),INVALID_CLONE_ATTRS=[B,CONTENT_BOX,SRC_NODE,FIELDS,ID,SELECTED,TEMPLATE_NODE,LABEL_NODE,NAME],INVALID_DBCLICK_TARGETS="button,input,label,select,textarea";var a=function(){};a.ATTRS={fields:{value:[],setter:"_setFields",getter:function(A){return A||[];},validator:n}};p.mix(a.prototype,{addField:function(D){var C=this;
var A=C.get(FIELDS);A=C._removeFromParent(D);A.push(D);C.set(FIELDS,A);},addFields:function(C){var A=this;p.Array.each(A._normalizeFields(C),p.bind(A.addField,A));},contains:function(F,D){var C=this;var A=C.get(FIELDS);if(F===undefined){return false;}if(D){var E=C.get(B);return E.contains(F.get(B));}return(C.indexOf(F)>-1);},eachField:function(F,D){var C=this;var A=C.get(FIELDS);for(var E=0;E<A.length;E++){var G=A[E];if(D){G.eachField(F,D);}if(F.call(C,G,E,A)===false){return false;}}return true;},getField:function(D){var C=this;var A=C.get(FIELDS);return A[D];},getFixedFields:function(){var C=this;var A=[];C.eachField(function(D){if(D.get(FIXED)){A.push(D);}},true);return A;},indexOf:function(D){var C=this;var A=C.get(FIELDS);return p.Array.indexOf(A,D);},insertField:function(D,E){var C=this;var A=C.get(FIELDS);A=C._removeFromParent(E);A.splice(D,0,E);C.set(FIELDS,A);},removeField:function(D){var C=this;var A=C.get(FIELDS);if(q(D)&&(D.get(FIXED)||D.getFixedFields().length>0)){return false;}else{if(D.fixed===true){return false;}}A=C._removeFromParent(D);D.removeTarget(C);C.set(FIELDS,A);},removeFields:function(C){var A=this;p.Array.each(A._normalizeFields(C),p.bind(A.removeField,A));},_getFormBuilder:function(){return(this.get(FORM_BUILDER)||this);},_getRenderedField:function(C,E){var A=this;var D=A._getFormBuilder();if(!q(E)){E=D._renderField(A,C,E);}E.addTarget(D);E.set(PARENT,A);return E;},_normalizeFields:function(C){var A=this;var D=[];var F=A._getFormBuilder();var G=F.get(z);var E=F.uniqueFields;C=p.Array(C);p.Array.each(C,function(J,I){J=A._getRenderedField(I,J);var H=J.get(KEY);var K=J.get(UNIQUE);if(K&&!E.containsKey(H)){E.add(H,J);}if(K&&E.contains(J)){D.push(J);}else{if(K&&!E.contains(J)){J.destroy();}else{D.push(J);}}});return D;},_removeFromParent:function(E){var C=this;var A=C.get(FIELDS);if(q(E)){var D=E.get(PARENT);if(D&&D!=C){D._removeFromParent(E);}else{if(C.contains(E)){p.Array.removeItem(A,E);}}}return A;},_setFields:function(C){var A=this;return A._normalizeFields(C);}});p.FormBuilderFieldSupport=a;var u=p.Component.create({NAME:FORM_BUILDER,ATTRS:{autoSelectFields:{value:false},availableFields:{lazyAdd:false,value:[],validator:n,setter:function(A){p.each(A,function(D,C){D.key=D.key||C;});return A;}},enableEditing:{value:true},nestedList:{setter:function(D){var A=this;var C=p.merge({dd:{plugins:[{cfg:{horizontal:false,scrollDelay:30},fn:p.Plugin.DDWinScroll}]},dropCondition:function(F){var G=false;var E=F.drop.get(NODE);var H=E.getData(FIELD);if(H&&H.get(x)){G=true;}return G;},dropOn:DOT+CSS_FORM_BUILDER_DROP_ZONE,placeholder:p.Node.create(TPL_PLACEHOLDER),sortCondition:function(F){var E=A.get(DROP_CONTAINER_NODE);return E.contains(F.drop.get(NODE));}},D);return C;},value:{}},strings:{value:{button:"Button",defaultMessage:"Drop a field here",emptySelection:"No field selected",large:"Large",medium:"Medium",reset:"Reset",small:"Small",submit:"Submit",type:"Type"}},defaultMessageNode:{valueFn:function(){return p.Node.create(TPL_DEFAULT_MESSAGE);}},dragContainerNode:{valueFn:function(){return p.Node.create(TPL_DRAG_CONTAINER);}},dragNodesList:{setter:function(A){p.each(A,function(D,C){D.setData(INDEX,C);});},valueFn:"_valueDragNodesList"},dropContainerNode:{valueFn:function(){return p.Node.create(TPL_DROP_CONTAINER);}},settingsButtonsNode:{valueFn:function(){return p.Node.create(TPL_SETTINGS_BUTTONS);}},settingsFormNode:{valueFn:function(){return p.Node.create(TPL_SETTINGS);}},tabsNode:{valueFn:function(){return p.Node.create(TPL_TABS);}},tabsContentNode:{valueFn:function(){return p.Node.create(TPL_TABS_CONTENT);}},tabsListNode:{valueFn:function(){return p.Node.create(TPL_TABS_LIST);}}},AUGMENTS:[p.FormBuilderFieldSupport],HTML_PARSER:{defaultMessageNode:DOT+CSS_FORM_BUILDER_DEFAULT_MESSAGE,dragContainerNode:DOT+CSS_FORM_BUILDER_DRAG_CONTAINER,dragNodesList:function(C){var A=C.all(DOT+CSS_FORM_BUILDER_DRAG_NODE);return(A.size()<=0)?null:A;},dropContainerNode:DOT+CSS_FORM_BUILDER_DROP_CONTAINER,settingsFormNode:FORM+DOT+CSS_FORM_BUILDER_SETTINGS,settingsButtonsNode:DOT+CSS_FORM_BUILDER_SETTINGS_BUTTONS,tabsNode:DOT+CSS_FORM_BUILDER_TABS_CONTAINER,tabsContentNode:DOT+CSS_TABVIEW_CONTENT,tabsListNode:DOT+CSS_TABVIEW_LIST},EXTENDS:p.Widget,prototype:{initializer:function(){var A=this;A.boundingBox=A.get(B);A.dragContainerNode=A.get(DRAG_CONTAINER_NODE);A.dragNodesList=A.get(DRAG_NODES_LIST);A.dropContainerNode=A.get(DROP_CONTAINER_NODE);A.settingsButtonsNode=A.get(SETTINGS_BUTTONS_NODE);A.settingsFormNode=A.get(SETTINGS_FORM_NODE);A.tabsNode=A.get(TABS_NODE);A.tabsContentNode=A.get(TABS_CONTENT_NODE);A.tabsListNode=A.get(TABS_LIST_NODE);A._dragNestedList=new p.NestedList(A.get(NESTED_LIST));A._dropNestedList=new p.NestedList(A.get(NESTED_LIST));A._tabs=new p.TabView({boundingBox:A.tabsNode,contentNode:A.tabsContentNode,listNode:A.tabsListNode});if(!A.tabsContentNode.inDoc()){A._tabs.set(ITEMS,[{label:"Add a field",contentNode:A.dragContainerNode},{label:"Field settings",content:A.settingsFormNode}]);}},renderUI:function(){var A=this;A.dragNodesList.appendTo(A.dragContainerNode);A._tabs.render();},bindUI:function(){var A=this;var D=A.boundingBox;var C=A.dropContainerNode;var E=A.settingsButtonsNode;A._dragNestedList.on("drag:end",p.bind(A._onDragEndDragNestedList,A));A._dragNestedList.on("drag:start",p.bind(A._onDragStartDragNestedList,A));A._dropNestedList.on("drag:end",p.bind(A._onDragEndDropNestedList,A));A._tabs.after("activeTabChange",p.bind(A._afterActiveTabChange,A));A.uniqueFields.after("add",p.bind(A._afterUniqueFieldsAdd,A));A.uniqueFields.after("remove",p.bind(A._afterUniqueFieldsRemove,A));C.delegate("click",p.bind(A._onClickFieldDelete,A),DOT+CSS_FORM_BUILDER_BUTTON_DELETE);C.delegate("click",p.bind(A._onClickFieldDuplicate,A),DOT+CSS_FORM_BUILDER_BUTTON_DUPLICATE);C.delegate("click",p.bind(A._onClickFieldEdit,A),DOT+CSS_FORM_BUILDER_BUTTON_EDIT);C.delegate("dblclick",p.bind(A._onDbClickField,A),DOT+CSS_FORM_BUILDER_FIELD);C.delegate("mouseenter",p.bind(A._onMouseEnterField,A),DOT+CSS_FORM_BUILDER_FIELD);
C.delegate("mouseleave",p.bind(A._onMouseLeaveField,A),DOT+CSS_FORM_BUILDER_FIELD);E.delegate("click",p.bind(A._onClickSettingsButton,A),DOT+CSS_BUTTON_INPUT);A.after("*:fieldsChange",p.bind(A._afterFieldsChange,A));A.after("*:selectedChange",p.bind(A._afterSelectedChange,A));},syncUI:function(){var A=this;A.syncFieldsUI();A._syncDefaultMessage();A._syncUniqueFields();A._syncNestedList();},uniqueFields:new p.DataSet(),appendFields:function(C,D){var A=this;D.setContent(EMPTY_STR);p.each(C,function(F){var E=F.get(FIELDS);D.append(F.get(B));A.appendFields(E,F.get(DROP_ZONE_NODE));});},duplicateField:function(F){var A=this;var E=F.get(PARENT);var C=E.indexOf(F);var D=A._cloneField(F,true);E.insertField(++C,D);},selectField:function(D){var A=this;D.set(SELECTED,true);var C=A.settingsFormNode.one(INPUT);if(C){C.focus();C.select();}A._tabs.selectTab(TAB_INDEX_SETTINGS);},syncFieldsUI:function(E){var C=this;var A=C.get(FIELDS);var D=C.get(DROP_CONTAINER_NODE);if(E&&q(E.target)){var F=E.target;A=F.get(FIELDS);D=F.get(DROP_ZONE_NODE);}C.appendFields(A,D);},_afterActiveTabChange:function(G){var C=this;var F=C.selectedField;var D=C.get(SETTINGS_FORM_NODE);var E=C.get(SETTINGS_BUTTONS_NODE);var A=C.get(STRINGS);var H=C.contains(F,true);if(!H){D.setContent(A[EMPTY_SELECTION]);}E.toggleClass(CSS_HELPER_HIDDEN,!H);},_afterFieldsChange:function(){var A=this;A.syncUI();},_afterSelectedChange:function(D){var A=this;var E=D.target;var C=A.selectedField;A._syncSelectedFieldUI(E);if(E.get(SELECTED)){A.selectedField=E;if(C&&C!=E){C.set(SELECTED,false);}E.renderSettings();}},_afterUniqueFieldsAdd:function(D){var A=this;var C=D.attrName;var E=A._getDragNodeByKey(C);E.addClass(CSS_FORM_BUILDER_INACTIVE);E.unselectable();},_afterUniqueFieldsRemove:function(D){var A=this;var C=D.attrName;var E=A._getDragNodeByKey(C);E.removeClass(CSS_FORM_BUILDER_INACTIVE);E.selectable();},_cloneField:function(G,C){var A=this;var F=G.get(TYPE);var D={};p.each(G.getAttrs(),function(I,H){if(p.Array.indexOf(INVALID_CLONE_ATTRS,H)===-1&&!t(I)){D[H]=I;}});if(C){var E=[];p.each(G.get(FIELDS),function(H){E.push(A._cloneField(H,C));});D[FIELDS]=E;}D[TYPE]=F;return D;},_dropField:function(D){var J=this;var E=D.get(PARENT_NODE);var A=E.all("> "+DOT+CSS_FORM_BUILDER_FIELD);var H=D.getData(FIELD);var C=J.get(DEFAULT_MESSAGE_NODE);if(C.inDoc()){C.remove();}var I=J._getFieldParentByNode(D);var F=A.indexOf(D);if(!H){var G=J.get(z);H=G[D.getData(INDEX)];D.remove();}I.insertField(F,H);return I.getField(F);},_getDragNodeByKey:function(D){var A=this;var F=A.get(DRAG_NODES_LIST);var E=A.get(z);for(var C=0;C<E.length;C++){if(D==E[C].key){return F.item(C);}}return null;},_getFieldInstance:function(D,E){var A=this;var E=E||D.type;var C=p.FormBuilder.types;var F=o(E)?C[E]:E;if(F!==undefined){return new F(D);}else{p.log("The field type: ["+E+"] couldn't be found.");}return null;},_getFieldParentByNode:function(D){var C=this;var A=D.ancestor(DOT+CSS_FORM_BUILDER_FIELD);if(A){return A.getData(FIELD);}return C;},_getFieldParentNode:function(D){var A=this;var C=D.get(PARENT);if(q(C)){return C.get(B);}return A.get(DROP_CONTAINER_NODE);},_onClickFieldDelete:function(E){var C=this;var G=E.currentTarget;var A=G.ancestor(DOT+CSS_FORM_BUILDER_FIELD);var F=A.getData(FIELD);if(q(F)){var D=C.selectedField;if(F==D||F.contains(D,true)){C._tabs.selectTab(TAB_INDEX_DRAG);}F.set(SELECTED,false);F.get(PARENT).removeField(F);}},_onClickFieldDuplicate:function(D){var C=this;var F=D.currentTarget;var A=F.ancestor(DOT+CSS_FORM_BUILDER_FIELD);var E=A.getData(FIELD);if(E){C.duplicateField(E);}},_onClickFieldEdit:function(D){var C=this;var F=D.currentTarget;var A=F.ancestor(DOT+CSS_FORM_BUILDER_FIELD);var E=A.getData(FIELD);if(E){C.selectField(E);}},_onClickSettingsButton:function(D){var A=this;var E=D.currentTarget;if(E.hasClass(CSS_FORM_BUILDER_BUTTON_SAVE)){var C=A.selectedField;if(C){C.saveSettings();}}A._tabs.selectTab(TAB_INDEX_DRAG);},_onDbClickField:function(C){var A=this;var E=C.target;if(E.test(INVALID_DBCLICK_TARGETS)){C.stopPropagation();return false;}if(!E.getData(FIELD)){E=E.ancestor(DOT+CSS_FORM_BUILDER_FIELD);}if(E){var D=E.getData(FIELD);if(D){A.selectField(D);}}return false;},_onDragEndDragNestedList:function(F){var A=this;var E=F.target;var G=E.get(NODE);var D=A.dragContainerNode;var C=A.dropContainerNode;var I=C.one(DOT+CSS_FORM_BUILDER_DRAG_NODE);if(I){var H=A._dropField(I);if(A.get(r)){A.selectField(H);}}else{E.set(NODE,A.originalNode);}if(D.contains(G)&&D.contains(A.originalNode)){G.remove();}},_onDragEndDropNestedList:function(D){var A=this;var C=D.target;var E=C.get(NODE);if(E.hasClass(CSS_FORM_BUILDER_FIELD)){A._dropField(E);}},_onDragStartDragNestedList:function(F){var A=this;var E=F.target;var H=E.get(NODE);var D=H.getData(INDEX);var G=H.clone();H.placeBefore(G);G.setData(INDEX,D);E.set(NODE,G);G.attr(ID,EMPTY_STR);G.hide();H.removeClass(CSS_DD_DRAGGING);H.show();A.originalNode=H;var C=p.merge(A.get(NESTED_LIST),{nodes:G});(new p.NestedList(C));},_onMouseEnterField:function(D){var C=this;var A=D.currentTarget;var E=A.getData(FIELD);if(E){C._toggleFieldButtonsNode(E,true);}},_onMouseLeaveField:function(D){var C=this;var A=D.currentTarget;var E=A.getData(FIELD);var F=false;if(E){if(E.get(SELECTED)){F=true;}C._toggleFieldButtonsNode(E,F);}},_renderField:function(H,G,F){var C=this;var D=H.get(DROP_CONTAINER_NODE);if(q(H)){D=H.get(DROP_ZONE_NODE);}var E=p.Node.create(TPL_FIELD_BOUNDING_BOX);var A=H.get(FIELDS);if(A.length>0){D.insert(E,G);}else{D.append(E);}F=p.merge(F,{boundingBox:E,key:F.key,formBuilder:C,render:true,after:{render:function(){E.removeClass(CSS_HELPER_HIDDEN);}}});if(F.disabled===undefined){F.disabled=!C.get(ENABLE_EDITING);}return C._getFieldInstance(F);},_syncDefaultMessage:function(){var C=this;if(!C.dropContainerNode.hasChildNodes()){var A=C.get(STRINGS);var D=C.get(DEFAULT_MESSAGE_NODE);D.setContent(A[DEFAULT_MESSAGE]);C.dropContainerNode.append(D);}},_syncNestedList:function(){var A=this;var D=A.get(z);var C=A.uniqueFields;A._syncNodes();
A.dragNodes.each(function(F,E){var G=D[E];if(!C.containsKey(G.key)){A._dragNestedList.add(F);}});A._dropNestedList.addAll(A.dropNodes);},_syncNodes:function(){var A=this;var D=A.dragContainerNode;var C=A.dropContainerNode;A.dragNodes=D.all(DOT+CSS_FORM_BUILDER_FIELD);A.dropNodes=C.all([DOT+CSS_FORM_BUILDER_FIELD,DOT+CSS_FORM_BUILDER_DEFAULT_MESSAGE].join(f));},_syncSelectedFieldUI:function(F){var C=this;var E=F.get(SELECTED);var A=F.get(B);var D=C.selectedField;A.toggleClass(CSS_FORM_BUILDER_FIELD_SELECTED,E);if(!E&&F.contains(D)){E=true;}C._toggleFieldButtonsNode(F,E);},_syncUniqueFields:function(){var C=this;var E=C.get(z);var A=C.get(FIELDS);var D=C.uniqueFields;D.each(function(G,F){if(!C.contains(G,true)){D.remove(G);}});p.each(E,function(H,F){if(H.unique){var G=H.key;C.eachField(function(J){if(J.get(KEY)==G){var I=p.merge(C._cloneField(J,false),H);J.set(FIXED,I.fixed);J.set(READ_ONLY_ATTRIBUTES,I.readOnlyAttributes);J.set(UNIQUE,true);E[F]=I;D.add(G,J);}},true);}});},_toggleFieldButtonsNode:function(C,D){var A=this;var E=C.get(l);if(E){E.toggleClass(CSS_HELPER_HIDDEN,!D);}},_valueDragNodesList:function(){var A=this;var D=A.get(z);var C=[];p.each(D,function(F,E,G){C.push(p.substitute(TPL_DRAG_NODE,{icon:F.iconClass||DEFAULT_ICON_CLASS,label:F.entryLabel||F.label,key:F.key||E,type:F.type,unique:F.unique}));});return p.NodeList.create(C.join(EMPTY_STR));}}});p.FormBuilder=u;p.FormBuilder.types={};},"@VERSION@",{requires:["aui-base","aui-button-item","aui-data-set","aui-nested-list","aui-tabs","substitute"],skinnable:true});AUI.add("aui-form-builder-field",function(b6){var bX=b6.Lang,aX=bX.isArray,bT=bX.isString,I=b6.IO.prototype._serialize,h="acceptChildren",e="bodyContent",aR="boundingBox",cf="builder",cm="button",J="buttons",x="buttonsNode",aH="checkbox",K="checked",o="children",ci="clearfix",aS="close",aT="component",cr="contentBox",aL="container",cy="dataType",cj="default",aY="delete",bI="disabled",bP=".",be="drag",aD="dragContainer",v="dragContainerNode",b1="dragNodesList",aA="drop",bi="dropContainer",bp="dropContainerNode",b7="dropNode",br="dropZone",a3="dropZoneNode",aF="duplicate",R="edit",bJ="",bq="field",g="fields",a9="fixed",bO="for",q="form",bf="formBuilder",aG="form-builder-field",s="help",n="helper",av="hidden",r="icon",ch="id",aj="label",b2="labelNode",bD="lightbulb",bh="metadata",aC="name",cz="node",b="panel",bb="portalLayout",aO="predefinedValue",bt="proxy",ce="readOnlyAttributes",ap="required",a8="requiredFlagNode",bH="state",bo="select",a0="settings",at="settingsFormNode",X="showLabel",aw="size",Y=" ",bS="string",bZ="strings",ad="templateNode",bL="text",ar="textarea",u="tip",bw="tipIconNode",Z="type",aE="unique",bU="zone",bk="widget",z=b6.getClassName,bn=z(aT),aK=z(bq,aj),p=z(n,ci),af=z(n,av),bQ=z(bH,cj),d=z(bq),bu=z(bq,bL),B=z(q,cf,cm),bM=z(q,cf,cm,aY),a5=z(q,cf,cm,aF),V=z(q,cf,cm,R),a4=z(q,cf,aA,cz),an=z(q,cf,aA,bU),cx=z(q,cf,r),j=z(q,cf,r,aY),w=z(q,cf,r,aF),al=z(q,cf,r,R),E=z(q,cf,r,u),bN=z(q,cf,bq),bA=z(q,cf,bq,J),bs=z(q,cf,a9),cw=z(q,cf,ap),bG=z(q,cf,aE),G=z(bk),b4='<li class="'+[G,bn,bN].join(Y)+'"></li>',a='<div class="'+[bA,af].join(Y)+'">'+'<a class="'+[B,V].join(Y)+'" href="javascript:;" title="Edit">'+'<div class="'+[cx,al].join(Y)+'"></div>'+"</a>"+'<a class="'+[B,a5].join(Y)+'" href="javascript:;" title="Duplicate">'+'<div class="'+[cx,w].join(Y)+'"></div>'+"</a>"+'<a class="'+[B,bM].join(Y)+'" href="javascript:;" title="Delete">'+'<div class="'+[cx,j].join(Y)+'"></div>'+"</a>"+"</div>",C='<div class="'+p+'"></div>',ac='<ul class="'+an+'"></ul>',ak='<span class="'+[d,bu].join(Y)+'"></span>',a7='<label class="'+aK+'"></label>',az='<span class="'+cw+'">*</span>',cv="<p></p>",bl='<a href="javascript:;" class="'+E+'"></a>';var t=b6.Component.create({NAME:aG,ATTRS:{acceptChildren:{value:true},dataType:{value:bS},disabled:{value:false},fixed:{value:false},formBuilder:{value:undefined},id:{value:bJ},icon:{value:bJ},key:{value:bJ},label:{value:bJ},localizationMap:{value:{}},name:{valueFn:function(){var A=this;return A.get(Z)+(++b6.Env._uidx);}},parent:{value:null},predefinedValue:{value:bJ},readOnlyAttributes:{value:[],validator:aX},required:{setter:b6.DataType.Boolean.parse,value:false},selected:{setter:b6.DataType.Boolean.parse,value:false},showLabel:{setter:b6.DataType.Boolean.parse,value:true},template:{value:bJ},tip:{value:bJ},type:{value:bJ},unique:{setter:b6.DataType.Boolean.parse,value:false},buttonsNode:{valueFn:function(){return b6.Node.create(a);}},dropZoneNode:{valueFn:function(){return b6.Node.create(ac);}},labelNode:{valueFn:function(){return b6.Node.create(a7);}},requiredFlagNode:{valueFn:function(){return b6.Node.create(az);}},templateNode:{valueFn:"getNode"},tipIconNode:{valueFn:function(){return b6.Node.create(bl);}}},AUGMENTS:[b6.FormBuilderFieldSupport],UI_ATTRS:[h,bI,a9,aj,aC,aO,ap,X,u,aE],HTML_PARSER:{buttonsNode:bP+bA,dropZoneNode:bP+an,labelNode:aj+bP+aK,requiredFlagNode:bP+cw,tipIconNode:bP+E},prototype:{BOUNDING_TEMPLATE:b4,initializer:function(){var A=this;A.get(aR).setData(bq,A);A.toolTip=new b6.Tooltip({trigger:A.get(bw),hideDelay:100});},bindUI:function(){var A=this;},renderUI:function(){var A=this;var cD=A.get(aR);var cG=A.get(x);var L=A.get(cr);var cC=A.get(b2);var cF=A.get(a8);var cE=A.get(ad);var cB=A.get(bw);L.addClass(p);cD.prepend(cG);L.append(cC);L.append(cF);L.append(cB);L.append(cE);A.toolTip.render();},settingsNodesMap:{},saveSettings:function(){var A=this;var L=A.get(bf);var cB=L.get(at);b6.Array.each(I(cB._node).split("&"),function(cD){var cC=cD.split("=");A.set(cC[0],decodeURIComponent(cC[1]));});},renderSettings:function(){var cJ=this;var cF=cJ.get(bf);var A=cF.get(at);var cK=cF.get(bZ);var cC=cJ.settingsNodesMap;if(!cJ.fieldSettingsNode){cJ.fieldSettingsNode=b6.Node.create(C);var cH=b6.Node.create(C);var cD=b6.Node.create(ak);var L=b6.Node.create(a7);var cI=b6.Node.create(cv);L.setContent(cK[Z]);cI.setContent(cJ.get(cy)||cJ.get(Z));cD.append(L);cD.append(cI);cD.appendTo(cH);cJ._renderSettingsFields([{type:"text",name:aj,labelText:"Label",value:cJ.get(aj)},{type:"checkbox",name:X,labelText:"Show label",labelAlign:"left",value:cJ.get(X)},{type:"text",name:aC,labelText:"Name",value:cJ.get(aC)},{type:"checkbox",name:ap,labelText:"Required",labelAlign:"left",value:ap},{type:"text",name:aO,labelText:"Default value",value:cJ.get(aO)},{type:"textarea",name:u,labelText:"Tip",value:cJ.get(u)}],cH);
var cE=cC.labelSettingNode;cE.on({input:b6.bind(cJ._onLabelInput,cJ)});var cG=cC.showLabelSettingNode;cG.set(K,cJ.get(X));cG.on({change:b6.bind(cJ._onSettingsFieldChange,cJ)});var cB=cC.requiredSettingNode;cB.set(K,cJ.get(ap));cB.on({change:b6.bind(cJ._onSettingsFieldChange,cJ)});cJ.propertiesPanel=new b6.Panel({bodyContent:cH,collapsible:true,title:"Properties"}).render();cJ.fieldSettingsNode.append(cJ.propertiesPanel.get(aR));}A.setContent(cJ.fieldSettingsNode);},getHTML:function(){},getNode:function(){},_onLabelInput:function(L){var A=this;var cC=L.target;var cB=cC.val();A.set(aj,cB);},_onSettingsFieldChange:function(L){var A=this;var cC=L.target;var cB=cC.val();if(cC.get(Z)===aH){cB=cC.get(K);}A.set(cC.get(aC),cB);},_renderSettingsFields:function(L,cC){var A=this;var cB=A.get(ce);b6.each(L,function(cE){var cF;if(b6.Array.indexOf(cB,cE.name)>-1){cE.disabled=true;}if(cE.type===bo){cF=new b6.Select(cE);}else{if(cE.type===ar){cF=new b6.Textarea(cE);}else{cF=new b6.Field(cE);}}cF.render(cC);var cD=cF.get(cz);if(cE.type===aH){cD.set(K,cE.value);}A.settingsNodesMap[cE.name+"SettingNode"]=cD;});},_uiSetAcceptChildren:function(cD){var A=this;var L=A.get(aR);var cC=A.get(a3);var cB=L.one(bP+an);if(cD&&!cB){L.append(cC);}else{if(!cD&&cB){cB.remove();}else{if(cD&&cB){A.set(a3,cB);}}}},_uiSetDisabled:function(cB){var A=this;var L=A.get(ad);if(cB){L.setAttribute(bI,cB);}else{L.removeAttribute(bI);}},_uiSetFixed:function(cB){var A=this;var cC=A.get(x);var L=cC.one(bP+bM);L.toggleClass(af,cB);},_uiSetLabel:function(cB){var A=this;var L=A.get(b2);L.setContent(cB);},_uiSetName:function(cB){var A=this;var L=A.get(ad);L.set(aC,cB);},_uiSetPredefinedValue:function(cB){var A=this;var L=A.get(ad);L.val(cB);},_uiSetRequired:function(cB){var A=this;var L=A.get(a8);L.toggleClass(af,!cB);},_uiSetShowLabel:function(cB){var A=this;var L=A.get(b2);L.toggleClass(af,!cB);},_uiSetTip:function(cB){var A=this;var L=A.get(bw);L.toggleClass(af,!cB);A.toolTip.set(e,cB);},_uiSetUnique:function(cB){var A=this;var L=A.get(aR);var cC=A.get(x);L.toggleClass(bG,cB);cC.one(bP+a5).toggleClass(af,cB);}}});b6.FormBuilderField=t;b6.FormBuilder.types["field"]=b6.FormBuilderField;var bX=b6.Lang,aX=bX.isArray,aB=bX.isNumber,bT=bX.isString,bx=function(A){return(A instanceof b6.Node);},a6=function(A){return(A instanceof b6.NodeList);},ba=b6.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),aR="boundingBox",cm="button",ck="buttonType",cr="contentBox",aL="container",bP=".",be="drag",aD="dragContainer",v="dragContainerNode",b1="dragNodesList",aA="drop",bi="dropContainer",bp="dropContainerNode",bJ="",bq="field",g="fields",aG="form-builder-field",bV="form-builder-button-field",ch="id",r="icon",a1="input",aj="label",aC="name",cz="node",T="option",ae="options",bb="portalLayout",aO="predefinedValue",bt="proxy",bR="reset",bg="selected",bY="selectedIndex",ay="submit",Y=" ",bZ="strings",aI="template",ad="templateNode",bL="text",Z="type",m="value",z=b6.getClassName,bv=z(bq,a1),P=z(bq,a1,bL),bN=z(aG),b9=z(aG,cz),bQ=z(bH,cj),bK='<input id="{id}" class="'+[b9,bv].join(Y)+'" name="{name}" type="{type}" value="{value}" />',cA=[ay,bR,cm];var b8=b6.Component.create({NAME:bV,ATTRS:{acceptChildren:{value:false,readOnly:true},buttonType:{value:ay,validator:function(A){return b6.Array(cA).indexOf(A.toLowerCase())>-1;}},predefinedValue:{value:ba(ay)},showLabel:{value:false},template:{valueFn:function(){return bK;}}},UI_ATTRS:b6.FormBuilderField.UI_ATTRS.concat([ck]),CSS_PREFIX:bN,HTML_PARSER:{templateNode:bP+b9},EXTENDS:b6.FormBuilderField,prototype:{getHTML:function(){var A=this;var cD=A.get(aI);var cF=A.get(ch);var cC=A.get(aj);var cB=A.get(aC);var L=A.get(ck);var cE=A.get(aO);return b6.substitute(cD,{id:cF,label:cC,name:cB,type:L,value:cE});},getNode:function(){var A=this;return b6.Node.create(A.getHTML());},renderSettings:function(){var cH=this;var cE=cH.get(bf);var A=cE.get(at);var cD=cH.get(ck);var cI=cE.get(bZ);var cC=cH.settingsNodesMap;b6.FormBuilderButtonField.superclass.renderSettings.apply(cH,arguments);if(!cH._renderedButtonSettings){cH._renderedButtonSettings=true;var L=cH.propertiesPanel.get(e);var cG=[];b6.each(cA,function(cJ){cG.push({labelText:cI[cJ],value:cJ});});cH._renderSettingsFields([{labelText:"Button type",name:ck,options:cG,type:"select"}],L.item(0));var cF=cC["buttonTypeSettingNode"];cF.on({change:b6.bind(cH._onButtonTypeChange,cH)});var cB=b6.Array(cA).indexOf(cD);cF.all(T).item(cB).set(bg,true);}},_onButtonTypeChange:function(L){var A=this;var cB=L.target;A.set(ck,cB.get(m));},_uiSetButtonType:function(cB){var A=this;var L=A.get(ad);L.setAttribute(Z,cB);}}});b6.FormBuilderButtonField=b8;b6.FormBuilder.types["button"]=b6.FormBuilderButtonField;var bX=b6.Lang,aX=bX.isArray,aZ=bX.isBoolean,aB=bX.isNumber,bT=bX.isString,aV="boolean",aR="boundingBox",e="bodyContent",aH="checkbox",K="checked",ax="choice",cr="contentBox",aL="container",bP=".",be="drag",aD="dragContainer",v="dragContainerNode",b1="dragNodesList",aA="drop",bi="dropContainer",bp="dropContainerNode",bJ="",bq="field",g="fields",aG="form-builder-field",co="form-builder-checkbox-field",ch="id",r="icon",bj="inline",aj="label",c="labels",aC="name",cz="node",S="parentNode",bb="portalLayout",aO="predefinedValue",bt="proxy",aw="size",Y=" ",aI="template",ad="templateNode",m="value",z=b6.getClassName,d=z(bq),ao=z(bq,aH),b3=z(bq,ax),bN=z(aG),cp=z(aG,aH),b9=z(aG,cz),bQ=z(bH,cj),b0=z(bq,c,bj),b4='<li class="'+[G,bn,bN,cp].join(Y)+'"></li>',aU='<input id="{id}" class="'+[b9,d,ao,b3].join(Y)+'" name="{name}" type="checkbox" value="{value}" {checked} />';var ab=b6.Component.create({NAME:co,ATTRS:{dataType:{value:aV},predefinedValue:{setter:b6.DataType.Boolean.parse,value:false},template:{valueFn:function(){return aU;}},templateNode:{valueFn:"getNode"}},CSS_PREFIX:bN,HTML_PARSER:{templateNode:bP+b9},EXTENDS:b6.FormBuilderField,prototype:{BOUNDING_TEMPLATE:b4,bindUI:function(){var A=this;b6.FormBuilderCheckBoxField.superclass.bindUI.apply(A,arguments);var L=A.get(ad);L.on({"change":b6.bind(A._onValueChange,A)});
},renderUI:function(){var A=this;var L=A.get(cr);var cC=A.get(ad);var cB=A.get(b2);b6.FormBuilderCheckBoxField.superclass.renderUI.apply(A,arguments);cB.insert(cC,cB,"before");},getHTML:function(){var A=this;var cC=A.get(aI);var cD=A.get(K);var cF=A.get(ch);var cB=A.get(aj);var L=A.get(aC);var cE=A.get(aO);return b6.substitute(cC,{checked:cD?'checked="checked"':bJ,id:cF,label:cB,name:L,value:cE});},getNode:function(){var A=this;return b6.Node.create(A.getHTML());},renderSettings:function(){var A=this;var L=A.get(bf);var cC=L.get(at);var cD=A.settingsNodesMap;b6.FormBuilderCheckBoxField.superclass.renderSettings.apply(A,arguments);if(!A._renderedCheckboxSettings){A._renderedCheckboxSettings=true;cD.predefinedValueSettingNode.get(S).remove();var cB=A.propertiesPanel.get(e);A._renderSettingsFields([{type:"checkbox",name:aO,labelText:"Checked",labelAlign:"left"}],cB.item(0));var cE=cD.predefinedValueSettingNode;cE.on({change:b6.bind(A._onValueChange,A)});cE.set(K,A.get(aO));}},_onValueChange:function(L){var A=this;var cB=L.target;A.set(aO,cB.get(K));},_uiSetPredefinedValue:function(cD){var A=this;var L=A.get(ad);var cB=A.settingsNodesMap;var cC=cB.predefinedValueSettingNode;if(cC){cC.set(K,cD);}L.set(K,cD);}}});b6.FormBuilderCheckBoxField=ab;b6.FormBuilder.types["checkbox"]=b6.FormBuilderCheckBoxField;var bX=b6.Lang,aX=bX.isArray,aB=bX.isNumber,bT=bX.isString,bx=function(A){return(A instanceof b6.Node);},a6=function(A){return(A instanceof b6.NodeList);},aR="boundingBox",cr="contentBox",aL="container",cy="dataType",bP=".",aA="drop",bJ="",bq="field",g="fields",aG="form-builder-field",F="form-builder-fieldset-field",ch="id",r="icon",aj="label",aC="name",cz="node",aO="predefinedValue",Y=" ",bZ="strings",aI="template",ad="templateNode",bL="text",Z="type",m="value",bU="zone",z=b6.getClassName,bN=z(aG),b9=z(aG,cz),an=z(q,cf,aA,bU),aN='<fieldset id="{id}" class="'+[b9].join(Y)+'"></fieldset>',k='<legend class="'+aK+'"></legend>';var y=b6.Component.create({NAME:F,ATTRS:{acceptChildren:{value:true,readOnly:true},dataType:{value:undefined},template:{valueFn:function(){return aN;}},labelNode:{valueFn:function(){return b6.Node.create(k);}},templateNode:{valueFn:"getNode"}},UI_ATTRS:[h,aj,X],CSS_PREFIX:bN,HTML_PARSER:{templateNode:bP+b9},EXTENDS:b6.FormBuilderField,prototype:{CONTENT_TEMPLATE:aN,renderUI:function(){var A=this;var cC=A.get(aR);var cE=A.get(x);var L=A.get(cr);var cB=A.get(b2);var cD=A.get(ad);if(!cC.contains(cE)){cC.prepend(cE);}if(!L.contains(cB)){L.append(cB);}},getHTML:function(){var A=this;var L=A.get(aI);var cB=A.get(ch);return b6.substitute(L,{id:cB});},getNode:function(){var A=this;return b6.Node.create(A.getHTML());},renderSettings:function(){var cI=this;var cE=cI.get(bf);var A=cE.get(at);var cJ=cE.get(bZ);var cB=cI.settingsNodesMap;if(!cI._renderedFieldsetSettings){cI._renderedFieldsetSettings=true;cI.fieldSettingsNode=b6.Node.create(C);var cG=b6.Node.create(C);var cC=b6.Node.create(ak);var L=b6.Node.create(a7);var cH=b6.Node.create(cv);L.setContent(cJ[Z]);cH.setContent(cI.get(cy)||cI.get(Z));cC.append(L);cC.append(cH);cC.appendTo(cG);cI._renderSettingsFields([{type:"text",name:aj,labelText:"Label",value:cI.get(aj)},{type:"checkbox",name:X,labelText:"Show label",labelAlign:"left",value:cI.get(X)}],cG);var cD=cB["labelSettingNode"];cD.on({input:b6.bind(cI._onLabelInput,cI)});var cF=cB["showLabelSettingNode"];cF.set(K,cI.get(X));cF.on({change:b6.bind(cI._onSettingsFieldChange,cI)});cI.propertiesPanel=new b6.Panel({bodyContent:cG,collapsible:true,title:"Properties"}).render();cI.fieldSettingsNode.append(cI.propertiesPanel.get(aR));}A.setContent(cI.fieldSettingsNode);},_uiSetAcceptChildren:function(cD){var A=this;var L=A.get(cr);var cC=A.get(a3);var cB=L.one(bP+an);if(cD&&!cB){L.append(cC);}else{if(!cD&&cB){cB.remove();}else{if(cD&&cB){A.set(a3,cB);}}}}}});b6.FormBuilderFieldsetField=y;b6.FormBuilder.types["fieldset"]=b6.FormBuilderFieldsetField;var bX=b6.Lang,aX=bX.isArray,aB=bX.isNumber,bT=bX.isString,bx=function(A){return(A instanceof b6.Node);},a6=function(A){return(A instanceof b6.NodeList);},aR="boundingBox",cr="contentBox",aL="container",cy="dataType",bP=".",bJ="",bq="field",g="fields",aG="form-builder-field",cq="form-builder-file-upload-field",ch="id",r="icon",aj="label",aC="name",cz="node",aO="predefinedValue",Y=" ",bZ="strings",aI="template",ad="templateNode",bL="text",Z="type",m="value",z=b6.getClassName,bN=z(aG),b9=z(aG,cz),bQ=z(bH,cj),bC='<input id="{id}" class="'+[b9].join(Y)+'" name="{name}" type="file" value="{value}" />';var M=b6.Component.create({NAME:cq,ATTRS:{template:{valueFn:function(){return bC;}},templateNode:{valueFn:"getNode"}},CSS_PREFIX:bN,HTML_PARSER:{templateNode:bP+b9},EXTENDS:b6.FormBuilderField,prototype:{getHTML:function(){var A=this;var cD=A.get(aI);var cF=A.get(ch);var cB=A.get(aj);var L=A.get(aC);var cC=A.get(aw);var cE=A.get(aO);return b6.substitute(cD,{id:cF,label:cB,name:L,value:cE});},getNode:function(){var A=this;return b6.Node.create(A.getHTML());},renderSettings:function(){var cJ=this;var cF=cJ.get(bf);var A=cF.get(at);var cK=cF.get(bZ);var cC=cJ.settingsNodesMap;if(!cJ._renderedFileUploadSettings){cJ._renderedFileUploadSettings=true;cJ.fieldSettingsNode=b6.Node.create(C);var cH=b6.Node.create(C);var cD=b6.Node.create(ak);var L=b6.Node.create(a7);var cI=b6.Node.create(cv);L.setContent(cK[Z]);cI.setContent(cJ.get(cy)||cJ.get(Z));cD.append(L);cD.append(cI);cD.appendTo(cH);cJ._renderSettingsFields([{type:"text",name:aj,labelText:"Label",value:cJ.get(aj)},{type:"checkbox",name:X,labelText:"Show label",labelAlign:"left",value:cJ.get(X)},{type:"text",name:aC,labelText:"Name",value:cJ.get(aC)},{type:"checkbox",name:ap,labelText:"Required",labelAlign:"left",value:cJ.get(ap)},{type:"textarea",name:u,labelText:"Tip",value:cJ.get(u)}],cH);var cE=cC.labelSettingNode;cE.on({input:b6.bind(cJ._onLabelInput,cJ)});var cG=cC.showLabelSettingNode;cG.set(K,cJ.get(X));cG.on({change:b6.bind(cJ._onSettingsFieldChange,cJ)});var cB=cC.requiredSettingNode;cB.set(K,cJ.get(ap));
cB.on({change:b6.bind(cJ._onSettingsFieldChange,cJ)});cJ.propertiesPanel=new b6.Panel({bodyContent:cH,collapsible:true,title:"Properties"}).render();cJ.fieldSettingsNode.append(cJ.propertiesPanel.get(aR));}A.setContent(cJ.fieldSettingsNode);}}});b6.FormBuilderFileUploadField=M;b6.FormBuilder.types["fileupload"]=b6.FormBuilderFileUploadField;var cg=b6.Lang,cs=b6.Array,aX=cg.isArray,aB=cg.isNumber,bT=cg.isString,bF=cg.sub,bx=function(A){return(A instanceof b6.Node);},a6=function(A){return(A instanceof b6.NodeList);},ba=b6.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),U="add",bW="addNode",aR="boundingBox",cm="button",ck="buttonType",cr="contentBox",aL="container",cj="default",au="defaultLabel",ct="defaultOptions",D="defaultValue",bP=".",be="drag",aD="dragContainer",v="dragContainerNode",b1="dragNodesList",aA="drop",bi="dropContainer",bp="dropContainerNode",bq="field",g="fields",aG="form-builder-field",N="form-builder-multiple-choice-field",r="icon",ch="id",a1="input",ai="item",aj="label",cl="multiple",aC="name",cz="node",T="option",bB="optionTemplate",ae="options",aO="predefinedValue",bt="proxy",cu="remove",bR="reset",ay="submit",Y=" ",aI="template",ad="templateNode",bL="text",Z="type",m="value",z=b6.getClassName,bv=z(bq,a1),P=z(bq,a1,bL),l=z(bq,ae,U),cc=z(bq,ae,ai),cb=z(bq,ae,ai,a1),aP=z(bq,ae,ai,a1,aj),ag=z(bq,ae,ai,a1,m),bc=z(bq,ae,ai,cu),bN=z(aG),b9=z(aG,cz),bQ=z(bH,cj),Q="",aq='<div class="'+[cc,b0,p].join(Y)+'">'+'<input type="text" class="'+[cb,aP,bv,P].join(Y)+'" value="{label}" />'+'<input type="text" class="'+[cb,ag,bv,P].join(Y)+'" value="{value}" />'+'<a href="javascript:;" class="'+bc+'">&nbsp;</a>'+"</div>";TPL_ADD='<a class="'+l+'" href="javascript:;">Add an option</a>',ENTER="ENTER";var bm=b6.Component.create({NAME:ae,ATTRS:{allowClear:{value:false},defaultLabel:{value:Q},defaultValue:{value:Q},disabled:{validator:aZ,value:false},options:{getter:"_getOptions",validator:aX,value:[]},addNode:{valueFn:function(){return b6.Node.create(TPL_ADD);}}},HTML_PARSER:{addNode:bP+l},UI_ATTRS:[ae,bI],EXTENDS:b6.Widget,prototype:{renderUI:function(){var A=this;var L=A.get(aR);var cB=A.get(bW);if(!cB.inDoc()){L.append(cB);}},bindUI:function(){var A=this;var L=A.get(aR);var cB=A.get(bW);cB.on("click",b6.bind(A._onClickAdd,A));L.delegate("click",b6.bind(A._onClickOptionRemove,A),bP+bc);L.delegate("keypress",b6.bind(A._onKeyPressOption,A),bP+cb);},add:function(cB){var A=this;var L=A.get(ae);L.push(cB);A.set(ae,L);},clear:function(){var A=this;if(A.get(ALLOW_CLEAR)){A.set(ae,[]);}},remove:function(cB){var A=this;var L=A.get(cr);var cC=A._getOptionNode(cB);if(!A.get(bI)){if(cC){cC.remove();}A.items=L.all(bP+cc);}},_addNewOption:function(){var L=this;var cD=null;if(!L.get(bI)){var cB=L.get(cr);var cC=bF(aq,{label:L.get(au),value:L.get(D)});cD=b6.Node.create(cC);cB.append(cD);var A=cD.one(a1);A.focus();A.select();L.items=cB.all(bP+cc);}return cD;},_getOptionNode:function(L){var A=this;return A.items.item(L);},_getOptions:function(cB){var A=this;var L=[];if(A.items){b6.each(A.items,function(cE,cC,cH){var cG=cE.one(bP+aP);var cF=cE.one(bP+ag);var cD=cB[cC]||{};cD.label=cG.val();cD.value=cF.val();L.push(cD);});}else{L=cB;}return L;},_indexOfTarget:function(cB){var A=this;var L=cB.ancestor(bP+cc);return A.items.indexOf(L);},_onClickAdd:function(L){var A=this;A._addNewOption();},_onClickOptionRemove:function(cC){var A=this;var cB=A.get(ae);var L=A._indexOfTarget(cC.target);A.remove(L);},_onKeyPressOption:function(cD){var A=this;var cC=A.get(ae);var cE=cD.currentTarget;var L=A.items;if(cD.isKey(ENTER)){var cB=A._indexOfTarget(cE);var cF=cE.hasClass(ag);if((cB==L.size()-1)&&cF){A._addNewOption();}}},_uiSetDisabled:function(cC){var A=this;var cB=A.get(bW);var L=A.get(aR);cB.toggleClass(af,cC);L.all(bP+bc).toggleClass(af,cC);if(cC){L.all(a1).setAttribute(bI,cC);}else{L.all(a1).removeAttribute(bI);}},_uiSetOptions:function(cC){var A=this;var cB=A.get(cr);var L=[];cs.each(cC,function(cE,cD,cF){L.push(bF(aq,cE));});cB.setContent(L.join(Q));A.items=cB.all(bP+cc);}}});var f=b6.Component.create({NAME:N,ATTRS:{acceptChildren:{value:false,readOnly:true},options:{value:[{label:"option 1",value:"value 1"},{label:"option 2",value:"value 2"},{label:"option 3",value:"value 3"}]},optionTemplate:{value:'<option value="{value}">{label}</option>'}},UI_ATTRS:[h,aO,aj,aC,ae,X],CSS_PREFIX:bN,HTML_PARSER:{templateNode:bP+b9},EXTENDS:b6.FormBuilderField,prototype:{getNode:function(){var A=this;return b6.FormBuilderMultipleChoiceField.superclass.getNode.apply(A,arguments);},renderSettings:function(){var A=this;var L=A.get(ce);b6.FormBuilderMultipleChoiceField.superclass.renderSettings.apply(A,arguments);if(!A._renderedMultipleChoiceSettings){A._renderedMultipleChoiceSettings=true;var cC=b6.Node.create(C);A.optionsPanel=new b6.Panel({bodyContent:cC,collapsible:true,title:"Options"}).render();var cB=b6.Array.indexOf(L,ae)>-1;A.options=new bm({disabled:cB,options:A.get(ae)}).render(cC);A.fieldSettingsNode.append(A.optionsPanel.get(aR));}},saveSettings:function(){var A=this;b6.FormBuilderMultipleChoiceField.superclass.saveSettings.apply(A,arguments);A.set(ae,A.options.get(ae));},_uiSetOptions:function(cD){var A=this;var cC=A.get(ad);var cB=A.get(bB);var L=[];cs.each(cD,function(cF,cE,cG){L.push(bF(cB,cF));});cC.setContent(L.join(Q));}}});b6.FormBuilderMultipleChoiceField=f;b6.FormBuilder.types["multiple-choice"]=b6.FormBuilderMultipleChoiceField;var bX=b6.Lang,aX=bX.isArray,aZ=bX.isBoolean,aB=bX.isNumber,bT=bX.isString,aR="boundingBox",e="bodyContent",K="checked",ax="choice",cr="contentBox",aL="container",bP=".",bJ="",bq="field",g="fields",aG="form-builder-field",bd="form-builder-radio-field",ch="id",r="icon",bj="inline",aj="label",c="labels",aC="name",cz="node",H="optionsContainerNode",aO="predefinedValue",W="radio",aw="size",Y=" ",aI="template",ad="templateNode",m="value",z=b6.getClassName,d=z(bq),b3=z(bq,ax),bN=z(aG),aQ=z(aG,W),b9=z(aG,cz),ca=z(aG,ae,aL),bQ=z(bH,cj),b0=z(bq,c,bj),b4='<li class="'+[G,bn,bN,aQ].join(Y)+'"></li>',aa='<div class="'+ca+'"></div>',aW='<input id="{id}" class="'+[b9,d,b3].join(Y)+'" name="{name}" type="radio" value="{value}" {checked} />',cd='<input type="hidden" />';
var i=b6.Component.create({NAME:bd,ATTRS:{name:{value:W},optionTemplate:{value:aW},template:{valueFn:function(){return aW;}},optionsContainerNode:{valueFn:function(){return b6.Node.create(aa);}},templateNode:{valueFn:"getNode"}},CSS_PREFIX:bN,HTML_PARSER:{optionsContainerNode:bP+ca,templateNode:bP+b9},EXTENDS:b6.FormBuilderMultipleChoiceField,prototype:{BOUNDING_TEMPLATE:b4,renderUI:function(){var A=this;var L=A.get(cr);var cB=A.get(H);b6.FormBuilderRadioField.superclass.renderUI.apply(A,arguments);L.append(cB);},getNode:function(){var A=this;return b6.Node.create(cd);},_onFieldChange:function(L){var A=this;var cB=L.target;A.set(aO,cB.val());},_uiSetDisabled:function(cB){var A=this;var L=A.get(H);L.all(a1).each(function(cC){if(cB){cC.setAttribute(bI,cB);}else{cC.removeAttribute(bI);}});},_uiSetOptions:function(cD){var A=this;var L=A.get(cr);var cC=A.get(H);var cB=A.get(ad);cC.empty();b6.each(cD,function(cG){var cF=new b6.Field({type:W,disabled:A.get(bI),name:A.get(aC),labelText:cG.label,labelAlign:"left",value:cG.value}).render(cC);var cE=cF.get(cz);if(cG.value==A.get(aO)){cE.set(K,true);}if(A.get(bI)){cE.setAttribute(bI,cD);}else{cE.removeAttribute(bI);}cE.on({change:b6.bind(A._onFieldChange,A)});});},_uiSetPredefinedValue:function(cD){var A=this;var L=A.get(bf);var cB=L.get(at);var cC=cB.one("input[name=predefinedValue]");if(cC){cC.val(cD);}}}});b6.FormBuilderRadioField=i;b6.FormBuilder.types["radio"]=b6.FormBuilderRadioField;var bX=b6.Lang,aX=bX.isArray,aB=bX.isNumber,bT=bX.isString,bx=function(A){return(A instanceof b6.Node);},a6=function(A){return(A instanceof b6.NodeList);},ba=b6.cached(function(A){return A.substring(0,1).toUpperCase()+A.substring(1);}),aR="boundingBox",cm="button",ck="buttonType",cr="contentBox",aL="container",ct="defaultOptions",bP=".",be="drag",aD="dragContainer",v="dragContainerNode",b1="dragNodesList",aA="drop",bi="dropContainer",bp="dropContainerNode",bJ="",bq="field",g="fields",aG="form-builder-field",b5="form-builder-select-field",ch="id",r="icon",a1="input",aj="label",cl="multiple",aC="name",cz="node",T="option",ae="options",bb="portalLayout",aO="predefinedValue",bt="proxy",bR="reset",bY="selectedIndex",ay="submit",Y=" ",aI="template",ad="templateNode",bL="text",Z="type",m="value",z=b6.getClassName,bv=z(bq,a1),P=z(bq,a1,bL),bN=z(aG),b9=z(aG,cz),bQ=z(bH,cj),bE='<select id="{id}" class="'+[b9].join(Y)+'" name="{name}" value="{value}"></select>';var ah=b6.Component.create({NAME:b5,ATTRS:{multiple:{setter:b6.DataType.Boolean.parse,value:false},template:{valueFn:function(){return bE;}},templateNode:{valueFn:"getNode"}},UI_ATTRS:b6.FormBuilderField.UI_ATTRS.concat([cl]),CSS_PREFIX:bN,HTML_PARSER:{templateNode:bP+b9},EXTENDS:b6.FormBuilderMultipleChoiceField,prototype:{getHTML:function(){var A=this;var cC=A.get(aI);var cE=A.get(ch);var cB=A.get(aj);var L=A.get(aC);var cD=A.get(aO);return b6.substitute(cC,{id:cE,label:cB,name:L,value:cD});},getNode:function(){var A=this;return b6.Node.create(A.getHTML());},renderSettings:function(){var L=this;var cB=L.get(bf);var cD=cB.get(at);var cE=L.settingsNodesMap;b6.FormBuilderSelectField.superclass.renderSettings.apply(L,arguments);if(!L._renderedSelectSettings){L._renderedSelectSettings=true;var cC=L.propertiesPanel.get(e);L._renderSettingsFields([{type:"checkbox",name:cl,labelText:"Multiple",labelAlign:"left"}],cC.item(0));var A=cE["multipleSettingNode"];A.on({change:b6.bind(L._onSettingsFieldChange,L)});A.set(K,L.get(cl));}},_uiSetMultiple:function(cB){var A=this;var L=A.get(ad);if(cB){L.setAttribute(cl,cl);}else{L.removeAttribute(cl);}}}});b6.FormBuilderSelectField=ah;b6.FormBuilder.types["select"]=b6.FormBuilderSelectField;var bX=b6.Lang,aX=bX.isArray,aB=bX.isNumber,bT=bX.isString,bx=function(A){return(A instanceof b6.Node);},a6=function(A){return(A instanceof b6.NodeList);},aR="boundingBox",cr="contentBox",aL="container",bP=".",be="drag",aD="dragContainer",v="dragContainerNode",b1="dragNodesList",aA="drop",bi="dropContainer",bp="dropContainerNode",bJ="",bq="field",g="fields",aG="form-builder-field",a2="form-builder-input-field",ch="id",r="icon",a1="input",aj="label",aC="name",cz="node",bb="portalLayout",aO="predefinedValue",bt="proxy",Y=" ",aI="template",ad="templateNode",bL="text",m="value",bz="width",z=b6.getClassName,bv=z(bq,a1),P=z(bq,a1,bL),bN=z(aG),b9=z(aG,cz),bQ=z(bH,cj),bK='<input id="{id}" class="'+[b9,bv,P].join(Y)+'" name="{name}" type="text" value="{value}" />',aJ={small:25,medium:50,large:100};var by=b6.Component.create({NAME:a2,ATTRS:{template:{valueFn:function(){return bK;}},templateNode:{valueFn:"getNode"},width:{setter:b6.DataType.String.evaluate,value:25}},CSS_PREFIX:bN,HTML_PARSER:{templateNode:bP+b9},EXTENDS:b6.FormBuilderField,prototype:{bindUI:function(){var A=this;b6.FormBuilderTextField.superclass.bindUI.apply(A,arguments);var L=A.get(ad);L.on({input:b6.bind(A._onValueInput,A)});},getHTML:function(){var A=this;var cD=A.get(aI);var cF=A.get(ch);var cB=A.get(aj);var L=A.get(aC);var cE=A.get(aO);var cC=A.get(bz);return b6.substitute(cD,{id:cF,label:cB,name:L,value:cE,width:cC});},getNode:function(){var A=this;return b6.Node.create(A.getHTML());},renderSettings:function(){var cH=this;var cG=cH.get(bf);var cB=cG.get(at);var cF=cH.settingsNodesMap;var cI=cG.get(bZ);b6.FormBuilderTextField.superclass.renderSettings.apply(cH,arguments);if(!cH._renderedInputSettings){cH._renderedInputSettings=true;var cD=cH.propertiesPanel.get(e);var A=0;var cE=-1;var cC=[];b6.each(aJ,function(cL,cK){if(cL==cH.get(bz)){cE=A;}cC.push({labelText:cI[cK],value:cL});A++;});cH._renderSettingsFields([{labelText:"Width",name:bz,options:cC,type:"select",value:cH.get(bz)}],cD.item(0));var L=cF["predefinedValueSettingNode"];L.on({input:b6.bind(cH._onValueInput,cH)});var cJ=cF["widthSettingNode"];cJ.on({change:b6.bind(cH._onWidthChange,cH)});cJ.all(T).item(cE).set(bg,true);}},_onValueInput:function(L){var A=this;var cB=L.target;A.set(aO,cB.val());},_onWidthChange:function(L){var A=this;var cB=L.target;A.set(bz,cB.val());},_uiSetWidth:function(cB){var A=this;
var L=A.get(ad);L.addClass(z("w"+cB));L.removeClass(z("w"+A.prevWidth));A.prevWidth=cB;}}});b6.FormBuilderTextField=by;b6.FormBuilder.types["text"]=b6.FormBuilderTextField;var bX=b6.Lang,aX=bX.isArray,aB=bX.isNumber,bT=bX.isString,aR="boundingBox",cr="contentBox",aL="container",bP=".",be="drag",aD="dragContainer",v="dragContainerNode",b1="dragNodesList",aA="drop",bi="dropContainer",bp="dropContainerNode",bJ="",bq="field",g="fields",aG="form-builder-field",cn="form-builder-textarea-field",ch="id",r="icon",aj="label",aC="name",cz="node",bb="portalLayout",aO="predefinedValue",bt="proxy",aw="size",Y=" ",aI="template",ad="templateNode",bL="text",ar="textarea",m="value",z=b6.getClassName,d=z(bq),bu=z(bq,bL),O=z(bq,ar),bN=z(aG),b9=z(aG,cz),bQ=z(bH,cj),am='<textarea id="{id}" class="'+[b9,d,bu,O].join(Y)+'" name="{name}">{value}</textarea>';var aM=b6.Component.create({NAME:cn,ATTRS:{template:{valueFn:function(){return am;}},templateNode:{valueFn:"getNode"}},CSS_PREFIX:bN,HTML_PARSER:{templateNode:bP+b9},EXTENDS:b6.FormBuilderTextField,prototype:{getHTML:function(){var A=this;var cD=A.get(aI);var cF=A.get(ch);var cB=A.get(aj);var L=A.get(aC);var cC=A.get(aw);var cE=A.get(aO);return b6.substitute(cD,{id:cF,label:cB,name:L,value:cE});},getNode:function(){var A=this;return b6.Node.create(A.getHTML());}}});b6.FormBuilderTextAreaField=aM;b6.FormBuilder.types["textarea"]=b6.FormBuilderTextAreaField;},"@VERSION@",{requires:["aui-datatype","aui-form","aui-panel","aui-tooltip","io","substitute"],skinnable:true});AUI.add("aui-form-builder",function(a){},"@VERSION@",{use:["aui-form-builder-base","aui-form-builder-field"],skinnable:true});